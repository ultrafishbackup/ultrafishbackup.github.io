

<!DOCTYPE html>
<html lang="zh-CN,en,default" data-default-color-scheme=light>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/4.jpg">
  <link rel="icon" href="/img/4.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#000000">
  <meta name="author" content="Mike_Zhang">
  <meta name="keywords" content="blog, Mike_Zhang, UltraFish">
  
    <meta name="description" content="Made by Mike_Zhang  Notice | 提示  个人笔记，仅供参考PERSONAL COURSE NOTE, FOR REFERENCE ONLY Personal course note of COMP2411 Database Systems, The Hong Kong Polytechnic University, Sem1, 2022.本文章为香港理工大学2022学年第">
<meta property="og:type" content="article">
<meta property="og:title" content="Database Systems Course Note">
<meta property="og:url" content="https://ultrafish.cn/2022/12/13/database-systems-course-note/index.html">
<meta property="og:site_name" content="UltraFish">
<meta property="og:description" content="Made by Mike_Zhang  Notice | 提示  个人笔记，仅供参考PERSONAL COURSE NOTE, FOR REFERENCE ONLY Personal course note of COMP2411 Database Systems, The Hong Kong Polytechnic University, Sem1, 2022.本文章为香港理工大学2022学年第">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ultrafish-blog.oss-cn-hangzhou.aliyuncs.com/note.png?versionId=CAEQIxiBgMDCuYe37RciIGExYWZkNjg5MmIyYTRjYmFiNTk1MGZhMDBjNWVkNTZm">
<meta property="article:published_time" content="2022-12-13T09:30:44.000Z">
<meta property="article:modified_time" content="2022-12-13T10:50:40.258Z">
<meta property="article:author" content="Mike_Zhang">
<meta property="article:tag" content="Note">
<meta property="article:tag" content="Database Systems">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://ultrafish-blog.oss-cn-hangzhou.aliyuncs.com/note.png?versionId=CAEQIxiBgMDCuYe37RciIGExYWZkNjg5MmIyYTRjYmFiNTk1MGZhMDBjNWVkNTZm">
  
  
  
  <title>Database Systems Course Note - UltraFish</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"ultrafish.cn","root":"/","version":"1.9.0","typing":{"enable":true,"typeSpeed":50,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"VXQrzMqOSkaPcbILQ3sQJyhw-gzGzoHsz","app_key":"y6z7EoVjISdQPvN4meqBOkvy","server_url":"https://vxqrzmqo.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":true}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 6.1.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>UltraFish</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/topics/">
                <i class="iconfont icon-category-fill"></i>
                主题 | Topics
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/project/">
                <i class="iconfont icon-books"></i>
                项目 | Project
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-code"></i>
                UltraFish Plus
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" target="_blank" rel="noopener" href="https://plus.ultrafish.cn">
                    <i class="iconfont icon-home-fill"></i>
                    UltraFish Plus
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" target="_blank" rel="noopener" href="https://plus.ultrafish.cn/gameoflife/">
                    <i class="iconfont icon-briefcase"></i>
                    Game of Life
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" target="_blank" rel="noopener" href="https://plus.ultrafish.cn/GPA-Calculator">
                    <i class="iconfont icon-briefcase"></i>
                    GPA计算器 | GPA Calculator
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" target="_blank" rel="noopener" href="https://plus.ultrafish.cn/Base-convertor">
                    <i class="iconfont icon-briefcase"></i>
                    多进制转换 | Base Convertor
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" target="_blank" rel="noopener" href="https://plus.ultrafish.cn/IEEE-754-Single-Representation">
                    <i class="iconfont icon-briefcase"></i>
                    IEEE 754
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" target="_blank" rel="noopener" href="https://mike.ultrafish.cn">
                <i class="iconfont icon-user-fill"></i>
                作者 | Author
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-addrcard"></i>
                关于 | About
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-more"></i>
                更多 | More
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/links/">
                    <i class="iconfont icon-friends"></i>
                    伙伴及留言 | Friends & Discuss
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/collection/">
                    <i class="iconfont icon-th-large"></i>
                    收藏夹 | Collection
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/archives/">
                    <i class="iconfont icon-archive-fill"></i>
                    文章 | Archive
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/tags/">
                    <i class="iconfont icon-tags-fill"></i>
                    标签 | Tag
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/">
                    <i class="iconfont icon-category-fill"></i>
                    分类 | Category
                  </a>
                
              </div>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
    
    <!-- <div id="google_translate_element"></div>
    <script type="text/javascript">
      function googleTranslateElementInit() {
          new google.translate.TranslateElement({
              pageLanguage: 'zh'
          }, 'google_translate_element');
      }
  </script>
  <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script> -->

  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://ultrafish-blog.oss-cn-hangzhou.aliyuncs.com/note.png?versionId=CAEQIxiBgMDCuYe37RciIGExYWZkNjg5MmIyYTRjYmFiNTk1MGZhMDBjNWVkNTZm') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Database Systems Course Note"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-12-13 17:30" pubdate>
          2022-12-13
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          <!-- compatible with older versions-->
          61k 字 words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          <!-- compatible with older versions-->
          509 分钟 mins
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          阅读数 | Page View：<span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Database Systems Course Note</h1>
            
            <div class="markdown-body">
              
              <p><strong><em>Made by Mike_Zhang</em></strong></p>
<hr>
<p><strong><em>Notice | 提示</em></strong></p>
<blockquote>
<p><strong><em>个人笔记，仅供参考</em></strong><br><strong><em>PERSONAL COURSE NOTE, FOR REFERENCE ONLY</em></strong></p>
<p>Personal course note of <strong>COMP2411 Database Systems</strong>, The Hong Kong Polytechnic University, Sem1, 2022.<br>本文章为香港理工大学2022学年第一学期 <strong>数据库系统(COMP2411 Database Systems)</strong> 个人的课程笔记。</p>
<p>Mainly focus on <strong>Introduction to Database Systems</strong>, <strong>SQL</strong>, <strong>Relational Algebra</strong>, <strong>Integrity Constraints &amp; Normal Forms</strong>, <strong>File Organization and Indexing</strong>, <strong>Query Optimization</strong>, and <strong>Transactions and Concurrency Control</strong>.</p>
</blockquote>
<span id="more"></span>
<hr>
<p><a id="title" onclick="onTileClick()">Unfold <strong>Database</strong> Topics | 展开<strong>数据库</strong>主题 &gt;</a></p>
<p><iframe id="ifr" width="100%" src="/topics/#/database" frameborder="0" onresize="this.height=this.contentWindow.document.body.scrollHeight/0.6" onload="this.height=0" scrolling="yes" allowfullscreen>
</iframe></p>
<script type="text/javascript">
    var content = document.getElementById("ifr");
  var flag = false;
  const h = content.contentWindow.document.body.scrollHeight/0.5+'px'
    function onTileClick() { 
    content.height = flag ? 0 : h;
    flag = !flag;
    }
</script>

<hr>
<h1 id="0-Reference-Book-and-Solutions-Manual"><a href="#0-Reference-Book-and-Solutions-Manual" class="headerlink" title="0 Reference Book and Solutions Manual"></a>0 Reference Book and Solutions Manual</h1><p><a target="_blank" rel="noopener" href="https://github.com/zhangwengyu999/PolyU_COMP_Archive/blob/main/COMP2411/Book_%26_Answer/Fundamentals-of-Database-Systems-Pearson-2015-Ramez-Elmasri-Shamkant-B.-Navathe.pdf">[PDF] Fundamentals of Database Systems Pearson 2015 Ramez Elmasri Shamkant B. Navathe</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/zhangwengyu999/PolyU_COMP_Archive/blob/main/COMP2411/Book_%26_Answer/Solutions_Manual_Fundamentals_of_Database_Systems_7th_EditionInstructor.pdf">[PDF] Solutions Manual of Fundamentals of Database Systems Pearson 2015 Ramez Elmasri Shamkant B. Navathe</a></p>
<hr>
<h1 id="1-Introduction-to-Database-Systems"><a href="#1-Introduction-to-Database-Systems" class="headerlink" title="1 Introduction to Database Systems"></a>1 Introduction to Database Systems</h1><h2 id="1-1-Definitions"><a href="#1-1-Definitions" class="headerlink" title="1.1 Definitions"></a>1.1 Definitions</h2><p><strong><em>Database(DB)</em></strong> :<br>A <strong>non-redundant</strong>, <strong>persistent (fixed)</strong> collection of <strong>logically related</strong> records/files that are <strong>structured</strong> to support various processing and retrieval needs.</p>
<p><strong><em>Database Management System (DBMS)</em></strong> :<br>A <strong>set of software programs</strong> for creating, storing, updating, and accessing the data of a DB.</p>
<ul>
<li>Goal of DBMS:  to provide an <strong>environment</strong> that is convenient, efficient, and robust to use in retrieving &amp; storing data.</li>
</ul>
<hr>
<h2 id="1-2-Data-Abstraction"><a href="#1-2-Data-Abstraction" class="headerlink" title="1.2 Data Abstraction"></a>1.2 Data Abstraction</h2><center><img src="/2022/12/13/database-systems-course-note/1.png" srcset="/img/loading.gif" lazyload width="60%"></center>

<p><strong><em>Data Abstraction</em></strong>: <strong>hide details</strong> of how data is <strong>stored</strong> and <strong>manipulated</strong></p>
<p>3-Level Architecture:</p>
<ul>
<li><strong>Internal Level(physical level)</strong>:<ul>
<li>data structures; <strong>HOW</strong> data are actually stored physically;</li>
</ul>
</li>
<li><strong>Conceptual Level</strong><ul>
<li>Schema; <strong>WHAT</strong> data are actually stored;</li>
<li><strong>Hides</strong> the details of physical storage structures and concentrates on describing entities, data types, relationships, user operations, and constraints.</li>
</ul>
</li>
<li><strong>External Level(view level)</strong>:<ul>
<li><strong>Partial</strong> Scheme that a <strong>particular user group</strong> is interested in and hides the rest of the database from that user group</li>
</ul>
</li>
</ul>
<p>The result of 3-Level Architecture - <strong>Data Independence</strong>:</p>
<ul>
<li>The ability to modify a schema definition in one level <strong>without affecting</strong> a schema in the next higher level<ul>
<li>Physical data independence:<ul>
<li>Regarding the <strong>Internal schema</strong>, its change will NOT affect <strong>Conceptual schema</strong>, thus will NOT affect the <strong>External schema</strong>;<ul>
<li>DB can run different divides (HDD, SSD)</li>
</ul>
</li>
</ul>
</li>
<li>Logical data independence:<ul>
<li>Regarding the <strong>Conceptual schema</strong>, its change will NOT affect the <strong>External schema</strong>, which will not affect the <strong>application programs</strong>.<ul>
<li>Different use right (which part can see by the user, which can not)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="1-3-Data-Models"><a href="#1-3-Data-Models" class="headerlink" title="1.3 Data Models"></a>1.3 Data Models</h2><ul>
<li>A collection of conceptual <strong>tools</strong> for <strong>describing</strong> <em>data</em>, <em>data relationships</em>, <em>operations</em>, and consistency <em>constraints</em>, as the “core” of a database</li>
</ul>
<p>Main Focus:</p>
<ul>
<li>The Entity-Relationship (ER) model (more like a <strong>design tool</strong>)</li>
<li>The Relational model</li>
</ul>
<p>Terminologies in Data Models:</p>
<ul>
<li><strong><em>Instance</em></strong>:<ul>
<li>the collection of <strong>data</strong> (value/information) stored in the DB at a <strong>particular moment</strong> (ie, a snapshot);</li>
</ul>
</li>
<li><strong><em>Schema</em></strong>:<ul>
<li>the overall <strong>structure</strong> (design) of the DB — relatively <strong>static</strong>.</li>
</ul>
</li>
</ul>
<hr>
<h2 id="1-4-Basic-Concepts-and-Terminologies"><a href="#1-4-Basic-Concepts-and-Terminologies" class="headerlink" title="1.4 Basic Concepts and Terminologies"></a>1.4 Basic Concepts and Terminologies</h2><p><strong>Data Definition Language (DDL)</strong>:</p>
<ul>
<li>for defining DB schema;</li>
<li>Compiled to a data dictionary, containing metadata (data of data, description of data)</li>
</ul>
<p><strong>Data Manipulation Language (DML)</strong>:</p>
<ul>
<li>for user to manipulate data</li>
<li>Query Language</li>
<li>2 types:<ul>
<li>Procedural: What and how (Lower level with more steps)</li>
<li>Declarative: What (Higher level with less steps)</li>
</ul>
</li>
</ul>
<hr>
<p><strong>User of DB</strong>:</p>
<ul>
<li><strong>Application Programmers</strong>: Writing embedded DML in a host language, access DB via C++, Java, …</li>
<li><strong>Interactive Users</strong>: Using Query Language, like SQL;</li>
<li><strong>Naive Users</strong>: Running application programs;</li>
</ul>
<hr>
<p><strong>Database Administrator (DBA)</strong>:</p>
<ul>
<li>The boss of DB</li>
<li>who has <strong>central control</strong> over the DB</li>
<li>Functions:<ul>
<li>schema definition</li>
<li>storage structure and access method definition</li>
<li>schema and physical organization modification</li>
<li>granting of authorization for data access</li>
<li>integrity constraint specification</li>
</ul>
</li>
</ul>
<hr>
<p><strong>File Manager</strong>:</p>
<ul>
<li>allocation space</li>
<li>operations on files</li>
</ul>
<hr>
<p><strong>DB Manager</strong>:</p>
<ul>
<li>Interface between Data and Application;</li>
<li>Translate conceptual level commands into physical level ones;</li>
<li>responsible for<ul>
<li>access control</li>
<li>concurrency control</li>
<li>backup &amp; recovery</li>
<li>integrity</li>
</ul>
</li>
</ul>
<hr>
<h2 id="1-5-The-Entity-Relationship-Model"><a href="#1-5-The-Entity-Relationship-Model" class="headerlink" title="1.5 The Entity-Relationship Model"></a>1.5 The Entity-Relationship Model</h2><p><strong><em>Entity</em></strong>:</p>
<ul>
<li>a distinguishable <strong>object</strong> with an independent existence</li>
</ul>
<p><strong><em>Entity Set</em></strong>:</p>
<ul>
<li>a <strong>set of entities</strong> of the <strong>same type</strong></li>
</ul>
<hr>
<p><strong><em>Attribute(Property)</em></strong> :</p>
<ul>
<li>a piece of <strong>information</strong> describing an entity</li>
<li>Each attribute take a <strong>value of a domain (value of a data type)</strong><ul>
<li>an attribute A is a function which maps from an entity set E into a domain D:</li>
<li>$A:E\to D$</li>
</ul>
</li>
</ul>
<p>3 Types of Attributes:</p>
<ul>
<li><strong>Simple</strong>: Single indivisible value;</li>
<li><strong>Composite</strong>: A divisible attribute consist several components (some hierarchy components, levels);</li>
<li><strong>Multi-valued</strong>: A attribute has multiple values (with same hierarchy, more then one values)</li>
</ul>
<p><strong>Composite</strong> and <strong>Multi-valued</strong> attributes may be nested, and composite can be a part of multi-valued attribute</p>
<hr>
<p><strong><em>Relationship</em></strong>:</p>
<ul>
<li>an <strong>association</strong> among <strong>several entities</strong></li>
</ul>
<p><strong><em>Relationship Set</em></strong>:</p>
<ul>
<li><p>a <strong>set of relationships</strong> of the <strong>same type</strong></p>
</li>
<li><p>The <strong><em>degree</em></strong> of a relationship: the <strong><em>number</em></strong> of participation entity sets</p>
</li>
<li>2: binary; 3: ternary; n: n-ary;</li>
<li>In general, an n-ary relationship is NOT equivalent to n binary relationships</li>
</ul>
<hr>
<blockquote>
<p>Attribute vs. Relationship<br>Attribute: $A: E\to D$, map from a <strong>Entity</strong> to a <strong>Value</strong> in a Domain<br>Relationship: $R: E_1 \to E_2$, map from onr <strong>Entity</strong> to another <strong>Entity</strong><br>A Relationship can also has Attributes to <strong>describe</strong> it<br>So Attribute is kind of a simplified Relationship.</p>
<blockquote>
<p>We CAN decide to map to a Domain(primary type) of another Entity(reference type), where Domain is just a value (no more details), while Entity can be divided into many parts (more details)</p>
</blockquote>
</blockquote>
<hr>
<p><strong><em>Integrity Constraints</em></strong>:</p>
<ul>
<li><strong>Integrity Constraints</strong>:</li>
<li><strong>Cardinality Ratio</strong>:<ul>
<li>One - to - One (1:1);</li>
<li>One - to - Many (1:M) / Many - to - One (M:1);</li>
<li>Many - to - Many (M:N)</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><strong>Keys</strong>: to distinguish <strong>individual</strong> entities or relationships<ul>
<li><strong>Superkey</strong>: a <strong>set of one or more attributes</strong> which, taken <strong>together</strong>, identify uniquely an entity in an entity set;<ul>
<li>{SID, Name} for a student</li>
</ul>
</li>
<li><strong>Candidate Key</strong>: <strong>minimal set</strong> of attributes which can identify uniquely an entity in an entity set; As a <strong>subset/special case</strong> of superkey;<ul>
<li>{SID} for a student, Name is not unique for students, can not be Candidate Key</li>
</ul>
</li>
<li><strong>Primary Key</strong>: A Candidate Key chosen by the DB designer, ss a <strong>subset</strong> of Candidate Key; If there is only one Candidate Key, it becomes the primary key automatically.</li>
</ul>
</li>
</ul>
<script type="math/tex; mode=display">
KEY_P\subset KEY_C \subset KEY_S</script><hr>
<p><strong>Structural Constraints of Relationship</strong>:</p>
<ul>
<li><p>Cardinality ratio:</p>
<ul>
<li>1:1, 1:N, N:1, M:N (for binary)</li>
<li>The number on the link line in ER Diagram</li>
</ul>
</li>
<li><p>Participation constraint:</p>
<ul>
<li>Partial participation: single line;</li>
<li>Total participation: double line;</li>
</ul>
</li>
</ul>
<hr>
<p><strong>(min, max) notation</strong>:</p>
<ul>
<li>(min, max) notation <strong>replaces</strong> the cardinality ratio (1:1, 1:N, M:N) and single/double-line notation for participation constraints ($0 ≤ min ≤ max, max ≥ 1$);</li>
<li><strong>Definition</strong> (Fundamentals of Database Systems, Seventh Edition, Section 3.7.4, page 84):<blockquote>
<p>For <strong>EACH entity</strong> e in E, e <strong>MUST participate</strong> in at least $min$ and <strong>at most $max$ relationship instances</strong> in R at any point in time;</p>
</blockquote>
</li>
<li>Let me say it in English, for one particular entity (e.g. Student_Mike in Student Entity Set), MUST appear (participate) in at most $max$ tuples/rows (relationship instances) in the table(relation R);</li>
<li>So, in <strong>summary</strong>:<ul>
<li>For $min$:<ul>
<li>$min = 0$ -&gt; <strong>partial participation</strong> - single line, some entities may not appear in rows;</li>
<li>$min &gt; 0$ -&gt; <strong>total participation</strong> - double line, all entities MUST appear in rows;</li>
</ul>
</li>
<li>For $max$:<ul>
<li>For one particular entity, it MUST appear in at most $max$ rows in the table (relation R);</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>[Example]</strong></p>
<center><img src="/2022/12/13/database-systems-course-note/3.png" srcset="/img/loading.gif" lazyload width="80%"></center>

<hr>
<p><strong>[Example]</strong></p>
<blockquote>
<p>use (min, max) notations to represent the 1:1, 1:M / M:1, and M:N relationship sets</p>
</blockquote>
<p><strong>Translation</strong> between Cardinality ratio and (min, max) notations:</p>
<ol>
<li>Cardinality ratio <strong>1:1</strong> $\to$<br>(min, max): <strong>Left $(x,1)$; Right $(1,x)$</strong><br>where:<ul>
<li>$x=0$, when the entity has <strong>partial</strong> participation;</li>
<li>$x=1$, when the entity has <strong>total</strong> participation</li>
</ul>
</li>
</ol>
<p><strong>Example:</strong></p>
<p>Person === HAS === ID Number<br><strong>Cardinality ratio</strong> <strong>1:1</strong> with double line(<strong>total</strong> participation):</p>
<ul>
<li>For each Person, he/she MUST have one and only one ID Number (1), and</li>
<li>for each ID Number, it MUST be had by one and only one Person (1)</li>
</ul>
<p><strong>(min, max) notations</strong>: -$(1,1)$- HAS -$(1,1)$-<br>In this HAS Table:</p>
<ul>
<li>Each Person MUST appear in the table one and only one row;</li>
<li>Each ID Number MUST appear in the table one and only row;</li>
</ul>
<hr>
<ol>
<li><p>Cardinality ratio <strong>1:M</strong> $\to$<br>(min, max): <strong>Left $(x:M)$, Right $(x:1)$</strong></p>
<ul>
<li>$x=0$, when the entity has <strong>partial</strong> participation;</li>
<li>$x=1$, when the entity has <strong>total</strong> participation</li>
</ul>
</li>
<li><p>Cardinality ratio <strong>M:1</strong> $\to$<br>(min, max): <strong>Left $(x:1)$, Right $(x:M)$</strong></p>
<ul>
<li>$x=0$, when the entity has <strong>partial</strong> participation;</li>
<li>$x=1$, when the entity has <strong>total</strong> participation</li>
</ul>
</li>
</ol>
<p><strong>Example:</strong></p>
<p>Employee === WORKS_FOR === Department</p>
<p>Cardinality ratio <strong>M:1</strong> with double line(<strong>total</strong> participation):</p>
<ul>
<li>Multiple Employees (M) can WORK FOR a same Department (1), same as a Department can HAS multiple Employees, and</li>
<li>Each Employees MUST WORKS FOR one and only one Department (1);</li>
</ul>
<p><strong>(min, max) notations</strong>: -$(1:1)$- WORKS_FOR -$(1:M)$-:<br>In this WORKS_FOR Table:</p>
<ul>
<li>Each Employee MUST appear in one and only one row (1);</li>
<li>Each Department MUST appear and can appear in many rows (M);</li>
</ul>
<hr>
<ol>
<li>Cardinality ratio <strong>M:N</strong> $\to$<br>(min, max): <strong>Left $(x:N)$, Right $(x:M)$</strong></li>
</ol>
<ul>
<li>$x=0$, when the entity has <strong>partial</strong> participation;</li>
<li>$x=1$, when the entity has <strong>total</strong> participation</li>
</ul>
<hr>
<h2 id="1-6-ER-Diagram-Notation"><a href="#1-6-ER-Diagram-Notation" class="headerlink" title="1.6 ER-Diagram Notation"></a>1.6 ER-Diagram Notation</h2><center><img src="/2022/12/13/database-systems-course-note/2.png" srcset="/img/loading.gif" lazyload width="70%"></center>

<p><strong>Weak Entity Set</strong></p>
<ul>
<li>an entity set that does <strong>NOT</strong> have enough attributes to form a primary/candidate key;</li>
<li>Must <strong>attached</strong> to a <strong>Strong Entity Set</strong>.</li>
</ul>
<p><strong>Multivalued Attribute</strong></p>
<ul>
<li>Can has more than one value;</li>
</ul>
<p><strong>Weak Key</strong>:</p>
<ul>
<li>Attribute with <strong>dot line</strong>;</li>
<li>Associated with other primary key to form a primary key (Branch_No + Bank_Code);</li>
</ul>
<p><strong>Total Participation</strong>:</p>
<ul>
<li>Take example from above;</li>
<li>Every $E_2$ has a $E_1$ in the relationship $R$, but not every $E_1$ has a $E_2$</li>
</ul>
<p><strong>Self reference relationship</strong>:</p>
<ul>
<li>Recursive Relationship: SUPERVISE</li>
</ul>
<hr>
<h2 id="1-7-Relational-Data-Model"><a href="#1-7-Relational-Data-Model" class="headerlink" title="1.7 Relational Data Model"></a>1.7 Relational Data Model</h2><p><strong>Basic Structure</strong>:</p>
<ul>
<li><em>Relations</em>:<ul>
<li>Data stored as <strong><em>tables</em></strong> (called relations); each has a unique name </li>
</ul>
</li>
<li><p><em>Attributes</em>:</p>
<ul>
<li>an attribute has a “domain” (a set of permitted values, date type)</li>
<li>Each attribute/<strong>column</strong> in a relation corresponds to a particular field of a record</li>
<li>All values are considered atomic (indivisible) in tuples, which has no composite value or multi-valued, only simple value;</li>
<li><code>null</code> value is used to represent values that are <strong>unknown</strong> or <strong>inapplicable</strong> to certain tuples;<ul>
<li>A key attribute CAN NOT contain <code>NULL</code> values;</li>
</ul>
</li>
</ul>
</li>
<li><p><em>Records</em>:</p>
<ul>
<li>Each <strong>row/tuple</strong> in a relation is a <strong>record</strong> (an entity) </li>
</ul>
</li>
</ul>
<p><strong>Relational DB Schema</strong>:</p>
<center><img src="/2022/12/13/database-systems-course-note/4.png" srcset="/img/loading.gif" lazyload width="70%"></center>

<p><strong>DB Instance</strong>:</p>
<center><img src="/2022/12/13/database-systems-course-note/5.png" srcset="/img/loading.gif" lazyload width="70%"></center>

<p><strong>Informal / Formal Terms</strong>:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">Informal</th>
<th style="text-align:center">Formal</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Table</td>
<td style="text-align:center">Relational</td>
</tr>
<tr>
<td style="text-align:center">Column</td>
<td style="text-align:center">Attribute</td>
</tr>
<tr>
<td style="text-align:center">Row</td>
<td style="text-align:center">Tuple</td>
</tr>
<tr>
<td style="text-align:center">Values in a column</td>
<td style="text-align:center">Domain</td>
</tr>
<tr>
<td style="text-align:center">Table Definition</td>
<td style="text-align:center">Schema</td>
</tr>
</tbody>
</table>
</div>
<hr>
<p><strong>Orders in Tuple and Attribute</strong>:</p>
<ul>
<li>Rows/Tuples NO need to be ordered;</li>
<li>Attribute (and its corresponding value) DO need to be ordered;</li>
</ul>
<hr>
<p><strong>Convert between ER and Relational</strong>:<br><strong>[Example]</strong></p>
<center><img src="/2022/12/13/database-systems-course-note/6.png" srcset="/img/loading.gif" lazyload width="70%"></center>

<p>Weak entity(relationship) shall with identifying eneity</p>
<center><img src="/2022/12/13/database-systems-course-note/7.png" srcset="/img/loading.gif" lazyload width="70%"></center>

<hr>
<p><strong>Representation of Relationship Sets</strong>:<br><strong>[Example]</strong></p>
<p><strong>M:N</strong></p>
<center><img src="/2022/12/13/database-systems-course-note/8.png" srcset="/img/loading.gif" lazyload width="70%"></center>

<blockquote>
<p>For 1:1, 1:M/M:1, NO need a separated table for the relationship</p>
</blockquote>
<hr>
<p><strong>Model a data as Attribute or Entity Set?</strong></p>
<blockquote>
<p>Depends on the usage of the data (need to be decomposed or not)<br>For <strong>Date</strong>:</p>
<blockquote>
<p>If need to extract Year, Month, Day information, then use Entity Set (Date{Y,M,D});<br>If just need a Data in String, just use as an attribute (“2022-09-09”);</p>
</blockquote>
</blockquote>
<hr>
<h1 id="2-SQL"><a href="#2-SQL" class="headerlink" title="2 SQL"></a>2 SQL</h1><p>SQL: Structured Query Language</p>
<p><strong>Basic Syntax</strong>:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> [<span class="hljs-keyword">DISTINCT</span>] attr1, attr2,...<br><span class="hljs-keyword">FROM</span> table1 name1, table2 name2,...<br><span class="hljs-keyword">WHERE</span> requirement<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> attr<br><span class="hljs-keyword">HAVING</span> requirement;<br></code></pre></td></tr></table></figure>
<p>Where:</p>
<p><code>requirement</code>:</p>
<ul>
<li><code>requirement</code> <strong><code>AND/OR</code></strong> <code>requirement</code></li>
<li><code>logical-relation</code></li>
</ul>
<p><code>logical-relation</code>:</p>
<ul>
<li><p><code>attribute</code> <strong><code>&gt;,=,&lt;&gt;(!=),&lt;=,&gt;=</code></strong> <code>constant attribute</code></p>
</li>
<li><p><code>attribute</code> <strong><code>IN/ NOT IN</code></strong> <code>SQL-Expression Set / SET(Attributes)</code></p>
</li>
<li><p><code>SQL-Expression Set / SET(Attributes)</code> </p>
<p>  <strong><code>CONTAINS / NOT CONTAINS</code></strong> </p>
<p>  <code>SQL-Expression Set / SET(Attributes)</code></p>
</li>
<li><p><strong><code>EXISTS / NOT EXISTS</code></strong> <code>SQL-Expression</code></p>
</li>
</ul>
<hr>
<h2 id="2-1-DISTINCT-amp-LIKE"><a href="#2-1-DISTINCT-amp-LIKE" class="headerlink" title="2.1 DISTINCT &amp; LIKE"></a>2.1 DISTINCT &amp; LIKE</h2><p><code>DISTINCT</code>:</p>
<ul>
<li>To get the distinct set of result, no more duplicated (overlap) data, ID, sName;</li>
<li><code>UNION</code> will remove the overlap as well;</li>
</ul>
<p><strong>[Example]</strong><br><strong>change language, sql, relational algebra</strong><br>Find the name and city of all customers having a loan at the Sai Kong branch</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> Customer.cname, city<br><span class="hljs-keyword">FROM</span> Borrow, Customer<br><span class="hljs-keyword">WHERE</span> Borrow.cname <span class="hljs-operator">=</span> Customer.cname<br>	<span class="hljs-keyword">AND</span> bname <span class="hljs-operator">=</span> “Sai Kong”;<br></code></pre></td></tr></table></figure>
<hr>
<p><code>LIKE</code>;</p>
<ul>
<li>Similar to the <code>format</code></li>
</ul>
<p><strong>[Example]</strong></p>
<p>Find the names of all customers whose street has the <strong>substring ‘Main’ included</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> cname<br><span class="hljs-keyword">FROM</span> Customer<br><span class="hljs-keyword">WHERE</span> street <span class="hljs-keyword">LIKE</span> “<span class="hljs-operator">%</span>Main<span class="hljs-operator">%</span>”; <br></code></pre></td></tr></table></figure>
<p><code>%</code>: Don’t Care</p>
<hr>
<h2 id="2-2-Rename-amp-Nested-Query"><a href="#2-2-Rename-amp-Nested-Query" class="headerlink" title="2.2 Rename &amp; Nested Query"></a>2.2 Rename &amp; Nested Query</h2><p><strong>[Example]</strong></p>
<p>Find all customers who have an account at some branch in which Jones has an account</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> T.cname<br><span class="hljs-keyword">FROM</span> Deposit S, Deposit T <span class="hljs-keyword">WHERE</span> S.cname <span class="hljs-operator">=</span> “Jones”  <span class="hljs-keyword">AND</span> S.bname <span class="hljs-operator">=</span> T.bname<br>	<span class="hljs-keyword">AND</span> T.cname <span class="hljs-operator">!=</span> S.cname;<br></code></pre></td></tr></table></figure>
<ul>
<li><code>S</code> and <code>T</code> are the Table Aliases of table <code>Deposit</code></li>
</ul>
<hr>
<h2 id="2-3-ALL"><a href="#2-3-ALL" class="headerlink" title="2.3 ALL"></a>2.3 ALL</h2><p><code>ALL</code>:</p>
<p>The <code>ALL</code> operator allows you to make comparisons between a <strong>single</strong> value and <strong>EVERY</strong> value in a set.</p>
<p><strong>[Example]</strong></p>
<p>Find branches having greater assets than all branches in N.T.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> bname<br><span class="hljs-keyword">FROM</span> Branch<br><span class="hljs-keyword">WHERE</span> assets <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">ALL</span> (<span class="hljs-keyword">SELECT</span> assets<br>					<span class="hljs-keyword">FROM</span> Branch <br>                    <span class="hljs-keyword">WHERE</span> b<span class="hljs-operator">-</span>city <span class="hljs-operator">=</span> “<span class="hljs-keyword">New</span> Territory”);<br></code></pre></td></tr></table></figure>
<blockquote>
<p><strong>Each</strong> tuple in the Branch will do the comparison, in which the single <code>assets</code> attribute value in the selected tuple with compare with <strong>every</strong> <code>assets</code>  <strong>SET</strong> from the sub-query;</p>
</blockquote>
<hr>
<h2 id="2-4-SOME"><a href="#2-4-SOME" class="headerlink" title="2.4 SOME"></a>2.4 SOME</h2><p><code>SOME/ANY</code>:</p>
<p>A condition using the <code>SOME/ANY</code> operator evaluates to true <strong>as soon as a single</strong> comparison is favorable.</p>
<p><strong>[Example]</strong></p>
<p>Find names of all branches that have greater assets than some branch located in Kowloon</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> bname<br><span class="hljs-keyword">FROM</span> Branch <span class="hljs-keyword">WHERE</span> assets <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SOME</span>(<span class="hljs-keyword">SELECT</span> assets<br>								<span class="hljs-keyword">FROM</span> Branch <br>                                <span class="hljs-keyword">WHERE</span> b<span class="hljs-operator">-</span>city <span class="hljs-operator">=</span> “Kowloon”);<br></code></pre></td></tr></table></figure>
<hr>
<h2 id="2-5-CONTAINS"><a href="#2-5-CONTAINS" class="headerlink" title="2.5 CONTAINS"></a>2.5 CONTAINS</h2><p><code>CONTAINS</code>:</p>
<p>Check the whether a <strong>SET</strong> is containing another <strong>SET</strong></p>
<p><strong>[Example]</strong></p>
<p>Find all customers who have a deposit account at <strong>ALL branches located in Kowloon</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> S.cname<br><span class="hljs-keyword">FROM</span> Deposit S<br><span class="hljs-keyword">WHERE</span>(<span class="hljs-keyword">SELECT</span> T.bname<br>		<span class="hljs-keyword">FROM</span> Deposit T<br>		<span class="hljs-keyword">WHERE</span> S.cname <span class="hljs-operator">=</span> T.cname) # S1<br><span class="hljs-keyword">CONTAINS</span><br>		(<span class="hljs-keyword">SELECT</span> bname<br>		<span class="hljs-keyword">FROM</span> Branch<br>		<span class="hljs-keyword">WHERE</span> b<span class="hljs-operator">-</span>city <span class="hljs-operator">=</span> “Kowloon”); # S2<br></code></pre></td></tr></table></figure>
<blockquote>
<p>NOTE:</p>
<p><code>WHERE S.cname = T.cname</code> in the <code>S1</code>  seems redundant, we may want to directly use <code>SELECT S.bname</code>  as <code>S1</code>. </p>
<p><strong>But not true. Because S1 and S2 returns a SET of values not a single, which is realised by the nested query rather than a single <code>SELECT S.bname</code>  statement.</strong> </p>
<p>The meaning of S1 is for a single customer having account in <code>Deposit S</code>, finding the <strong>set</strong> of <strong>all</strong> his/her accounts, because one customer may have <strong>several accounts</strong> in this bank.</p>
<p>Then <strong>each</strong> tuple from the <code>Deposit S</code> table selected by the outer Sql with do the comparison with <strong>every</strong> element in a SET in <code>WHERE</code> clause.</p>
</blockquote>
<hr>
<h2 id="2-6-MINUS"><a href="#2-6-MINUS" class="headerlink" title="2.6 MINUS"></a>2.6 MINUS</h2><p><code>MINUS</code>:</p>
<p>Returns the first result set <strong>minus any overlap</strong> with the second result set.</p>
<p><strong>[Example]</strong></p>
<p><em>Same as 2.5 CONTAINS</em></p>
<p>Find all customers who have a deposit account at ALL branches located in Kowloon</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> S.cname<br><span class="hljs-keyword">FROM</span> Deposit S<br><span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span>(<br>    			(<span class="hljs-keyword">SELECT</span> bname<br>                 <span class="hljs-keyword">FROM</span> Branch <br>                 <span class="hljs-keyword">WHERE</span> b<span class="hljs-operator">-</span>city <span class="hljs-operator">=</span> “Kowloon”) # S1<br>				MINUS<br>				(<span class="hljs-keyword">SELECT</span> T.bname<br>                 <span class="hljs-keyword">FROM</span> Deposit T<br>                 <span class="hljs-keyword">WHERE</span> S.cname <span class="hljs-operator">=</span> T.cname) # S2<br>);<br></code></pre></td></tr></table></figure>
<blockquote>
<p>Similarly, S2 returns a <strong>set</strong> of bname, which can not simply write in <code>SELECT S.bneme</code>. Because we want to find a <strong>set</strong> of <strong>all</strong> branch name where one customer has accounts in.</p>
</blockquote>
<hr>
<h2 id="2-7-EXISTS-amp-NOT-EXISTS"><a href="#2-7-EXISTS-amp-NOT-EXISTS" class="headerlink" title="2.7 EXISTS &amp; NOT EXISTS"></a>2.7 EXISTS &amp; NOT EXISTS</h2><p><code>EXISTS / NOT EXISTS</code>:</p>
<p>You use the exists operator when you want to identify that a relationship exists <strong>without regard for the quantity</strong></p>
<p><strong>[Example]</strong></p>
<p>Find all customers of Central branch who have an account there but no loan there</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> C.cname<br><span class="hljs-keyword">FROM</span> Customer C<br><span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br>			<span class="hljs-keyword">FROM</span> Deposit D <br>			<span class="hljs-keyword">WHERE</span> D.cname <span class="hljs-operator">=</span> C.cname<br>				<span class="hljs-keyword">AND</span> D.bname <span class="hljs-operator">=</span> “Central”)<br><span class="hljs-keyword">AND</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span><br>			(<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br>			<span class="hljs-keyword">FROM</span> Borrow B<br>			<span class="hljs-keyword">WHERE</span> B.cname <span class="hljs-operator">=</span> C.cname<br>				<span class="hljs-keyword">AND</span> B.bname <span class="hljs-operator">=</span> “Central”);<br></code></pre></td></tr></table></figure>
<hr>
<h2 id="2-8-ORDER-BY"><a href="#2-8-ORDER-BY" class="headerlink" title="2.8 ORDER BY"></a>2.8 ORDER BY</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SQL">...<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> attr <span class="hljs-keyword">ASC</span><span class="hljs-operator">/</span><span class="hljs-keyword">DESC</span><br></code></pre></td></tr></table></figure>
<ul>
<li><p><code>ASC</code>: ascending order, <strong>default</strong>;</p>
</li>
<li><p><code>DESC</code>: descending order;</p>
</li>
</ul>
<p><strong>[Example]</strong></p>
<p>List in alphabetic order all customers having a loan at branches in Kowloon</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> cname<br><span class="hljs-keyword">FROM</span> Borrow<br><span class="hljs-keyword">WHERE</span> b<span class="hljs-operator">-</span>city <span class="hljs-operator">=</span> “Kowloon”<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> cname;<br></code></pre></td></tr></table></figure>
<p><strong>[Example]</strong></p>
<p>List the entire borrow table in descending order of amount, and if several loans have the same amount, order them in ascending order by loan#</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br><span class="hljs-keyword">FROM</span> Borrow<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> amount <span class="hljs-keyword">DESC</span>, loan# <span class="hljs-keyword">ASC</span>;<br></code></pre></td></tr></table></figure>
<hr>
<h2 id="2-9-Data-Definition-in-SQL"><a href="#2-9-Data-Definition-in-SQL" class="headerlink" title="2.9 Data Definition in SQL"></a>2.9 Data Definition in SQL</h2><ul>
<li>Table Creation</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">table</span><span class="hljs-operator">-</span>name<br>	(A1, D1,<br>	A2, D2, ...<br>	Ak, Dk);<br></code></pre></td></tr></table></figure>
<p><strong>(Attributes, Data Type)</strong></p>
<ul>
<li>Table Deletion</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">table</span><span class="hljs-operator">-</span>name;<br></code></pre></td></tr></table></figure>
<p>(While <code>DELETE table-name</code> is DM, to delete all tuples in the table, no the table)</p>
<ul>
<li>Table update</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span>  <span class="hljs-keyword">table</span><span class="hljs-operator">-</span>name<br>	<span class="hljs-keyword">ADD</span> Aj, Dj;<br></code></pre></td></tr></table></figure>
<hr>
<h2 id="2-10-Views"><a href="#2-10-Views" class="headerlink" title="2.10 Views"></a>2.10 Views</h2><p> A logical window of one or more tables, no real data associated with a virtual table, only references.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span>  loan<span class="hljs-operator">-</span>info  <span class="hljs-keyword">AS</span><br>	<span class="hljs-keyword">SELECT</span> bname, loan, cname <br>	<span class="hljs-keyword">FROM</span> Borrow;<br></code></pre></td></tr></table></figure>
<ul>
<li><strong>Modification</strong> to a view may cause “update anomaly”</li>
<li>“A modification is permitted through a view <strong>ONLY IF</strong> the view is defined in terms of <strong>ONE</strong> base/physical relation.” to avoid error due to comparison.</li>
</ul>
<hr>
<h2 id="2-11-Data-Modifying-in-SQL"><a href="#2-11-Data-Modifying-in-SQL" class="headerlink" title="2.11 Data Modifying in SQL"></a>2.11 Data Modifying in SQL</h2><ul>
<li><strong>Deletion</strong>:</li>
</ul>
<p>Delete some tuples from the table.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> r<br><span class="hljs-keyword">WHERE</span> P<br></code></pre></td></tr></table></figure>
<blockquote>
<p>Meaning: those <strong>tuples</strong> t in relation r for which <strong>P(t) is true</strong> are deleted from r.</p>
</blockquote>
<p><strong>[Example]</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> Deposit<br><span class="hljs-keyword">WHERE</span> b<span class="hljs-operator">-</span>name <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> b<span class="hljs-operator">-</span>name <span class="hljs-keyword">FROM</span> Branch<br>				<span class="hljs-keyword">WHERE</span> b<span class="hljs-operator">-</span>city <span class="hljs-operator">=</span> “Laguna”);<br></code></pre></td></tr></table></figure>
<p><strong>[Example]</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> Deposit<br><span class="hljs-keyword">WHERE</span> balance <span class="hljs-operator">&lt;</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(balance) <span class="hljs-keyword">FROM</span> Deposit)<br></code></pre></td></tr></table></figure>
<blockquote>
<p>NOTE:</p>
<p>Above example has problems.</p>
<p>Side-effect: deleting affects the AVG() return value, solved by store in a variable first.</p>
</blockquote>
<hr>
<ul>
<li><strong>Insertion</strong>:</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> r <span class="hljs-keyword">VALUES</span> (v1, v2, …, vn);<br># <span class="hljs-keyword">or</span><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> r<br>    <span class="hljs-keyword">SELECT</span> clmn_name1, clmn_name2, …, clmn_namek <br>    <span class="hljs-keyword">FROM</span> s1, s2, … <br>    <span class="hljs-keyword">WHERE</span> ...<br></code></pre></td></tr></table></figure>
<p><strong>[Example]</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> Deposit<br>	<span class="hljs-keyword">SELECT</span> b<span class="hljs-operator">-</span>name, loan, c<span class="hljs-operator">-</span>name, <span class="hljs-number">0</span> <br>	<span class="hljs-keyword">FROM</span> Borrow <span class="hljs-keyword">WHERE</span> b<span class="hljs-operator">-</span>name <span class="hljs-operator">=</span> “ClearWaterBay” <br></code></pre></td></tr></table></figure>
<hr>
<ul>
<li><strong>Update</strong>:</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">UPDATE</span>  r<br>    <span class="hljs-keyword">SET</span> clmn1 <span class="hljs-operator">=</span> expression <br>    <span class="hljs-keyword">WHERE</span> ...<br></code></pre></td></tr></table></figure>
<blockquote>
<p> to change <strong>a value</strong> in one tuple (without changing all values in the tuple)</p>
</blockquote>
<p><strong>[Example]</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">UPDATE</span> Deposit<br>	<span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">*</span> <span class="hljs-number">1.05</span> <br></code></pre></td></tr></table></figure>
<blockquote>
<p>To increase the payment by 5% to all accounts; it is applied to each tuple exactly once.</p>
</blockquote>
<hr>
<h2 id="2-12-NULL-value"><a href="#2-12-NULL-value" class="headerlink" title="2.12 NULL value"></a>2.12 NULL value</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">NOT</th>
<th style="text-align:center">OUT</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">T</td>
<td style="text-align:center">F</td>
</tr>
<tr>
<td style="text-align:center">U(Null)</td>
<td style="text-align:center">U(Null)</td>
</tr>
<tr>
<td style="text-align:center">F</td>
<td style="text-align:center">T</td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">AND</th>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center">OUT</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>T</strong></td>
<td style="text-align:center"><strong>T</strong></td>
<td style="text-align:center"><strong>U</strong></td>
<td style="text-align:center"><strong>F</strong></td>
</tr>
<tr>
<td style="text-align:center"><strong>U</strong></td>
<td style="text-align:center"><strong>U</strong></td>
<td style="text-align:center"><strong>U</strong></td>
<td style="text-align:center"><strong>F</strong></td>
</tr>
<tr>
<td style="text-align:center">F</td>
<td style="text-align:center">F</td>
<td style="text-align:center">F</td>
<td style="text-align:center">F</td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>OR</th>
<th></th>
<th></th>
<th>OUT</th>
</tr>
</thead>
<tbody>
<tr>
<td>T</td>
<td>T</td>
<td>T</td>
<td>T</td>
</tr>
<tr>
<td><strong>U</strong></td>
<td><strong>T</strong></td>
<td><strong>U</strong></td>
<td><strong>U</strong></td>
</tr>
<tr>
<td>F</td>
<td>T</td>
<td>U</td>
<td>F</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>the special keyword <strong>NULL</strong> may be used to <strong>test for a null value</strong>.</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> c<span class="hljs-operator">-</span>name <br><span class="hljs-keyword">FROM</span> Deposit <br>	<span class="hljs-keyword">WHERE</span> balance <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>;<br>	(<span class="hljs-keyword">or</span> balance <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>;)<br></code></pre></td></tr></table></figure>
<hr>
<h2 id="2-13-Aggregate-Functions"><a href="#2-13-Aggregate-Functions" class="headerlink" title="2.13 Aggregate Functions"></a>2.13 Aggregate Functions</h2><p><code>GROUP BY</code> and <code>HAVING</code>:</p>
<p><strong>GROUP BY</strong>:</p>
<ul>
<li>Tuples with the <strong>same value</strong> on all attributes in the <strong>group by</strong> clause are placed in one group;<ul>
<li>Group by <strong>NOT</strong> means merge into one value, </li>
<li>it means <strong>sort</strong> the tuple based on some attribute, therefore some tuple having <strong>same value</strong> will be put together in a <strong>same group</strong>, then treat <strong>each group</strong> a time</li>
</ul>
</li>
<li>Clause <strong>groups</strong> tuples together based on the common value of columns.</li>
</ul>
<p><strong>HAVING</strong>:</p>
<ul>
<li>Clause <strong>filters</strong> out <strong>unwanted groups</strong> from the <strong>GROUP BY</strong> result set.</li>
</ul>
<hr>
<p><strong>Aggregate operators</strong></p>
<ul>
<li>avg                       </li>
<li>sum </li>
<li>min</li>
<li>count</li>
<li>max</li>
<li>…</li>
</ul>
<p><strong>[Example]</strong></p>
<p>Find the average account balance at each branch:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> b<span class="hljs-operator">-</span>name, <span class="hljs-built_in">AVG</span>(balance) <br><span class="hljs-keyword">FROM</span> Deposit <br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> b<span class="hljs-operator">-</span>name;<br></code></pre></td></tr></table></figure>
<blockquote>
<p><code>balance</code> first group according to the b-name, then be called by AVG();</p>
</blockquote>
<hr>
<h1 id="3-Relational-Algebra"><a href="#3-Relational-Algebra" class="headerlink" title="3 Relational Algebra"></a>3 Relational Algebra</h1><h2 id="3-1-Select-and-Project"><a href="#3-1-Select-and-Project" class="headerlink" title="3.1 Select and Project"></a>3.1 Select and Project</h2><h3 id="3-1-1-Select"><a href="#3-1-1-Select" class="headerlink" title="3.1.1 Select"></a>3.1.1 Select</h3><p><strong>SELECT</strong> operation: $\sigma$</p>
<ul>
<li>Similar to the <code>WHERE</code> clause in SQL;</li>
<li>Select <strong>tuples (horizontally)</strong> from a relation $R$ that satisfy a given condition $c$;<ul>
<li>$c$ is a Boolean expression over the attributes of $R$;</li>
</ul>
</li>
<li>The operation:</li>
</ul>
<script type="math/tex; mode=display">
\sigma_c(R)</script><ul>
<li>Return relation is $r(R)$ which is an instance of $R$.</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <br><span class="hljs-keyword">FROM</span> R<br><span class="hljs-keyword">WHERE</span> c;<br></code></pre></td></tr></table></figure>
<p><strong>[Example]</strong></p>
<p>$\sigma_{\text{DNO}=4}(\text{EMPLOYEE})$:<br>select the EMPLOYEE <strong>tuples</strong> whose department is 4</p>
<hr>
<h3 id="3-1-2-Project"><a href="#3-1-2-Project" class="headerlink" title="3.1.2 Project"></a>3.1.2 Project</h3><p><strong>PROJECT</strong> operation: $\pi$</p>
<ul>
<li>Similar to the <code>SELECT (DISTINCT)</code> clause in SQL;</li>
<li>Keeps only certain <strong>attributes (vertically)</strong> from a relation $R$ in an attribute list $L$;</li>
<li><strong>Eliminates duplicate</strong> tuples (As no duplicated element in SET)</li>
<li>The operation:</li>
</ul>
<script type="math/tex; mode=display">
\pi_L(R)</script><ul>
<li>Return relation only has the attributes of $R$ in $L$, and all tuples are <strong>distinct</strong>.</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> L1, L2, …, Ln <br><span class="hljs-keyword">FROM</span> R;<br></code></pre></td></tr></table></figure>
<p><strong>[Example]</strong></p>
<p>$\pi_{\text{SEX,SALARY}}(\text{EMPLOYEE})$:<br>If several male employees have salary 30000, only a single tuple $<M, 30000>$ is kept in the resulting relation.</M,></p>
<hr>
<h3 id="3-1-3-Rename"><a href="#3-1-3-Rename" class="headerlink" title="3.1.3 Rename"></a>3.1.3 Rename</h3><p><strong>Attributes</strong> can be rename in the view table for <strong>convenient</strong> in the later usage, which should keep in a <strong>same order</strong> with <strong>unchanged meanings</strong>.</p>
<p>[Example]</p>
<script type="math/tex; mode=display">
\text{DEPT-4-IN-EMPS}\leftarrow \sigma_{\text{DNO}=4}(\text{EMPLOYEE})\\</script><script type="math/tex; mode=display">
R(\text{FIRSTNAME, LASTNAME, SALARY}) \leftarrow \\ \pi_{\text{FIRSTNAME, LASTNAME, SALARY}}(\text{DEPT-4-IN-EMPS})</script><hr>
<h2 id="3-2-Set-Operations"><a href="#3-2-Set-Operations" class="headerlink" title="3.2 Set Operations"></a>3.2 Set Operations</h2><ul>
<li><strong>UNION</strong>: $R_1 \cap R_2$;</li>
<li><strong>INTERSECTION</strong>: $R_1 \cup R_2$;</li>
<li><strong>SET DIFFERENCE</strong>: $R_1 - R_2$;<blockquote>
<p>Above operations has <strong>Union compatibility</strong>:</p>
<ul>
<li>$R1$ and $R2$ must in a <strong>same size</strong>;</li>
<li>and the <strong>domains are same or compatible</strong>;</li>
<li>The result has <strong>some attributes name as $R1$</strong> (by convention)</li>
</ul>
</blockquote>
</li>
<li><strong>CARTESIAN PRODUCT</strong>: $R_1 \times R_2$;</li>
</ul>
<hr>
<h2 id="3-3-Join"><a href="#3-3-Join" class="headerlink" title="3.3 Join"></a>3.3 Join</h2><p>A very special case in <strong>Set Operations</strong>, the basic operation is <strong>CARTESIAN PRODUCT</strong>.</p>
<center><img src="/2022/12/13/database-systems-course-note/9.png" srcset="/img/loading.gif" lazyload width="70%"></center>

<hr>
<h3 id="3-3-1-CARTESIAN-PRODUCT"><a href="#3-3-1-CARTESIAN-PRODUCT" class="headerlink" title="3.3.1 CARTESIAN PRODUCT"></a>3.3.1 CARTESIAN PRODUCT</h3><ul>
<li><strong>CARTESIAN PRODUCT</strong> operation: $\times$</li>
<li>AKA <strong>CROSS PRODUCT</strong> or <strong>CROSS JOIN</strong>;</li>
<li><p>The operation: $R_1 \times R_2$</p>
<ul>
<li>The result $R$ contains <strong>each</strong> tuple in $R_1$ <strong>concatenate</strong> with <strong>every</strong> tuple in $R_2$;</li>
<li>$n_1$ tuples in $R_1$ and $n_2$ tuples in $R_2$, then $R$ has <strong>$n_1 \times n_2$ tuples</strong>;</li>
<li><p>Like:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">R = &#123;&#125;;<br><span class="hljs-keyword">for</span> (t1 <span class="hljs-keyword">in</span> R1):<br>    <span class="hljs-keyword">for</span> (t2 <span class="hljs-keyword">in</span> R2):<br>        t = t1 + t2<br>        R = R + t<br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p><strong>[Example]</strong></p>
<center><img src="/2022/12/13/database-systems-course-note/10.png" srcset="/img/loading.gif" lazyload width="70%"></center>

<hr>
<h3 id="3-3-2-THETA-JOIN"><a href="#3-3-2-THETA-JOIN" class="headerlink" title="3.3.2 THETA JOIN"></a>3.3.2 THETA JOIN</h3><ul>
<li><strong>THETA JOIN</strong> operation: $\bowtie_\theta$;</li>
<li>A special case of <strong>CARTESIAN PRODUCT</strong>, but followed by a <strong>SELECT</strong> operation based on a <strong>condition</strong> $\theta$;</li>
<li>The operation: $R_1 \bowtie_c R_2$<ul>
<li>it is equal to $\sigma_c(R_1\times R_2)$</li>
</ul>
</li>
</ul>
<hr>
<h3 id="3-3-3-EQUIJOIN-JOIN"><a href="#3-3-3-EQUIJOIN-JOIN" class="headerlink" title="3.3.3 EQUIJOIN JOIN"></a>3.3.3 EQUIJOIN JOIN</h3><ul>
<li><strong>EQUIJOIN</strong> operation: $\bowtie_=$;</li>
<li>A special case of <strong>THETA JOIN</strong>, but the <strong>condition(s)</strong> is(are) <strong>equality</strong>: $\text{attrA1=attrB2…}$</li>
<li>The operation: $R<em>1 \bowtie</em>=R_2$<ul>
<li>it is equal to $\sigma<em>{c}(R_1\times R_2)$ (e.g. $\sigma</em>{attr1==attr2}(R_1\times R_2)$)</li>
<li>where $c$ is like $(A_i=B_j) AND … AND (A_h=B_k); 1&lt;i,h&lt;m, 1&lt;j,k&lt;n$</li>
<li>$A_i$ and $B_j$ are called <strong>join attributes</strong>;</li>
</ul>
</li>
<li>Thus, the return relation will contains <strong>several attributes(columns) having same values</strong>;</li>
</ul>
<hr>
<h3 id="3-3-4-NATURAL-JOIN"><a href="#3-3-4-NATURAL-JOIN" class="headerlink" title="3.3.4 NATURAL JOIN"></a>3.3.4 NATURAL JOIN</h3><ul>
<li><strong>NATURAL JOIN</strong> operation: $*$;</li>
<li>A special case of <strong>EQUIJOIN</strong>, but the <strong>redundant</strong> attributes are <strong>eliminated</strong>;</li>
<li>The operation: $R<em>1 *</em>{\text{(J.A. of R1)(J.A. of R2)}} R_2$</li>
<li>Looking for the attributes <strong>having same attribute value</strong> and just <strong>keep one attribute of them</strong>;<ul>
<li>If they have <strong>same attribute name</strong>, <strong>no need to write</strong> in the statement</li>
</ul>
</li>
<li>Natural Join <strong>associative</strong>;<ul>
<li>$(R<em>S)</em>T=R<em>(S</em>T)$</li>
</ul>
</li>
<li>Originally, the join attributes need to have a same name. However, their names can be different as long as they have same tuple value in this attribute.</li>
<li>In a <strong>Recursive Relationship</strong> case:<ul>
<li>A relation can have a set of join attributes to join it with itself, like <strong>SUPERVISE</strong>;</li>
<li>We can <strong>rename</strong> firstly, then do the Recursive join to easily distinct are more clearly</li>
</ul>
</li>
</ul>
<hr>
<blockquote>
<p>A <strong>NATURAL JOIN</strong> can be specified as a <strong>CARTESIAN PRODUCT</strong> preceded by <strong>RENAME</strong> and followed by <strong>SELECT</strong> and <strong>PROJECT</strong> operations:</p>
</blockquote>
<p>Rcp(attr1, attr2, …) $\leftarrow$ $R_1 \times R_2$ <strong>(CARTESIAN PRODUCT)</strong><br>Req &lt;- $\sigma$<attr1 = attr2>(Rcp) <strong>(SELECT/EQUIJOIN)</strong><br>Rnj &lt;- $\pi$<attr2,...>(Req) <strong>(PROJECT to eliminate same attr1)</strong></attr2,...></attr1></p>
<hr>
<h2 id="3-3-Complete-Set"><a href="#3-3-Complete-Set" class="headerlink" title="3.3 Complete Set"></a>3.3 Complete Set</h2><p><strong>All the operations</strong> can be described as a sequence of <strong>only the following 5 operations</strong>:</p>
<ul>
<li><strong>SELECT</strong>: $\sigma$;</li>
<li><strong>PROJECT</strong>: $\pi$;</li>
<li><strong>UNION</strong>: $\cap$;</li>
<li><strong>SET DIFFERENCE</strong>: $-$;</li>
<li><strong>CARTESIAN PRODUCT</strong>: $\times$;</li>
</ul>
<p>For <strong>NATURAL JOIN</strong>: $<em>$, it can be described as a sequence of, <strong>$\times$</strong>, <strong>$\sigma$</strong>, <strong>$\pi$</strong>.<br>For <em>*INTERSECTION</em></em>: $\cup$, $=R_1\cup R_2-[(R_1-R_2)\cup (R_2 - R_1)]$</p>
<hr>
<ul>
<li><script type="math/tex; mode=display">
\{\sigma, \pi, \cap, -, \times\}</script></li>
<li><p>are the <strong><em>Complete Set</em></strong> of relational algebra operations.</p>
</li>
<li><p>Any query language equivalent to these operations is called <strong>relationally complete</strong>.</p>
</li>
<li><strong>Additional operations</strong> not part of the original relational algebra, like:<ul>
<li>Aggregate functions and grouping.</li>
<li>OUTER JOIN and OUTER UNION</li>
</ul>
</li>
</ul>
<hr>
<h1 id="4-Integrity-Constraints-amp-Normal-Forms"><a href="#4-Integrity-Constraints-amp-Normal-Forms" class="headerlink" title="4 Integrity Constraints &amp; Normal Forms"></a>4 Integrity Constraints &amp; Normal Forms</h1><h2 id="4-1-Integrity-Constraints"><a href="#4-1-Integrity-Constraints" class="headerlink" title="4.1 Integrity Constraints"></a>4.1 Integrity Constraints</h2><p>For</p>
<ul>
<li>Changes to the database do NOT cause a loss of consistency;</li>
<li>Conditions that must hold on ALL valid relation instances;</li>
</ul>
<blockquote>
<p>An <strong><em>integrity constraint (IC)</em></strong> can be an arbitrary condition about the database<br>In practice, they are limited to those that can be tested with minimal overhead</p>
</blockquote>
<p>Three types:</p>
<ul>
<li>Key constraints</li>
<li>Entity Integrity constraints</li>
<li>Referential Integrity Constraints</li>
</ul>
<h3 id="4-1-1-Key-constraints"><a href="#4-1-1-Key-constraints" class="headerlink" title="4.1.1 Key constraints"></a>4.1.1 Key constraints</h3><ul>
<li><strong><em>Superkey</em></strong> of <code>R</code>: <ul>
<li><code>SK</code>: a set of attributes;</li>
<li>For any distinct tuples <code>t1</code> and <code>t2</code> in <code>r(R)</code>, <code>t1[SK] &lt;&gt; t2[SK]</code>.</li>
<li>There NOT unique;</li>
</ul>
</li>
<li><strong><em>Candidate Key</em></strong>:<ul>
<li>a <em>minimal</em> superkey;</li>
<li>Superkey K such that <strong>removal of any attribute</strong> from K results in a set of attributes that is <strong>not a superkey</strong>.</li>
<li>may/not unique;</li>
</ul>
</li>
<li><strong><em>Primary Key</em></strong>:<ul>
<li>Choice one from the candidate keys by the DB designer when there are more than one candidate key;</li>
<li>Unique;</li>
</ul>
</li>
</ul>
<hr>
<h3 id="4-1-2-Entity-Integrity-constraints"><a href="#4-1-2-Entity-Integrity-constraints" class="headerlink" title="4.1.2 Entity Integrity constraints"></a>4.1.2 Entity Integrity constraints</h3><ul>
<li>Specify the set of possible values that may be associated with an attribute;</li>
<li>The <strong>Data type</strong> of each attribute;</li>
</ul>
<p>The <strong>primary key</strong> attributes PK of each relation schema R in S <strong>CANNOT</strong> have <strong><code>Null</code> values</strong>.</p>
<hr>
<h3 id="4-1-3-Referential-Integrity-Constraints"><a href="#4-1-3-Referential-Integrity-Constraints" class="headerlink" title="4.1.3 Referential Integrity Constraints"></a>4.1.3 Referential Integrity Constraints</h3><ul>
<li>A constraint involving <strong>two relations</strong>;</li>
<li>The relationship between <strong>referencing relation</strong> and the <strong>referenced relation</strong>;</li>
<li><strong>Ensure that a value appears in one relation also appears in another</strong>;</li>
<li>It is also called the <strong><em>Foreign Key Constraint</em></strong><ul>
<li>primary key on the <strong>foreign table</strong>；</li>
</ul>
</li>
</ul>
<p><strong>Subset</strong> dependency:</p>
<ul>
<li><code>SupperSet[PK]</code> $\supseteq$ <code>SubSet[Fpk]</code></li>
<li>To maintain the relation;</li>
</ul>
<p>Syntax:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">PK_Name <span class="hljs-type">Char</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>;<br><span class="hljs-keyword">PRIMARY</span> KEY (PK_Name);<br><span class="hljs-keyword">PRIMARY</span> KEY (PK_Name, PK_Other);<br><span class="hljs-keyword">FOREIGN</span> KEY (PK_Name) <span class="hljs-keyword">REFERENCES</span> PK_TABLE;<br></code></pre></td></tr></table></figure>
<hr>
<h3 id="4-1-4-IC-Usage-amp-Violation"><a href="#4-1-4-IC-Usage-amp-Violation" class="headerlink" title="4.1.4 IC Usage &amp; Violation"></a>4.1.4 IC Usage &amp; Violation</h3><p>Usage:</p>
<ul>
<li><code>INSERT</code> a tuple</li>
<li><code>DELETE</code> a tuple</li>
<li><code>MODIFY</code> a tuple </li>
</ul>
<p>Actions to Violation:</p>
<ul>
<li><strong>Cancel</strong> the operation that causes the violation;</li>
<li>Perform the operation but <strong>inform</strong> the user of the violation;</li>
<li><strong>Trigger additional updates</strong> so the violation is corrected;</li>
<li>Execute a <strong>user-specified error-correction</strong> routine;</li>
</ul>
<hr>
<h3 id="4-1-5-Functional-Dependency"><a href="#4-1-5-Functional-Dependency" class="headerlink" title="4.1.5 Functional Dependency"></a>4.1.5 Functional Dependency</h3><ul>
<li><strong><em>Functional Dependency (FD)</em></strong> : A <strong>particular</strong> kind of constraint that is on the set of “<strong>legal</strong>” relations </li>
</ul>
<p>For two <strong>attributes set</strong> $\alpha$ and $\beta$ in R, for any two tuples $t_1$ and $t_2$:</p>
<script type="math/tex; mode=display">
(t_1[\alpha]=t_2[\alpha]) \implies (t_1[\beta]=t_2[\beta])\\
\Downarrow \\
\alpha \to \beta</script><ul>
<li>$\alpha$ is a <strong>candidate key</strong> of R</li>
<li>$\alpha$ <strong>functional(uniquely) determines</strong> $\beta$</li>
<li>[Example]:<ul>
<li>Loan# $\to$ Amount.</li>
</ul>
</li>
</ul>
<p>Usage:</p>
<ul>
<li>To set constraints on legal relations;</li>
<li>To test relations to see if they are “legal” under a given set of FDs;</li>
<li>To be used in <strong>designing the database schema</strong>.</li>
</ul>
<hr>
<h4 id="4-1-5-1-Inference-Rules-for-FDs"><a href="#4-1-5-1-Inference-Rules-for-FDs" class="headerlink" title="4.1.5.1 Inference Rules for FDs"></a>4.1.5.1 Inference Rules for FDs</h4><ul>
<li><strong>IR1 - Reflexive</strong>: $Y \subseteq X \implies X\to Y$;</li>
<li><strong>IR2 - Augmentation</strong>: $X\to Y \implies XZ\to YZ$ ($YZ=Y\cup Z$);</li>
<li><strong>IR3 - Transitive</strong>: $X\to Y \wedge Y\to Z \implies X\to Z$;</li>
</ul>
<p>IR1, IR2, IR3 form a <strong>sound and complete</strong> set of inference rules:</p>
<ul>
<li>Sound: These rules are true;</li>
<li>Complete: All the other rules that are true can be deduced from these rules.</li>
</ul>
<p>Additional inference rules: </p>
<ul>
<li><strong>Decomposition</strong>: $X\to YZ \implies X\to Y \wedge X\to Z$;</li>
<li><strong>Union</strong>: $X\to Y \wedge X\to Z \implies X\to YZ$;</li>
<li><strong>Psuedotransitivity</strong>: $X\to Y \wedge WY\to Z \implies WX\to Z$;</li>
</ul>
<hr>
<h4 id="4-1-5-2-Closure"><a href="#4-1-5-2-Closure" class="headerlink" title="4.1.5.2 Closure"></a>4.1.5.2 Closure</h4><p><strong>Closure of a set $F$</strong> of FDs is the set $F^+$ of all FDs that can be inferred from $F$:</p>
<ul>
<li>$F^+={F\text{, inferred from }F}$</li>
</ul>
<p><strong>Closure of a set of attributes $X$</strong> with respect to $F$ is the set $X^+$ of all attributes that are functionally determined by $X$;</p>
<blockquote>
<p>$X^+$ can be calculated by repeatedly applying <strong>IR1, IR2, IR3</strong> using the FDs in $F$;</p>
</blockquote>
<hr>
<h4 id="4-1-5-3-Equivalence"><a href="#4-1-5-3-Equivalence" class="headerlink" title="4.1.5.3 Equivalence"></a>4.1.5.3 Equivalence</h4><p>$F$ and $G$ are equivalent if $F^+=G^+$:</p>
<ul>
<li>Every FD in $F$ can be inferred from $G$, and</li>
<li>Every FD in $G$ can be inferred from $F$.</li>
</ul>
<p><strong>[Example]</strong></p>
<p>F: {A$\to$ BC} G: {A$\to$B, A$\to$C} are equivalent.</p>
<p>For<br>$F^+$ = {A$\to$BC, A$\to$B, A$\to$C}<br>$G^+$ = {A$\to$BC, A$\to$B, A$\to$C}</p>
<hr>
<h2 id="4-2-Normalization"><a href="#4-2-Normalization" class="headerlink" title="4.2 Normalization"></a>4.2 Normalization</h2><p>Properties:</p>
<ul>
<li><strong>Non-additive or lossless join</strong><ul>
<li>lossless join:<ul>
<li>No spurious tuples (tuples that should not exist)<br>should be generated by doing a natural-join of any relations.</li>
</ul>
</li>
</ul>
</li>
<li>Preservation of the functional dependencies.</li>
</ul>
<hr>
<h3 id="4-2-1-First-Normal-Form-1NF"><a href="#4-2-1-First-Normal-Form-1NF" class="headerlink" title="4.2.1 First Normal Form - 1NF"></a>4.2.1 First Normal Form - 1NF</h3><ul>
<li><p>All underlying domains <strong>contain atomic values only</strong>;</p>
<ul>
<li><center><img src="/2022/12/13/database-systems-course-note/11.png" srcset="/img/loading.gif" lazyload width="70%"></center>
</li>
</ul>
</li>
<li><p>Problems:</p>
<ul>
<li><strong>Insert Anomalies</strong><ul>
<li>Inability to represent certain information</li>
<li>Cannot insert Status and City” without insert Supply#, must together;</li>
</ul>
</li>
<li><strong>Delete Anomalies</strong><ul>
<li>Deleting the “only tuple” for a supplier will destroy all the information about that supplier;</li>
</ul>
</li>
<li><strong>Update Anomalies</strong><ul>
<li>“S# and City” could be redundantly represented for each P#, which may cause potential inconsistency when updating a tuple</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h3 id="4-2-2-Second-Normal-Form-2NF"><a href="#4-2-2-Second-Normal-Form-2NF" class="headerlink" title="4.2.2 Second Normal Form - 2NF"></a>4.2.2 Second Normal Form - 2NF</h3><blockquote>
<p><strong>Definition</strong>. A relation schema R is in 2NF if <strong>every nonprime attribute</strong> A in R is <strong>fully</strong> functionally dependent on the <strong>primary key</strong> of R.</p>
<ul>
<li><strong>NOT partially</strong> dependent on <strong>any key</strong> of R</li>
</ul>
<p><strong><em>How to test</em></strong>:</p>
<ul>
<li>For relations where <strong>primary key</strong> contains <strong>multiple attributes</strong>, <strong>NO nonkey attribute</strong> should be functionally dependent on a <strong>part of the primary key</strong>.</li>
</ul>
<p><strong><em>How to become 2NF</em></strong>:</p>
<ul>
<li>Set up a new relation for <strong>each partial key</strong> with its <strong>dependent attribute(s)</strong>.</li>
<li>And, keep a relation with the <strong>original primary key</strong> and any attributes that are <strong>fully</strong> functionally dependent on it.</li>
</ul>
</blockquote>
<ul>
<li><strong>1NF</strong> and,</li>
<li>Every <strong>non-key attribute</strong> is <strong>fully dependent</strong> on <strong>any candidate key</strong>;<ul>
<li>Must all on candidate key, not partial key;</li>
<li><center><img src="/2022/12/13/database-systems-course-note/12.png" srcset="/img/loading.gif" lazyload width="70%"></center></li>
</ul>
</li>
<li>Similar problems in 1NF;</li>
</ul>
<hr>
<h3 id="4-2-3-Third-Normal-Form-3NF"><a href="#4-2-3-Third-Normal-Form-3NF" class="headerlink" title="4.2.3 Third Normal Form - 3NF"></a>4.2.3 Third Normal Form - 3NF</h3><blockquote>
<p><strong>Definition</strong>. A relation schema R is in third normal form (3NF) if, whenever a <strong>nontrivial functional dependency X $\to$ A holds in R</strong>, <strong>either ONE</strong> is true:</p>
<ul>
<li>(a) <strong>X is a superkey</strong> of R, or </li>
<li>(b) <strong>A is a prime attribute</strong> of R<br>(NO: nonkey $\to$ nonkey (transitive))</li>
</ul>
<p>!!! note It allows key attribute(s) to be determined by non-super key.  (RHS can be a prime attribute)</p>
<p><strong><em>How to test</em></strong>:</p>
<ul>
<li>NOT have a <strong>nonkey attribute</strong> $\to$ another <strong>nonkey attribute</strong> (or by a set of nonkey attributes). </li>
<li>That is, there should be <strong>NO transitive dependency of a nonkey attribute on the primary key</strong>.</li>
</ul>
<p>How to become 3NF:</p>
<ul>
<li>Set up a relation that includes the <strong>nonkey attribute(s)</strong> that functionally determine(s) other <strong>nonkey attribute(s)</strong>.</li>
</ul>
</blockquote>
<ul>
<li><strong>2NF</strong> and,</li>
<li>Every <strong>non-key attribute</strong> is <strong>non-transitively dependent</strong> on <strong>any candidate key</strong>;</li>
<li><ul>
<li>Can not have IR3 among non-key attributes;</li>
<li>IR3. (Transitive) If X -&gt; Y and Y -&gt; Z, then X -&gt; Z</li>
<li><center><img src="/2022/12/13/database-systems-course-note/13.png" srcset="/img/loading.gif" lazyload width="70%"></center></li>
</ul>
</li>
<li>In general, 3NF is desirable and powerful enough.</li>
</ul>
<hr>
<h3 id="4-2-4-Boyce-Codd-Normal-Form-BCNF"><a href="#4-2-4-Boyce-Codd-Normal-Form-BCNF" class="headerlink" title="4.2.4 Boyce-Codd Normal Form - BCNF"></a>4.2.4 Boyce-Codd Normal Form - BCNF</h3><blockquote>
<p><strong>Definition</strong>. A relation schema R is in BCNF if whenever a nontrivial functional dependency X $\to$ A holds in R, then <strong>X is a superkey of R</strong>.</p>
</blockquote>
<p>!!! note It <strong>DO NOT</strong> allow key attribute(s) to be determined by non-super key.  (RHS CAN NOT be a prime key, and LHS is a non-super key)</p>
<ul>
<li><strong>Every</strong> determinant (left-hand side of an FD, $\alpha$) is a <strong>candidate key</strong>.<ul>
<li><center><img src="/2022/12/13/database-systems-course-note/14.png" srcset="/img/loading.gif" lazyload width="70%"></center></li>
</ul>
</li>
<li></li>
</ul>
<hr>
<h3 id="4-2-5-NFs-Defined-Informally"><a href="#4-2-5-NFs-Defined-Informally" class="headerlink" title="4.2.5 NFs Defined Informally"></a>4.2.5 NFs Defined Informally</h3><ul>
<li>1NF:<ul>
<li><strong>Atomic</strong> values;</li>
<li><strong>Dependent on the key</strong>.</li>
</ul>
</li>
<li>2NF:<ul>
<li>All <strong>non-key attributes</strong> depend on the <strong>entire(candidate) key</strong>;</li>
<li><strong>May</strong> have some <strong>inferences</strong> among <strong>non-key attributes</strong>.</li>
</ul>
</li>
<li>3NF:<ul>
<li>All <strong>non-key attributes</strong> <strong>ONLY</strong> depend on the key;</li>
<li><strong>NO</strong> <strong>inference</strong> between <strong>non-key attributes</strong>.</li>
</ul>
</li>
<li>BCNF:<ul>
<li><strong>stronger</strong> than 3NF;</li>
<li><strong>Useful</strong> when a relation has:<ul>
<li><strong>multiple</strong> candidate keys, and</li>
<li>these candidate keys are <strong>composite</strong> ones, and</li>
<li>they <strong>overlap</strong> on some common <strong>attributes</strong>.</li>
</ul>
</li>
<li>BCNF reduces to 3NF if the above conditions do not apply.</li>
</ul>
</li>
</ul>
<hr>
<h3 id="4-2-6-Decomposition"><a href="#4-2-6-Decomposition" class="headerlink" title="4.2.6 Decomposition"></a>4.2.6 Decomposition</h3><p>Split R into higher NF:</p>
<p>For each FD $A \to b$ that <strong>violates</strong> the definition of the normal form, then decompose $R$ into:</p>
<p>$R_1 = (A, b)$, and $R_2=(R-{b})$. </p>
<p>Repeat above process to $R_1$ and $R_2$ until all tables are in the normal form.</p>
<hr>
<h1 id="5-File-Organization-and-Indexing"><a href="#5-File-Organization-and-Indexing" class="headerlink" title="5 File Organization and Indexing"></a>5 File Organization and Indexing</h1><h2 id="5-1-Disk-Storage-Devices"><a href="#5-1-Disk-Storage-Devices" class="headerlink" title="5.1 Disk Storage Devices"></a>5.1 Disk Storage Devices</h2><ul>
<li><strong>Disk surfaces</strong>: Data stored as magnetized areas on;</li>
<li><strong>Disk pack</strong>: Contains several magnetic disks;</li>
<li><strong>Track</strong>: A concentric circular path on a disk surface, 4 to 50 K bytes;</li>
<li><strong>Blocks</strong>: Division of tracks into fixed-size chunks, block size: from B=512 bytes to B=4096 bytes;</li>
<li><strong>Block</strong> is the <strong>unit</strong> of data transfer between disk and memory.</li>
<li><strong>Physical disk block address</strong>: surface number &amp; track number &amp; block number;</li>
</ul>
<hr>
<h2 id="5-2-Files-of-Records"><a href="#5-2-Files-of-Records" class="headerlink" title="5.2 Files of Records"></a>5.2 Files of Records</h2><ul>
<li><strong>File</strong>: a sequence of <strong>records</strong>(a collection of data values (or data items));</li>
<li><strong>File descriptor (file header)</strong>: information that describes the file:<ul>
<li>field names; </li>
<li>data types;</li>
<li>addresses of the file blocks on the disk.</li>
</ul>
</li>
<li><strong><em>Blocking Factor</em></strong>(bfr): the (average) number of file records stored in a disk block:</li>
</ul>
<blockquote>
<p><strong>Block size</strong> is $B$ bytes. For a <strong>file</strong> of fixed-length records of size $R$ bytes, with $B \ge R$</p>
<script type="math/tex; mode=display">
\text{bfr} = \lfloor \frac{B}{R}\rfloor</script></blockquote>
<ul>
<li><strong>Fixed-length records</strong>: Every record in the file has <strong>exactly the same size</strong>;</li>
<li><strong>Variable-length records</strong>: Different records in the file <strong>have different sizes</strong>;</li>
<li><strong>Spanned</strong>: Records <strong>can span more than one block</strong>: <ul>
<li>A pointer at the end of the first block points to the block containing the remainder of the record in case it is not the next consecutive block on disk.</li>
</ul>
</li>
<li><p><strong>Unspanned</strong>: Records are <strong>not allowed to cross block boundaries</strong>:</p>
<ul>
<li><p>having $B \gt R$ because it makes each record start at a known location in the block, simplifying record processing</p>
</li>
<li><center><img src="/2022/12/13/database-systems-course-note/15.png" srcset="/img/loading.gif" lazyload width="70%"></center>
</li>
</ul>
</li>
<li><p>Usually:</p>
<ul>
<li><strong>Fixed</strong>-length records use <strong>unspanned</strong> files;</li>
<li><strong>Variable</strong>-length records use <strong>spanned</strong> files.</li>
</ul>
</li>
<li><p>records of a file can be </p>
<ul>
<li><strong>contiguous</strong>: array;</li>
<li><strong>linked</strong>: linked list, tree;</li>
<li><strong>indexed</strong>: hash table;</li>
</ul>
</li>
</ul>
<h3 id="5-2-1-Typical-Operations-on-Files"><a href="#5-2-1-Typical-Operations-on-Files" class="headerlink" title="5.2.1 Typical Operations on Files"></a>5.2.1 Typical Operations on Files</h3><ul>
<li><strong>OPEN</strong>: Make the file ready for access, and associates a pointer that will refer to a current file record at each point in time. <ul>
<li>Pointer $\to$ the current file;</li>
</ul>
</li>
<li><strong>FIND</strong>: Searches for the first file record that satisfies a certain condition, and makes it the current file record. </li>
<li><strong>FINDNEXT</strong>: Searches for the next file record (from the current record) that satisfies a certain condition, and makes it the current file record. </li>
<li><strong>READ</strong>: Reads the current file record into a program variable. </li>
<li><strong>INSERT</strong>: Inserts a new record into the file, and makes it the current file record.</li>
<li><strong>DELETE</strong>: Removes the current file record from the file, usually by marking the record as <strong>no longer valid</strong>. </li>
<li><strong>MODIFY</strong>: Changes the values of some fields of the current file record. </li>
<li><strong>CLOSE</strong>: Terminates access to the file. </li>
<li><strong>REORGANIZE</strong>: Reorganizes the file records: e.g., the records marked as deleted are physically removed from the file; new organization of the file records is created. <ul>
<li>Like Garbage Collection(GC)</li>
</ul>
</li>
<li><strong>READ_ORDERED</strong>: Read the file blocks in order of a specific field of the file.</li>
</ul>
<hr>
<p><strong>File organizations</strong></p>
<h3 id="5-2-2-Unordered-Files"><a href="#5-2-2-Unordered-Files" class="headerlink" title="5.2.2 Unordered Files"></a>5.2.2 Unordered Files</h3><ul>
<li>Pile file;</li>
<li>New records are <strong>inserted</strong> at the <strong>end</strong>;</li>
<li><strong><em>Linear Search</em></strong> in $O(n)$, expensive;</li>
<li><strong>Insertion</strong> in $O(1)$, efficient;</li>
<li><strong>READ_ORDERED</strong> require <strong>sorting</strong>, expensive;</li>
</ul>
<hr>
<h3 id="5-2-3-Ordered-Files"><a href="#5-2-3-Ordered-Files" class="headerlink" title="5.2.3 Ordered Files"></a>5.2.3 Ordered Files</h3><ul>
<li>Sequential file;</li>
<li>Kept <strong>sorted</strong> by the values of an ordering field;</li>
<li><strong>Insertion</strong> is expensive: for maintain the order/position;</li>
<li><strong>Searching</strong> is easy with <strong><em>Binary Search</em></strong> in $O(\log n)$;</li>
<li><strong>READ_ORDERED</strong> according to the order, efficient;</li>
</ul>
<hr>
<h3 id="5-2-4-Hashed-Files"><a href="#5-2-4-Hashed-Files" class="headerlink" title="5.2.4 Hashed Files"></a>5.2.4 Hashed Files</h3><ul>
<li><strong>External Hashing</strong>: Hashing for disk files;</li>
<li><strong><em>Buckets</em></strong>: The file <strong>blocks</strong> are divided into M <strong>equal-sized</strong> buckets;<ul>
<li>Typically, a bucket corresponds to one (or a fixed number of) disk block;</li>
</ul>
</li>
<li><strong><em>Hash Key</em></strong> is designated for each file;</li>
<li><strong><em>Hashing Function</em></strong>: $i=h(K)$:<ul>
<li>The record with <strong>hash key value $K$</strong> is stored in <strong>bucket $i$</strong>;</li>
<li>It should distribute the records <strong>uniformly</strong> among the buckets;</li>
</ul>
</li>
<li><strong>Search</strong> is very <strong>efficient</strong> on the hash key;<ul>
<li>First, based on the hash key $K$, using the hash function to find the bucket index $i = h(K)$;</li>
<li>$Bucket_{i}$ is where the target record is stored in;</li>
<li>Then, use linear search in $Bucket_{i}$ to find the target record, which is much faster than linear search in the whole file;</li>
</ul>
</li>
<li><strong><em>Collisions</em></strong>: A new record hashes to a bucket that is already full:<ul>
<li>e.g. $h(K_1)=h(K_2)$;</li>
</ul>
</li>
</ul>
<p>Disadvantages:</p>
<ul>
<li><strong>Fixed</strong> number of buckets M is a problem when the number of records in the file <strong>grows or shrinks</strong>.</li>
</ul>
<hr>
<h4 id="5-2-4-1-Collision-Resolution"><a href="#5-2-4-1-Collision-Resolution" class="headerlink" title="5.2.4.1 Collision Resolution"></a>5.2.4.1 Collision Resolution</h4><ul>
<li><strong>Open addressing</strong>:<br>Checks the <strong>subsequent positions</strong> in order until an unused (empty) <strong>position is found</strong>.<ul>
<li><strong><em>Linear Probing</em></strong>:<ul>
<li>If $Bucket<em>{id}$ collide, try $Bucket</em>{id+1}$, $Bucket<em>{id+2}$, $Bucket</em>{id+3}$,…</li>
<li><center><img src="/2022/12/13/database-systems-course-note/16.png" srcset="/img/loading.gif" lazyload width="70%"></center></li>
</ul>
</li>
<li><strong><em>Quadratic Probing</em></strong>:<ul>
<li>If $Bucket<em>{id}$ collide, try $Bucket</em>{id+1}$, $Bucket<em>{id+4}$, $Bucket</em>{id+8}$,…</li>
<li>Evenly more buckets;</li>
<li><center><img src="/2022/12/13/database-systems-course-note/17.png" srcset="/img/loading.gif" lazyload width="70%"></center></li>
</ul>
</li>
</ul>
</li>
<li><strong>Chaining</strong>:<ul>
<li>Various <strong>overflow</strong> locations are <strong>kept</strong>, usually by <strong>extending the array</strong> with a number of overflow positions;</li>
<li>A <strong>pointer</strong> field is added to each <strong>record location</strong>.</li>
<li><center><img src="/2022/12/13/database-systems-course-note/18.png" srcset="/img/loading.gif" lazyload width="70%"></center>

</li>
</ul>
</li>
</ul>
<hr>
<h4 id="5-2-4-1-Dynamic-and-Extendible-Hashing"><a href="#5-2-4-1-Dynamic-and-Extendible-Hashing" class="headerlink" title="5.2.4.1 Dynamic and Extendible Hashing"></a>5.2.4.1 Dynamic and Extendible Hashing</h4><ul>
<li><p>Use the <strong>binary representation</strong> of the hash value h(K) in order to access a directory.</p>
<ul>
<li>Dynamic hashing: <strong>binary tree</strong>;<ul>
<li><center><img src="/2022/12/13/database-systems-course-note/19.png" srcset="/img/loading.gif" lazyload width="70%"></center></li>
</ul>
</li>
<li>Extendible hashing: <strong>array</strong> of size $2^d$ where $d$ is called the <strong>global depth</strong>.<ul>
<li><center><img src="/2022/12/13/database-systems-course-note/20.png" srcset="/img/loading.gif" lazyload width="70%"></center>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Insertion</strong> in a bucket that is <strong>full</strong> causes the bucket to <strong>split</strong> into two buckets and the records are <strong>redistributed</strong> among the two buckets.</p>
<ul>
<li>e.g., <code>01X</code> is full, then a new record adds in, <code>01X</code> will split into <code>010X</code> and <code>011X</code>, and the records will be redistributed into <code>010X</code> and <code>011X</code>;</li>
</ul>
</li>
<li>Do <strong>not</strong> require an overflow area.</li>
</ul>
<hr>
<h2 id="5-3-Indexes-as-Access-Paths"><a href="#5-3-Indexes-as-Access-Paths" class="headerlink" title="5.3 Indexes as Access Paths"></a>5.3 Indexes as Access Paths</h2><ul>
<li>form of an <strong>index</strong> is a <strong>file</strong> of entries of: <ul>
<li>$&lt;\text{Field value, Pointer to record}&gt;$;</li>
<li><strong><em>Ordered</em></strong> by field value;</li>
</ul>
</li>
<li>Index is called an <strong><em>Access Path</em></strong> on the field;</li>
<li><strong>Binary Search</strong> on the index yields a pointer to the file record</li>
</ul>
<p><strong>[Example]</strong>:</p>
<p>Searching in the file of </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">EMPLOYEE (NAME, SSN, ADDRESS, JOB, SAL, ... )<br></code></pre></td></tr></table></figure>
<p>Suppose that:</p>
<ul>
<li>record size $R$=150 bytes;</li>
<li>block size $B$=512 bytes;</li>
<li>Number of record $r$=30000 records;</li>
</ul>
<p>For <strong>Linear Search</strong>:</p>
<ul>
<li>Blocking factor Bfr $= \lfloor\frac{B}{R}\rfloor= \lfloor\frac{512}{150}\rfloor= 3$ records/block;</li>
<li>Number of file blocks $b= \frac{r}{Bfr}= \frac{30000}{3}= 10000$ blocks</li>
<li>Cost in $\Theta(\frac{b}{2}) = \frac{10000}{2}=$ <strong>5000 block accesses</strong>;</li>
</ul>
<p>For <strong>Binary Search</strong> on the <code>SSN</code> index:</p>
<blockquote>
<p>Assume the field size $V_{SSN}=9$ bytes, and the record pointer size $P_R=7$ bytes.</p>
</blockquote>
<ul>
<li>Index entry size $R<em>I=(V</em>{SSN}+ P_R)=(9+7)=16$ bytes</li>
<li>Index blocking factor Bfr$_i$ $= \lfloor\frac{B}{R_i}\rfloor= \lfloor\frac{512}{16}\rfloor= 32$ records/block;</li>
<li>Number of index blocks $b= \frac{r}{Bfr_i}= \frac{30000}{32}= 938$ blocks</li>
<li>Cost in $O(\log_2b) = \log_2938$ = 10 block accesses + 1 get file block = <strong>11 block accesses</strong>;</li>
</ul>
<hr>
<h2 id="5-4-Primary-Index"><a href="#5-4-Primary-Index" class="headerlink" title="5.4 Primary Index"></a>5.4 Primary Index</h2><ul>
<li>Defined on an <strong>ordered</strong> data file;</li>
<li>Ordered on a <strong>key</strong> field;</li>
<li>The key field value point to the <strong><em>first</em> record in each block</strong>, which is called the block <em>anchor</em>; </li>
</ul>
<center><img src="/2022/12/13/database-systems-course-note/21.png" srcset="/img/loading.gif" lazyload width="70%"></center>

<hr>
<h2 id="5-5-Clustering-Index"><a href="#5-5-Clustering-Index" class="headerlink" title="5.5 Clustering Index"></a>5.5 Clustering Index</h2><ul>
<li>Defined on an <strong>ordered</strong> data file;</li>
<li>Ordered on a <strong>non-key</strong> field;</li>
<li>The key field value point to the <strong>first data</strong> block of each <strong>distinct</strong> value of the field;</li>
</ul>
<center><img src="/2022/12/13/database-systems-course-note/22.png" srcset="/img/loading.gif" lazyload width="70%"></center>

<ul>
<li>Also can use <strong>separated</strong> block for each distinct value:</li>
</ul>
<center><img src="/2022/12/13/database-systems-course-note/23.png" srcset="/img/loading.gif" lazyload width="70%"></center>

<hr>
<h2 id="5-6-Secondary-Index"><a href="#5-6-Secondary-Index" class="headerlink" title="5.6 Secondary Index"></a>5.6 Secondary Index</h2><blockquote>
<p>Provides a <strong>secondary means (layers)</strong> of accessing a file for which some primary access already exists </p>
</blockquote>
<ul>
<li>Secondary index may be on a <strong>candidate</strong> key field or a <strong>non-key field</strong>;</li>
</ul>
<p>The <strong><em>Ordered Index File</em></strong> has two fields:</p>
<ul>
<li><strong>Non-ordering field</strong> (ie.,the indexing field) of the data file;</li>
<li><strong>Block pointer</strong> or a <strong>Record pointer</strong>;</li>
<li>Dense index: Include <strong>one entry for each record</strong> in the data file;</li>
</ul>
<p><strong>[Example]</strong>:</p>
<ul>
<li>Secondary Index on <strong>candidate</strong> key:<ul>
<li><center><img src="/2022/12/13/database-systems-course-note/24.png" srcset="/img/loading.gif" lazyload width="70%"></center></li>
</ul>
</li>
<li>Secondary Index on <strong>non-key</strong> field:<ul>
<li><center><img src="/2022/12/13/database-systems-course-note/25.png" srcset="/img/loading.gif" lazyload width="70%"></center>


</li>
</ul>
</li>
</ul>
<hr>
<h2 id="5-7-Multi-Level-Indexes"><a href="#5-7-Multi-Level-Indexes" class="headerlink" title="5.7 Multi-Level Indexes"></a>5.7 Multi-Level Indexes</h2><ul>
<li><strong>Original index file</strong> is called the <strong>first-level index</strong>;</li>
<li><strong>The index to the index</strong> is called the <strong>second-level index</strong>;</li>
</ul>
<center><img src="/2022/12/13/database-systems-course-note/26.png" srcset="/img/loading.gif" lazyload width="70%"></center>

<ul>
<li>A multi-level index can be created for any type of first-level index (primary, secondary, clustering) as long as the <strong>first-level index consists of more than one disk block</strong>;</li>
<li>Such a multi-level index is a form of <strong><em>Search Tree</em></strong>;</li>
</ul>
<center><img src="/2022/12/13/database-systems-course-note/27.png" srcset="/img/loading.gif" lazyload width="70%"></center>
<center><img src="/2022/12/13/database-systems-course-note/28.png" srcset="/img/loading.gif" lazyload width="70%"></center>

<ul>
<li>p = n means n pointers from a node to its children;</li>
</ul>
<hr>
<h2 id="5-8-B-Trees-and-B-Trees"><a href="#5-8-B-Trees-and-B-Trees" class="headerlink" title="5.8 B Trees and B+ Trees"></a>5.8 B Trees and B+ Trees</h2><p><strong>B Tree</strong>: Balanced Tree;</p>
<ul>
<li>a special type of self-balancing search tree in which each node can contain more than one key and can have more than two children. It is a generalized form of the binary search tree.</li>
</ul>
<hr>
<ul>
<li>Multi-level indexes use B tree or B + tree data structures, which <strong>leave space in each tree node (disk block) to allow for new index entries</strong>;</li>
<li>Node is kept between <strong>half-full</strong> and <strong>completely full</strong>;</li>
</ul>
<hr>
<p>Operation:</p>
<ul>
<li><strong>Insertion</strong>:<ul>
<li>Not full: quite efficient;</li>
<li>Full: Insertion causes a node <strong><em>split</em></strong> into two nodes;</li>
</ul>
</li>
<li><strong>Deletion</strong>:<ul>
<li>Not less than half full: quite efficient;</li>
<li>Less than half full: <strong>merged</strong> with neighboring nodes;</li>
</ul>
</li>
</ul>
<hr>
<h3 id="5-8-1-B-Tree"><a href="#5-8-1-B-Tree" class="headerlink" title="5.8.1 B Tree"></a>5.8.1 B Tree</h3><blockquote>
<p>Pointers to <strong>data records</strong> exist at <strong>all levels</strong> of the tree.</p>
</blockquote>
<script type="math/tex; mode=display">
<P1 , <K_1 , Pr_1 >, P_2 , <K_2 , Pr_2 >, … , <K_{q–1} , Pr_{q–1} >, P_q ></script><ul>
<li>$P$ is the tree pointer;</li>
<li>$Pr$ is the data pointer;</li>
<li>$K$ is the key field;</li>
<li>Each node has <strong>at most</strong> <strong>$p$ tree pointers</strong>;<ul>
<li>Each <strong>node</strong>, except the root and leaf nodes, has at least <strong>$⎡(p/2)⎤$ tree pointers</strong>;</li>
<li>The <strong>root</strong> node has <strong>at least two tree pointers</strong> unless it is the only node in the tree;</li>
</ul>
</li>
<li>A node with <strong>$q$ tree pointers</strong>, $q ≤ p$, has <strong>$q − 1$ search key field</strong> values;</li>
</ul>
<p><strong>[Example]</strong>:</p>
<center><img src="/2022/12/13/database-systems-course-note/29.png" srcset="/img/loading.gif" lazyload width="80%"></center>

<hr>
<h3 id="5-8-2-B-Tree"><a href="#5-8-2-B-Tree" class="headerlink" title="5.8.2 B+ Tree"></a>5.8.2 B+ Tree</h3><blockquote>
<p>All pointers to <strong>data records</strong> exists <strong>only</strong> at the <strong>leaf-level</strong> nodes<br>dDta pointers are stored only at the leaf nodes of the tree;<br><strong>Order</strong>-sensitive;</p>
</blockquote>
<p>For each <strong>internal</strong> node:</p>
<ul>
<li><p>No data pointer inside:</p>
<script type="math/tex; mode=display">
<P_1 , K_1 , P_2 , K_2 , … , P_{q − 1} , K_{q −1} , P_q ></script></li>
<li><p>$P_i$ is a <strong>tree pointer</strong>;</p>
</li>
<li><strong>Internal</strong> node has <strong>at most $p$ tree pointers</strong>;</li>
<li>Each <strong>internal</strong> node has <strong>at most</strong> <strong>$p$ tree pointers</strong>;<ul>
<li>Each <strong>node</strong>, except the root and leaf nodes, has at least <strong>$⎡(p/2)⎤$ tree pointers</strong>;</li>
<li>The <strong>root</strong> node has <strong>at least two tree pointers</strong> unless it is the only node in the tree;</li>
</ul>
</li>
<li>A node with <strong>$q$ tree pointers</strong>, $q ≤ p$, has <strong>$q − 1$ search key field</strong> values;</li>
</ul>
<p>For each <strong>leaf</strong> node:</p>
<script type="math/tex; mode=display">
<<K_1 , Pr_1 >, <K_2 , Pr_2 >, … , <K_{q−1} , Pr_{q−1} >, P_{next} ></script><ul>
<li>$Pr_i$ is a data pointer;</li>
<li>$P_{next}$ points to the <strong>next leaf node</strong> of the B+ -tree;</li>
<li>Each <strong>leaf</strong> node has <strong>at least $⎡(p/2)⎤$ values</strong>;</li>
<li>All <strong>leaf</strong> nodes are at the <strong>same level</strong>.</li>
</ul>
<p><strong>[Example]</strong>:</p>
<center><img src="/2022/12/13/database-systems-course-note/29.png" srcset="/img/loading.gif" lazyload width="80%"></center>

<hr>
<p>Example <strong>Insertion</strong> in a B+ Tree</p>
<ul>
<li>Every <strong>key value</strong> must exist at the <strong>leaf level</strong>, because all data pointers are at the leaf level;</li>
<li>Every value appearing in an <strong>internal node</strong> also appears as the <strong>rightmost value in the leaf level</strong> of the subtree;</li>
</ul>
<center><img src="/2022/12/13/database-systems-course-note/31.png" srcset="/img/loading.gif" lazyload width="80%"></center>


<hr>
<p>Example <strong>Deletion</strong> in a B+ Tree</p>
<ul>
<li>Merge:<ul>
<li><strong>redistribute</strong> the entries among the node and its <strong>sibling</strong> so that both are at least half full;</li>
</ul>
</li>
<li>Try to redistribute entries with the <strong>left</strong> sibling; <ul>
<li>if this is not possible, an attempt to <strong>redistribute</strong> with the <strong>right</strong> sibling is made. </li>
<li>If this is also not possible, the three nodes are <strong>merged into two leaf nodes</strong>.</li>
</ul>
</li>
</ul>
<center><img src="/2022/12/13/database-systems-course-note/32.png" srcset="/img/loading.gif" lazyload width="80%"></center>

<hr>
<h1 id="6-Query-Optimization"><a href="#6-Query-Optimization" class="headerlink" title="6 Query Optimization"></a>6 Query Optimization</h1><ul>
<li><strong>Scanner</strong> identifies the query tokens—such as SQL keywords, attribute names, and relation names—that appear in the text of the query,</li>
<li><strong>Parser</strong> checks the query <strong>syntax</strong> to determine whether it is formulated according to the syntax <strong>rules</strong> (rules of grammar) of the query language. </li>
<li><strong>Validate</strong> by checking that all attribute and relation names are <strong>valid</strong> and semantically <strong>meaningful</strong> names in the schema of the particular database being queried.</li>
</ul>
<hr>
<p><strong>Query Block</strong>:</p>
<ul>
<li><strong>basic</strong> <strong>unit</strong> that can be <strong>translated</strong> into the algebraic operators and optimized.</li>
<li>SELECT-FROM-WHERE-(GROUP BY &amp; HAVING)</li>
</ul>
<p><strong>Nested queries</strong>:</p>
<ul>
<li>Query within Query</li>
</ul>
<p><strong>Aggregate operators</strong> in SQL must be included in the <strong>extended algebra</strong>.</p>
<hr>
<h2 id="6-1-Select-Operation-Implementation"><a href="#6-1-Select-Operation-Implementation" class="headerlink" title="6.1 Select Operation Implementation"></a>6.1 Select Operation Implementation</h2><h3 id="6-1-1-Search-Methods-for-Selection"><a href="#6-1-1-Search-Methods-for-Selection" class="headerlink" title="6.1.1 Search Methods for Selection"></a>6.1.1 Search Methods for Selection</h3><p><strong><em>S1. Linear search (brute force)</em></strong></p>
<ul>
<li>Retrieve <strong>every</strong> record</li>
<li>Test the condition</li>
</ul>
<p><strong><em>S2. Binary search</em></strong></p>
<ul>
<li>Equality condition</li>
<li>On key attribute</li>
<li>Ordered file</li>
</ul>
<p><strong><em>S3. Using a primary index or hash key to retrieve a single record</em></strong></p>
<ul>
<li><strong>single</strong> record</li>
<li>Equality condition</li>
<li>On key attribute (as the search key in $h(k)$)</li>
<li>with <strong>primary key/hash key</strong> on it (ordered on key)</li>
</ul>
<p><strong><em>S4. Using a primary index to retrieve multiple records</em></strong></p>
<ul>
<li>multiple records</li>
<li>$&gt;$, ≥, &lt;, or ≤ on a key</li>
<li>primary key index (ordered on key)</li>
</ul>
<p><strong><em>S5. Using a clustering index to retrieve multiple records</em></strong></p>
<ul>
<li>multiple records</li>
<li>Equality condition</li>
<li>On <strong>non-key</strong> attribute (ordered on the non-key attribute)</li>
</ul>
<p><strong><em>S6.Using a secondary index or B+ tree</em></strong></p>
<ul>
<li>indexing field has unique values on key;</li>
<li>OR, Non-key for multiple records;</li>
<li>On  &gt;,&gt;=, &lt;, or &lt;=</li>
<li>(B+ Tree can on the key or non-key)</li>
</ul>
<hr>
<p><strong>Conjunctive: $AND$</strong></p>
<p><strong>S7. Conjunctive selection</strong></p>
<ul>
<li>more than one condition with <strong>logical AND</strong></li>
<li>On single simple condition;</li>
<li>Has access path for each condition(reduce the research space);</li>
<li>Usage:<ul>
<li>Retrieve with one condition, then retrieve other records with the remaining condition;</li>
</ul>
</li>
</ul>
<p><strong>S8. Conjunctive selection using a composite index</strong></p>
<ul>
<li>two or more attribute</li>
<li>equality </li>
<li>composite index (key)</li>
</ul>
<p><strong>S9. Conjunctive selection by intersection of record pointers</strong></p>
<ul>
<li>secondary indexes</li>
<li>equality</li>
<li>record pointers</li>
<li>Usage:<ul>
<li>Get record pointers for each condition;</li>
<li>Then get the intersection of them to satisfy all conditions;</li>
<li>If no secondary index, then use them need to be further tested;</li>
</ul>
</li>
</ul>
<hr>
<p>Note:</p>
<ul>
<li>Check the <strong>access path</strong> for each condition;<ul>
<li>Yes: use it;</li>
<li>No: Brute force;</li>
</ul>
</li>
<li><strong>Start</strong> with the condition returning the <strong>smallest</strong> number of records (with smallest <strong><em>selectivity</em></strong>);</li>
</ul>
<hr>
<p><strong>Selectivity:</strong></p>
<ul>
<li>Ratio of <strong>the number of records (tuples) that <em>satisfy the condition</em></strong> to the <strong>total number of records (tuples)</strong> in the file (relation). </li>
<li>SSN may have the smallest selectivity, because it is the <strong>primary key</strong>;</li>
<li>Small Selectivity lead to <strong>smaller</strong> <strong>search space</strong>;</li>
<li>seek for the opportunities of keeping smallest intermediate results; </li>
</ul>
<hr>
<p><strong>Disjunctive: $OR$</strong></p>
<ul>
<li>Any one has <strong>NO assess path</strong>: do <strong>BF</strong>;</li>
<li>When all of them has assess path:<ul>
<li>Retrieve all record and apply the union operation;</li>
<li>If get the record <strong>pointer</strong>, then union the <strong>record pointer</strong>;</li>
</ul>
</li>
</ul>
<hr>
<h2 id="6-2-Join-Operation-Implementation"><a href="#6-2-Join-Operation-Implementation" class="headerlink" title="6.2 Join Operation Implementation"></a>6.2 Join Operation Implementation</h2><ul>
<li><strong>most</strong> <strong>expensive</strong> operation in a relational database system;</li>
</ul>
<hr>
<p><strong><em>J1. Nested (inner-outer) loop approach (brute force)</em></strong></p>
<ul>
<li>retrieve every record</li>
</ul>
<p><strong><em>J2. Using an access structure to retrieve the matching record(s)</em></strong><br>R Join S</p>
<ul>
<li>One of the attribute has <strong>access path</strong>;(B of S)</li>
<li>Retrieve each t form R, check with the value with the index of B</li>
</ul>
<p><strong><em>J3. Sort-merge join</em></strong></p>
<ul>
<li>R and S are <strong>physically sorted</strong></li>
<li>on A and B;</li>
<li>Usage:<ul>
<li>scan concurrently;</li>
<li>Find same value in A and B; Join them;</li>
<li>Move to next;</li>
</ul>
</li>
<li>If A and B are key attribute, then records of each file are scanned only once; $O(n+n)$</li>
<li>If not (worst case: all same in A and B: BF): $O(n^2)$</li>
</ul>
<p><strong><em>J4. Hash-join</em></strong></p>
<ul>
<li>same hashing function;</li>
<li>Usage:<ul>
<li>A <strong>single pass through the first</strong> file (say, E) hashes its records to the hash file buckets.</li>
<li>Then do the same on the other file, where the record is <strong>combined</strong> with all matching records from first one.</li>
</ul>
</li>
</ul>
<hr>
<h2 id="6-3-Aggregate-Operation-Implementation"><a href="#6-3-Aggregate-Operation-Implementation" class="headerlink" title="6.3 Aggregate Operation Implementation"></a>6.3 Aggregate Operation Implementation</h2><ol>
<li>table scan</li>
<li>Index</li>
</ol>
<p>For <strong>MAX MIN</strong>: Index</p>
<ul>
<li>MAX - right most node in the B+ Tree;</li>
<li>MIN - left most node in the B+ Tree;</li>
</ul>
<p>For <strong>SUM, COUNT and AVG</strong>:</p>
<ul>
<li><strong>dense index</strong>: apply the computation to the values in index. </li>
<li><strong>non-dense index</strong>: <strong>actual number of records</strong> associated with each index entry are considered. <strong>Can NOT just</strong> use the index entry.</li>
</ul>
<p>For <strong>GROUP BY</strong>:</p>
<ul>
<li>subsets of a table;</li>
<li>With <strong>clustering index</strong> on the <strong>grouping attribute</strong> (eg, DNUM): records are desirably partitioned (grouped) on that attribute.</li>
</ul>
<hr>
<h2 id="6-4-Heuristic-Optimization"><a href="#6-4-Heuristic-Optimization" class="headerlink" title="6.4 Heuristic Optimization"></a>6.4 Heuristic Optimization</h2><p>Query representations:</p>
<ul>
<li><strong>Query Trees</strong><ul>
<li>Query Trees</li>
<li>Initial (canonical) query tree</li>
</ul>
</li>
<li><strong>Query Graphs</strong></li>
</ul>
<hr>
<h3 id="6-4-0-General-Transformation-Rules-for-Relational-Algebra-Operations"><a href="#6-4-0-General-Transformation-Rules-for-Relational-Algebra-Operations" class="headerlink" title="6.4.0 General Transformation Rules for Relational Algebra Operations"></a>6.4.0 General Transformation Rules for Relational Algebra Operations</h3><p><strong>1. Cascade of $\sigma$</strong></p>
<ul>
<li>A conjunctive selection condition can be <strong>broken up</strong> into a cascade (sequence) of individual s operations</li>
</ul>
<script type="math/tex; mode=display">
\sigma_{(C_1 \wedge C_2 \wedge \cdots \wedge C_n)} = \sigma (C_1) \sigma (C_2) \cdots \sigma (C_n)</script><p><strong>2. Commutativity of $\sigma$</strong></p>
<ul>
<li>The σ operation is commutative, i.e.:</li>
</ul>
<script type="math/tex; mode=display">
\sigma_{C_1}(\sigma_{C_2}(R)) = \sigma_{C_2}(\sigma_{C_1}(R))</script><p><strong>3. Cascade of $\pi$</strong><br>In a cascade (sequence) of π operations, all but the <strong>last one can be ignored</strong></p>
<script type="math/tex; mode=display">
\pi_{L_1}(...\pi_{L_n}(R)...) = \pi_{L_1}(R)</script><blockquote>
<p>for optimization, quite often we use the reverse direction of the above equation!</p>
</blockquote>
<p><strong>4. Commuting $\sigma$ with $\pi$</strong></p>
<ul>
<li>If the selection condition c involves only the attributes A1, …, An in the projection list, the two operations can be commuted</li>
</ul>
<script type="math/tex; mode=display">
\pi_{A_1, \cdots, A_n}(\sigma_{C}(R)) = \sigma_{C}(\pi_{A_1, \cdots, A_n}(R))</script><p><strong>5. Commutativity of $*,\bowtie$</strong></p>
<ul>
<li>The * operation is commutative</li>
</ul>
<script type="math/tex; mode=display">
R * S = S * R</script><p><strong>6. Commuting $\sigma$ with $*$ (or $\times$)</strong></p>
<ul>
<li>If all the attributes in the selection <strong>condition c involve ONLY the attributes of one of the relations being joined</strong>—say, R— the two operations can be commuted as follows</li>
</ul>
<script type="math/tex; mode=display">
\sigma _{C}(R * S) = (\sigma_{C}(R)) * S</script><ul>
<li>if the <strong>selection condition c can be written as (c1 and c2)</strong>, where condition c1 involves only the attributes of R and condition c2 involves only the attributes of S, the operations commute as follows: c can be split.</li>
</ul>
<script type="math/tex; mode=display">
\sigma_{(c1 \wedge c2)}(R * S) = (\sigma_{c1}(R)) * (\sigma_{c2}(S))</script><p><strong>7. Commutativity of set operations</strong></p>
<ul>
<li><strong>Union$\cup$</strong> and <strong>intersection$\cap$</strong> are commutative</li>
<li>NOT <strong>subtraction</strong>;</li>
</ul>
<p><strong>8. Commuting $\pi$ with theta join (or X)</strong></p>
<ul>
<li>Suppose that the projection list L = {A1, …, An, B1, …, Bm}, where A1, …, An are attributes of R, and B1, …, Bm are attributes of S. If the join condition c involves only attributes in L, the two operations can be commuted as follows: (split conditions)</li>
</ul>
<script type="math/tex; mode=display">
\pi_{L}(\bowtie _{C}(R, S)) = \pi_{(A_1,...,A_n)}(R)\bowtie _{C}\pi_{(B_1,...B_n)}(S)</script><ul>
<li>if An+1, …, An+k of R and Bm+1, …, Bm+p involved in the join condition c but are not in the projection list L</li>
</ul>
<script type="math/tex; mode=display">
\pi_{L}(\bowtie _{C}(R, S)) = \pi_{(A_1,...,A_n, A_{n+1},...,A_{n+k})}(R)\bowtie _{C}\pi_{(B_1,...B_n,B_{n+1},...,B_{n+k})}(S)</script><p><strong>9. Associativity of $*$, $\times$, $\cup$, and $\cap$</strong></p>
<ul>
<li>These four operations are individually associative; that is, if q stands for any one of these four operations (throughout the expression): </li>
</ul>
<script type="math/tex; mode=display">
(R\;q\;S)\;q\;T = R\;q\;(S\;q\;T)</script><p><strong>10. Commuting $\sigma$ with set operations</strong></p>
<ul>
<li>The σ operation commutes with U, ∩, and –. If q stands for any one of these three operations, we have</li>
</ul>
<script type="math/tex; mode=display">
\sigma_{C}(R\;q\;S) = (\sigma_{C}(R))\;q\;(\sigma_{C}(S))</script><p><strong>11. The $\pi$ operation commutes with $\cup$:</strong></p>
<script type="math/tex; mode=display">
\pi_{L}(R \cup S) = \pi_{L}(R) \cup \pi_{L}(S)</script><p><strong>12. Other transformations</strong></p>
<ul>
<li>DeMorgan’s laws</li>
</ul>
<script type="math/tex; mode=display">
NOT (C_1 \wedge C_2) = (NOT C_1) \vee (NOT C_2) \\
NOT (C_1 \vee C_2) = (NOT C_1) \wedge (NOT C_2)</script><hr>
<h3 id="6-4-1-Outline-of-a-Heuristic-Algebraic-Optimization-Algorithm"><a href="#6-4-1-Outline-of-a-Heuristic-Algebraic-Optimization-Algorithm" class="headerlink" title="6.4.1 Outline of a Heuristic Algebraic Optimization Algorithm"></a>6.4.1 Outline of a Heuristic Algebraic Optimization Algorithm</h3><p>A1:</p>
<ul>
<li>Apply <strong>rule 1</strong>;</li>
<li><strong>break up</strong> any select operations with conjunctive conditions into a <strong>cascade</strong> of select operations;</li>
<li>Get a good DOF (degree of freedom); Down to the Query Tree;</li>
</ul>
<p>A2:</p>
<ul>
<li><strong>Rule 2,4,6,10</strong>;</li>
<li><strong>commutativity of select</strong> with other operations;</li>
<li>Move each select operation as far <strong>down the query tree</strong>;</li>
</ul>
<p>A3:</p>
<ul>
<li><strong>Rule 9</strong>;</li>
<li><strong>associativity</strong> of binary operations;</li>
<li>leaf node relations with the <strong>most restrictive select operations</strong> are <strong>executed first</strong> in the query tree representation;</li>
<li>To have the <strong>smallest selectivity</strong>;</li>
</ul>
<p>A4:</p>
<ul>
<li>Replace the CP (Cartesian product) with subsequent <strong>select</strong> operation;</li>
<li>Into a <strong>join</strong> operation.</li>
</ul>
<p>A5:</p>
<ul>
<li>rules 3, 4, 8, 11, for the <strong>project</strong></li>
<li>break down and move <strong>lists of projection</strong> attributes <strong>down the tree as far as possible</strong>; Execute them as soon as possible;</li>
<li>Project help us to <strong>reduce the table size</strong> in vertical way;</li>
</ul>
<p>A6:</p>
<ul>
<li><strong>Identify subtrees</strong> that represent groups of operations that can be executed by a single algorithm.</li>
</ul>
<center><img src="/2022/12/13/database-systems-course-note/34.png" srcset="/img/loading.gif" lazyload width="90%"></center>

<hr>
<h3 id="6-4-2-Summary-of-Heuristic-Optimization"><a href="#6-4-2-Summary-of-Heuristic-Optimization" class="headerlink" title="6.4.2 Summary of Heuristic Optimization"></a>6.4.2 Summary of Heuristic Optimization</h3><p><strong>Main idea</strong>: first apply the operations that reduce the size of intermediate results;</p>
<ul>
<li><strong>select</strong> operations as <strong>early</strong> as possible</li>
<li><strong>project</strong> operations as <strong>early</strong> as possible</li>
</ul>
<p><strong>select and join</strong> operations that are <strong>most restrictive</strong></p>
<ul>
<li>result in relations with the fewest tuples or with the <strong>smallest absolute size</strong> — should be executed <strong>before</strong> other similar operations.</li>
</ul>
<hr>
<h1 id="7-Transactions-and-Concurrency-Control"><a href="#7-Transactions-and-Concurrency-Control" class="headerlink" title="7 Transactions and Concurrency Control"></a>7 Transactions and Concurrency Control</h1><p>Concurrency:</p>
<ul>
<li><p>Interleaved processing:</p>
<ul>
<li>execution of processes is <strong>interleaved</strong> in a <strong>single</strong> CPU.</li>
<li>part by part;</li>
<li>Not all at the same time;</li>
</ul>
</li>
<li><p>Parallel processing:</p>
<ul>
<li>Processes are <strong>concurrently</strong> executed in <strong>multiple</strong> CPUs.</li>
<li>Together;</li>
</ul>
</li>
</ul>
<h2 id="7-1-Transaction"><a href="#7-1-Transaction" class="headerlink" title="7.1 Transaction"></a>7.1 Transaction</h2><p>Transaction: one or more access operations:</p>
<ul>
<li><strong>Read</strong>: retrieval</li>
<li><strong>Write</strong>: insert, update, delete</li>
<li>Has Begin and End transaction.</li>
</ul>
<p><strong><em>Assumption</em></strong>:</p>
<ul>
<li>Each item has a name;</li>
<li><strong>Granularity</strong> of data - a field, a record , or a whole disk block</li>
<li>Two operation:<ul>
<li><strong>read_item(X)</strong>: Reads a database item named X into a program variable named X.</li>
<li><strong>write_item(X)</strong>: Writes the value of program variable X into the database item named X</li>
<li><strong>Basic unit of data</strong> transfer from the disk to the computer main memory is <strong>one block</strong>.</li>
</ul>
</li>
</ul>
<h3 id="7-1-1-Reason-for-Concurrency"><a href="#7-1-1-Reason-for-Concurrency" class="headerlink" title="7.1.1 Reason for Concurrency"></a>7.1.1 Reason for Concurrency</h3><ul>
<li><strong>The Lost Update Problem</strong><ul>
<li>Two transaction <strong>access</strong> a same item;</li>
<li>E.g. others update X in the middle of a transaction who is using X;</li>
</ul>
</li>
<li><strong>The Temporary Update (or Dirty Read) Problem</strong><ul>
<li>one transaction updates a database item and then the <strong>transaction fails</strong> for some reason. No completed;</li>
<li>The item in failure is accessed by another transaction;</li>
<li>E.g. failure change all updated value to original value, who used this value will be effected;</li>
</ul>
</li>
<li><strong>The Incorrect Summary Problem</strong><ul>
<li>If one transaction is calculating an <strong>aggregate summary</strong> function on a number of records while other transactions are updating some of these records;</li>
<li>E.g. item changed while calculating the sum;</li>
</ul>
</li>
</ul>
<hr>
<h3 id="7-1-2-Reason-for-Recovery"><a href="#7-1-2-Reason-for-Recovery" class="headerlink" title="7.1.2 Reason for Recovery"></a>7.1.2 Reason for Recovery</h3><ul>
<li>A computer failure (system crash):<ul>
<li>contents of the computer’s internal memory may be lost.</li>
</ul>
</li>
<li>A transaction or system error:<ul>
<li>Some operation in the transaction may cause it to fail, such as integer overflow or division by zero.</li>
</ul>
</li>
<li>Local errors or exception conditions detected by the transaction:<ul>
<li>Like data for the transaction may not be found.</li>
</ul>
</li>
<li>Concurrency control enforcement:<ul>
<li>concurrency control method</li>
</ul>
</li>
<li>Disk failure:</li>
<li>Physical problems and catastrophes:</li>
</ul>
<hr>
<h3 id="7-1-3-Transaction-and-System-Concepts"><a href="#7-1-3-Transaction-and-System-Concepts" class="headerlink" title="7.1.3 Transaction and System Concepts"></a>7.1.3 Transaction and System Concepts</h3><p>A <strong>transaction</strong> is an <strong>atomic unit of work</strong> that is either </p>
<ul>
<li>completed in its <strong>entirety</strong> </li>
<li>or <strong>not done at all</strong>.</li>
</ul>
<hr>
<ul>
<li>Transaction states:<ul>
<li><strong>Active state</strong></li>
<li><strong>Partially committed state</strong><ul>
<li>Executed, but not be updated in the DB</li>
</ul>
</li>
<li><strong>Committed state</strong><ul>
<li>All correct, and updated in the DB (permanently updated)</li>
</ul>
</li>
<li><strong>Failed state</strong><ul>
<li>Error occurs, and not updated in the DB, aborted</li>
</ul>
</li>
<li><strong>Terminated State</strong></li>
</ul>
</li>
<li><p>Recovery manager:</p>
<ul>
<li><strong>begin_transaction</strong>: This marks the beginning of transaction execution;</li>
<li><strong>read</strong> or <strong>write</strong>;</li>
<li><strong>end_transaction</strong>: This specifies that read and write transaction operations have ended and marks the end limit of transaction execution.<ul>
<li>Will check whether the transaction is correct or not;</li>
</ul>
</li>
<li><strong>commit_transaction</strong>: This signals a <strong>successful</strong> end of the transaction, update the changed into the BD, can not be undone;</li>
<li><strong>rollback (or abort)</strong>: This signals that the transaction has ended <strong>unsuccessfully</strong>, need to be undone;</li>
</ul>
</li>
<li><p>System Log</p>
<ul>
<li>keeps track of all transaction operations that <strong>affect the values</strong> of database items;</li>
<li>to permit <strong>recovery</strong> from transaction failures;</li>
<li>kept on disk, so it is not affected by any type of failure;</li>
<li>log is <strong>periodically backed up</strong> to archival storage (tape) to guard against such catastrophic failures.</li>
</ul>
</li>
<li><p>Commit Point:</p>
<ul>
<li>When:<ul>
<li><ol>
<li><strong>operations</strong> that access the database have been <strong>executed successfully</strong> </li>
</ol>
</li>
<li><ol>
<li>and <strong>effect of all the transaction operations</strong> on the database has been <strong>recorded in the log</strong>.</li>
</ol>
</li>
</ul>
</li>
<li>Push <code>[commit, T]</code>;</li>
</ul>
</li>
<li><p>Roll Back of transactions (Undo)</p>
<ul>
<li>Needed for transactions that <strong>have a [start_transaction,T]</strong> entry into the log but <strong>no commit entry [commit,T]</strong> into the log. Have start, but no commit;</li>
</ul>
</li>
<li><p>Redoing transactions:</p>
<ul>
<li>Error between committed and terminated; Need to be redo from the log;</li>
</ul>
</li>
<li><p>Force writing a log:</p>
<ul>
<li>any portion of the log that has <strong>not been written to the disk</strong> yet <strong>must now be written to the disk</strong>.</li>
</ul>
</li>
</ul>
<hr>
<h3 id="7-1-4-ACID-properties"><a href="#7-1-4-ACID-properties" class="headerlink" title="7.1.4 ACID properties"></a>7.1.4 ACID properties</h3><ul>
<li><strong>Atomicity</strong>: A transaction is an atomic unit of processing; it is either performed in its <strong>entirety</strong> or not <strong>performed at all</strong>;</li>
<li><strong>Consistency preservation</strong>: A correct execution of the transaction must take the database from one consistent state to another;</li>
<li><strong>Isolation</strong>: A transaction should <strong>not make its updates visible to other transactions until it is committed</strong>; this property, when enforced strictly, solves the temporary update problem and makes cascading rollbacks of transactions  unnecessary. </li>
<li><strong>Durability or permanency</strong>: Once a <strong>transaction changes</strong> the database and the changes are <strong>committed</strong>, these changes <strong>must never be lost</strong> because of subsequent failure.</li>
</ul>
<hr>
<h3 id="7-1-5-Transaction-Schedule"><a href="#7-1-5-Transaction-Schedule" class="headerlink" title="7.1.5 Transaction Schedule"></a>7.1.5 Transaction Schedule</h3><blockquote>
<p>executing concurrently in an interleaved fashion</p>
<ul>
<li>Transaction Schedule: the <strong>order</strong> of execution of operations from the various transactions</li>
<li>The orders in T1 and T2 should be same in S;</li>
</ul>
</blockquote>
<hr>
<h4 id="7-1-5-1-on-Recoverability"><a href="#7-1-5-1-on-Recoverability" class="headerlink" title="7.1.5.1 on Recoverability"></a>7.1.5.1 on Recoverability</h4><ul>
<li><strong>NO</strong> committed transaction needs to be <strong>rolled back</strong>.</li>
<li>S is recoverable if:<br><strong>Ti read</strong> an item <strong>written by Tj</strong>, <strong>Tj</strong> commits <strong>before</strong> <strong>Ti</strong>.<br>Tj <strong>write</strong>, Ti <strong>read</strong> -&gt; Tj commit, Ti commit</li>
<li>Cascaded rollback:<ul>
<li>A single failure leads to a series of rollback</li>
<li>All uncommitted transactions that read an item from a failed transaction must be rolled back.</li>
</ul>
</li>
</ul>
<center><img src="/2022/12/13/database-systems-course-note/38.png" srcset="/img/loading.gif" lazyload width="90%"></center>

<center><img src="/2022/12/13/database-systems-course-note/39.png" srcset="/img/loading.gif" lazyload width="90%"></center>

<hr>
<p><strong>2.“Cascadeless” schedule</strong></p>
<ul>
<li>Every transaction <strong>reads only</strong> the items that are <strong>written by committed transactions.</strong></li>
<li>Commit the write before the read;</li>
</ul>
<center><img src="/2022/12/13/database-systems-course-note/40.png" srcset="/img/loading.gif" lazyload width="90%"></center>

<hr>
<p><strong>3.“Strict” Schedules:</strong></p>
<ul>
<li>transaction can neither <strong>read nor write</strong> an item X until the <strong>last transaction that wrote X has committed.</strong></li>
</ul>
<hr>
<h3 id="7-1-5-2-on-Serializability"><a href="#7-1-5-2-on-Serializability" class="headerlink" title="7.1.5.2 on Serializability"></a>7.1.5.2 on Serializability</h3><p><strong>Serial</strong> schedule:</p>
<ul>
<li>All the operations of T are executed <strong>consecutively</strong> in the schedule.<br><strong>Serializable</strong> schedule:</li>
<li>it is <strong>equivalent</strong> to some serial schedule of the same n transactions.</li>
<li>Two kinds:<ul>
<li><strong>Result</strong> equivalent:<ul>
<li>they <strong>produce the same final state</strong> of the database.</li>
</ul>
</li>
<li>Conflict equivalent:<ul>
<li>the <strong>order of any two conflicting operations (RW,WW from 2 Ts)</strong> is the <strong>same</strong> in both schedules.<br><strong>Conflict serializable</strong>:</li>
</ul>
</li>
</ul>
</li>
<li>A schedule S(non-Serial) is said to be <strong>conflict serializable</strong> if it is <strong>conflict equivalent</strong> to some serial schedule S’.</li>
<li><strong>conflict equivalent</strong> if the relative order of any two <em>conflicting operations</em> is the same in both schedules.</li>
<li><strong>To be <em>conflict</em></strong> if they belong to <strong>different transactions</strong>, <strong>access the same database item</strong>, and <strong>either</strong> <strong>both are write_item</strong> operations or <strong>one is a write_item and the other a read_item</strong>.</li>
</ul>
<p>Being serializable implies that the schedule is a correct schedule, not means it is a serial schedule.</p>
<hr>
<p><strong>Testing for conflict serializability:</strong></p>
<ul>
<li>Looks at ONLY <strong>read_Item (X)</strong> and <strong>write_Item (X)</strong> operations (RW,WW)</li>
<li>Constructs a <strong>precedence graph</strong> (also called serialization graph) — a graph with directed edges<ul>
<li>edge from Ti to  Tj: one of the operations in  Ti <strong>appears before</strong> a conflicting operation in Tj</li>
<li><strong>The schedule is serializable</strong> <ul>
<li>if and only if the precedence graph <strong>has no cycles</strong>.</li>
</ul>
</li>
</ul>
</li>
</ul>
<center><img src="/2022/12/13/database-systems-course-note/35.png" srcset="/img/loading.gif" lazyload width="90%"></center>

<p>(a) Precedence graph for serial schedule A.<br>(b) Precedence graph for serial schedule B.<br>(c) Precedence graph for schedule C ( <strong>not serializable</strong> ).<br>(d) Precedence graph for schedule D ( <strong>serializable, equivalent to schedule A</strong> ).</p>
<hr>
<h3 id="7-1-6-In-SQL"><a href="#7-1-6-In-SQL" class="headerlink" title="7.1.6 In SQL"></a>7.1.6 In SQL</h3><p>Isolation level <isolation> </isolation></p>
<ul>
<li>where <isolation> can be:<ul>
<li>1.READ UNCOMMITTED </li>
<li>2.READ COMMITTED </li>
<li>3.REPEATABLE READ </li>
<li>4.SERIALIZABLE<br>The default is <strong>SERIALIZABLE</strong>.</li>
</ul>
</isolation></li>
</ul>
<hr>
<p><strong>Potential Problem with Lower Isolation Levels</strong></p>
<ul>
<li><strong>Dirty Read</strong>: Reading a value that was written by a transaction which failed. </li>
<li><strong>Nonrepeatable Read</strong>: Allowing another transaction to write a new value <strong>between</strong> <strong>multiple reads</strong> of one transaction.</li>
<li><strong>Phantoms</strong>: New rows being read using the same read with a condition.<ul>
<li>T2 inserts a new row that also satisfies the WHERE clause condition of T1, into the table used by T1. </li>
<li>If T1 is repeated, then T1 will see a phantom – a row that previously did not exist ! !</li>
</ul>
</li>
</ul>
<center>
<img src="/2022/12/13/database-systems-course-note/36.png" srcset="/img/loading.gif" lazyload width="90%">
</center>

<p>Upper level: less concurrency, less problems;</p>
<hr>
<h2 id="7-2-Database-Concurrency-Control"><a href="#7-2-Database-Concurrency-Control" class="headerlink" title="7.2 Database Concurrency Control"></a>7.2 Database Concurrency Control</h2><p>For:</p>
<ul>
<li>Enforce the isolation;</li>
<li>Preserve te consistency;</li>
<li>Resolve the read-write and write-write conflicts;</li>
</ul>
<h3 id="7-2-1-Two-Phase-Locking-Techniques"><a href="#7-2-1-Two-Phase-Locking-Techniques" class="headerlink" title="7.2.1 Two-Phase Locking Techniques"></a>7.2.1 Two-Phase Locking Techniques</h3><p><strong><em>2PL</em></strong> for the <strong>serializability</strong></p>
<p><strong>Binary Lock</strong>:</p>
<ul>
<li><p>lock_item(): X is locked on behalf of the requesting transaction.</p>
</li>
<li><p>unlock_item(): operation which removes these permissions from the data item. item X is made available to all other transactions.</p>
</li>
</ul>
<p>!!! note Lock and Unlock are Atomic operations: execute it successfully or not at all. no intermediate state.</p>
<p><strong>Shared/Exclusive (or Read/Write) Locks</strong>:</p>
<ul>
<li><code>read_lock(X)</code>/<code>shared lock</code>(RR is allowed at the same time)<ul>
<li>read-locked item: other transactions are allowed to only read(no update) the item;</li>
</ul>
</li>
<li><code>write_lock(X)</code>/<code>exclusive lock</code>(WR, RW are not allowed at same time)<ul>
<li>write-locked item is called exclusive-locked because a single transaction <strong>exclusively holds</strong> the lock on the item;</li>
</ul>
</li>
<li><code>unlock(X)</code></li>
<li><code>LOCK(X)</code>,has three possible states: <code>read-locked</code>, <code>write-locked</code>, or <code>unlocked</code>.</li>
</ul>
<p><strong>Lock table</strong> will have four fields:<br>store the identify of the transaction locking a item;<br>like a linked list<br><code>&lt;Data_item_name, LOCK, No_of_reads, Locking_transaction(s)&gt;</code><br><code>Transaction, ID Data item id, lock mode, Ptr to next data item</code></p>
<ul>
<li><strong>LOCK(X) = write-locked</strong>, the value of locking_transaction(s) is a <strong>single transaction</strong> that holds the exclusive (write) lock on X. </li>
<li><strong>If LOCK(X)=read-locked</strong>, the value of locking transaction(s) is that hold the shared (read) lock on X.</li>
</ul>
<p>A transaction is <strong>well-formed</strong> if:</p>
<ul>
<li>It must <strong>lock</strong> the data item <strong>before</strong> it <strong>reads</strong> or <strong>writes</strong> to it. </li>
<li>It must not lock an already locked data item and it must not try to unlock a free data item. (no double lock and unlock a free item)</li>
</ul>
<p>Algorithm:</p>
<center><img src="/2022/12/13/database-systems-course-note/37.png" srcset="/img/loading.gif" lazyload width="90%"></center>

<p>Rules:</p>
<ul>
<li>A transaction T must issue the operation <code>read_lock(X)</code> or <code>write_lock(X)</code> <strong>before</strong> any <code>read_item(X)</code> operation is performed in T.</li>
<li>A transaction T must issue the operation <code>write_lock(X)</code> <strong>before</strong> any <code>write_item(X)</code> operation is performed in T.</li>
<li>A transaction T must issue the operation unlock(X) after all read_item(X) and write_item(X) operations are completed in T.3</li>
</ul>
<h4 id="7-2-1-1-Lock-Conversion"><a href="#7-2-1-1-Lock-Conversion" class="headerlink" title="7.2.1.1 Lock Conversion"></a>7.2.1.1 Lock Conversion</h4><blockquote>
<p>Transaction that <strong>already holds a lock</strong> on item X is allowed under certain conditions to <strong>convert</strong> the lock from one locked state <strong>to another</strong>.</p>
</blockquote>
<p>(lower: shared lock<br>higher: exclusive lock)</p>
<ul>
<li><em>Upgrade (read $\to$ write)</em>: <ul>
<li>If T is the <strong>ONLY</strong> transaction holding a <strong>read lock</strong> on X at the time it <strong>issues the write_lock(X)</strong> operation, the lock can be <strong>upgraded</strong>; </li>
<li>otherwise, the transaction must wait.</li>
</ul>
</li>
<li><em>Downgrade (write $\to$ read)</em>:<ul>
<li>transaction T to issue a <strong>write_lock(X)</strong> and then later to <strong>downgrade</strong> the lock by issuing a <strong>read_lock(X)</strong> operation</li>
</ul>
</li>
</ul>
<h4 id="7-2-1-2-2PL-Checking"><a href="#7-2-1-2-2PL-Checking" class="headerlink" title="7.2.1.2 2PL Checking"></a>7.2.1.2 2PL Checking</h4><p>Follow the two-phase locking protocol:</p>
<ul>
<li>All <strong>locking</strong> operations (read_lock, write_lock) <strong>precede</strong> the <strong>first unlock</strong> operation in the transaction;</li>
<li>Or, <strong>exclusively</strong>, i.e., during the locking phase unlocking phase must not start, and during the unlocking phase locking phase must not begin.</li>
</ul>
<p>Two Phases:</p>
<ul>
<li>Locking (Growing) Phase:<ul>
<li><strong>New locks</strong> on items <strong>can be acquired</strong> but <strong>NONE can be released</strong>;</li>
<li><strong>Upgrading</strong> of locks must be here;</li>
</ul>
</li>
<li>Unlocking (Shrinking) Phase:<ul>
<li>Locks <strong>can be released</strong> but <strong>NO new locks can be acquired</strong></li>
<li><strong>Downgrading</strong> of locks must be here</li>
</ul>
</li>
</ul>
<h4 id="7-2-1-3-Locking-Algorithm"><a href="#7-2-1-3-Locking-Algorithm" class="headerlink" title="7.2.1.3 Locking Algorithm"></a>7.2.1.3 Locking Algorithm</h4><ul>
<li><strong>Conservative (Static) 2PL</strong>:<ul>
<li><strong>Lock all the items</strong> it accesses <strong>before</strong> the transaction begins <strong>execution</strong>;</li>
<li>Any of the predeclared items needed <strong>CANNOT be locked</strong>, then <strong>NOT lock any item;</strong> Then <strong>waits</strong> until <strong>all the items are available</strong> for locking.</li>
<li>Deadlock-free</li>
<li>But <strong>not</strong> so <strong>concurrency</strong></li>
</ul>
</li>
<li><strong>Basic 2PL</strong>:<ul>
<li>Transaction locks data items incrementally;</li>
<li>may cause deadlock;</li>
</ul>
</li>
<li><strong>Strict 2PL</strong>:<ul>
<li>based on the <strong>Basic 2PL</strong>;</li>
<li><strong>Unlock</strong> write locks <strong>after the commits or aborts</strong>;</li>
<li>No others can read or write an item that is written by T unless T has committed, for recoverability. </li>
<li>Like “Strict” Schedules;</li>
</ul>
</li>
</ul>
<hr>
<h3 id="7-2-2-Deadlock-and-Starvation"><a href="#7-2-2-Deadlock-and-Starvation" class="headerlink" title="7.2.2 Deadlock and Starvation"></a>7.2.2 Deadlock and Starvation</h3><p><strong>Deadlock</strong>: </p>
<ul>
<li>Each transaction T is waiting for some item that is locked by some other transaction T′ in the set.</li>
<li>They are waiting for releasing the lock on an item. But the one can release is also waiting. So no one can unlock, no one can back from the waiting - DEAD.</li>
</ul>
<h4 id="7-2-2-1-Deadlock-Prevention"><a href="#7-2-2-1-Deadlock-Prevention" class="headerlink" title="7.2.2.1 Deadlock Prevention"></a>7.2.2.1 Deadlock Prevention</h4><ul>
<li>Lock all the items it accesses before the transaction begins execution</li>
<li>any of the predeclared items needed cannot be locked, then not lock any item; Then waits until all the items are available for locking.</li>
<li>Using Conservative 2PL: Deadlock-free</li>
</ul>
<p><strong>However</strong>:</p>
<ul>
<li>Limits concurrency</li>
</ul>
<hr>
<p>Based on transaction timestamps (TS)<br>TS: the start time of the T;</p>
<ul>
<li>If T1 starts before T2, then TS(T1) &lt; TS(T2)</li>
<li>T1 is <strong>older</strong> than T2: TS(T1) <strong>&lt;</strong> TS(T2)</li>
<li>T1 is <strong>younger</strong> than T2: TS(T1) <strong>&gt;</strong> TS(T2)</li>
</ul>
<p>When <strong>Ti tries to lock</strong> an item X but X is <strong>locked by another Tj</strong> with a conflicting lock:</p>
<ul>
<li><strong>Wait-die</strong> scheme:<ul>
<li>If Ti <strong>older</strong>: it <strong>wait</strong> for Tj;</li>
<li>If Ti <strong>younger</strong>: it <strong>die</strong>, and restart it later <strong>with the same timestamp</strong>. </li>
</ul>
</li>
<li><strong>Wound-wait</strong> scheme:<ul>
<li>If Ti <strong>older</strong>: it <strong>kill</strong> Tj, Tj die, and restart it later <strong>with the same timestamp</strong>. </li>
<li>If Ti <strong>younger</strong>: it <strong>wait</strong> for Tj;</li>
</ul>
</li>
</ul>
<p><strong>too brute force</strong></p>
<h4 id="7-2-2-2-Deadlock-detection-and-resolution"><a href="#7-2-2-2-Deadlock-detection-and-resolution" class="headerlink" title="7.2.2.2 Deadlock detection and resolution"></a>7.2.2.2 Deadlock detection and resolution</h4><p><strong>wait-for-graph</strong></p>
<ul>
<li>Ti -&gt; Tj<ul>
<li><strong>Ti is waiting</strong> to lock an item X that is currently <strong>locked by a transaction Tj</strong></li>
<li>When Tj releases: remove the -&gt;</li>
<li>deadlock &lt;=&gt; the wait-for graph has a cycle</li>
</ul>
</li>
</ul>
<h4 id="7-2-2-3-Recovery-from-Deadlock"><a href="#7-2-2-3-Recovery-from-Deadlock" class="headerlink" title="7.2.2.3 Recovery from Deadlock"></a>7.2.2.3 Recovery from Deadlock</h4><p><strong>Victim Selection</strong>:</p>
<ul>
<li>We should roll back those transactions which will incur the “<strong>minimum cost</strong>” </li>
<li><strong>AVOID</strong> selecting transactions that have been <strong>running for a long time</strong> and that <strong>have performed many updates</strong>, </li>
<li>try to <strong>select</strong> transactions that have <strong>not made many changes</strong> (younger transactions).</li>
</ul>
<p><strong>Rollback</strong>:</p>
<ul>
<li>The <strong>simplest</strong> solution is a <strong>total</strong> rollback:</li>
<li>particular transaction <strong>must be rolled back</strong>, we must <strong>determine</strong> <strong>how far</strong> this transaction <strong>should be rolled back</strong></li>
</ul>
<p><strong>Starvation</strong>:</p>
<ul>
<li>particular transaction <strong>consistently waits, or restarts</strong>, and <strong>never</strong> gets a chance to <strong>proceed further</strong>.</li>
<li>May <strong>consistently</strong> be selected as <strong>victim</strong> and rolled-back. (the rule for victim selection is not fair, biased)</li>
<li>This limitation is inherent in all <strong>priority based</strong> scheduling mechanisms.</li>
<li>Not for wait-die and wound-wait; for they are put <strong>back on the original timestamp</strong>, where they ask the lock </li>
</ul>
<hr>
<h3 id="7-2-3-Database-Security"><a href="#7-2-3-Database-Security" class="headerlink" title="7.2.3 Database Security"></a>7.2.3 Database Security</h3><hr>
<h1 id="SQL-Note"><a href="#SQL-Note" class="headerlink" title="SQL Note"></a>SQL Note</h1><h2 id="1-BETWEEN-Operator"><a href="#1-BETWEEN-Operator" class="headerlink" title="1. BETWEEN Operator"></a>1. BETWEEN Operator</h2><blockquote>
<p>Select rows that contain values <strong>within a range</strong></p>
</blockquote>
<ul>
<li>Find all the employees who earn between $1,200 to $1,400.</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span> <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> ENAME, JOB, SAL            <br><span class="hljs-number">2</span>     <span class="hljs-keyword">FROM</span> EMP            <br><span class="hljs-number">3</span>     <span class="hljs-keyword">WHERE</span> SAL <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">1200</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">1400</span>;<br></code></pre></td></tr></table></figure>
<hr>
<h2 id="2-IN-Operator"><a href="#2-IN-Operator" class="headerlink" title="2. IN Operator"></a>2. IN Operator</h2><blockquote>
<p>Select rows that contain a value that <strong>match one of the values</strong> in a list of values that you supply.</p>
</blockquote>
<ul>
<li>Find the employees who are clerks, analysts or salesmen.</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span> <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> ENAME, JOB, DEPTNO            <br><span class="hljs-number">2</span>     <span class="hljs-keyword">FROM</span> EMP            <br><span class="hljs-number">3</span>     <span class="hljs-keyword">WHERE</span> JOB <span class="hljs-keyword">IN</span> (‘CLERK’, ‘ANALYST’, ‘SALESMAN’);<br></code></pre></td></tr></table></figure>
<hr>
<h2 id="3-LIKE-Operator"><a href="#3-LIKE-Operator" class="headerlink" title="3. LIKE Operator"></a>3. LIKE Operator</h2><p><code>%</code>: The percent character represents any string of zero or more characters<br><code>_</code>: The underscore character means a single character position</p>
<ul>
<li><p>Find all the employees whose names begin with the letter M.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span> <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> ENAME, JOB, DEPTNO            <br><span class="hljs-number">2</span>     <span class="hljs-keyword">FROM</span> EMP            <br><span class="hljs-number">3</span>     <span class="hljs-keyword">WHERE</span> ENAME <span class="hljs-keyword">LIKE</span> ‘M<span class="hljs-operator">%</span>’;<br></code></pre></td></tr></table></figure>
</li>
<li><p>Find all the employees whose name are 5 characters long and end with the letter N.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span> <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> ENAME, JOB, DEPTNO            <br><span class="hljs-number">2</span>     <span class="hljs-keyword">FROM</span> EMP            <br><span class="hljs-number">3</span>     <span class="hljs-keyword">WHERE</span> ENAME <span class="hljs-keyword">LIKE</span> ‘_ _ _ _ N’;<br></code></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="4-ORDER-BY-with-NULLS"><a href="#4-ORDER-BY-with-NULLS" class="headerlink" title="4. ORDER BY with NULLS"></a>4. ORDER BY with NULLS</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> ... <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> ...  <span class="hljs-keyword">ASC</span><span class="hljs-operator">/</span><span class="hljs-keyword">DESC</span> NULLS <span class="hljs-keyword">FIRST</span><span class="hljs-operator">/</span><span class="hljs-keyword">LAST</span>;<br></code></pre></td></tr></table></figure>
<hr>
<h2 id="5-Arithmetic-Functions"><a href="#5-Arithmetic-Functions" class="headerlink" title="5. Arithmetic Functions"></a>5. Arithmetic Functions</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">Functions</th>
<th style="text-align:center">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>ROUND(number[, d] )</code></td>
<td style="text-align:center">Rounds number to d digits right of the decimal point </td>
</tr>
<tr>
<td style="text-align:center"><code>TRUNC (number[, d])</code></td>
<td style="text-align:center">Truncates number to d digits right of the decimal point</td>
</tr>
<tr>
<td style="text-align:center"><code>ABS (number)</code></td>
<td style="text-align:center">Absolute value of the number </td>
</tr>
<tr>
<td style="text-align:center"><code>SIGN (number)</code></td>
<td style="text-align:center">+1 if number &gt; 0; 0 if number = 0; -1 if number &lt; 0</td>
</tr>
<tr>
<td style="text-align:center"><code>TO_CHAR (number)</code></td>
<td style="text-align:center">Converts a number to a character MOD (num1, num2)    Num1 modulo num2</td>
</tr>
</tbody>
</table>
</div>
<hr>
<h2 id="6-Character-String-Functions"><a href="#6-Character-String-Functions" class="headerlink" title="6. Character String Functions"></a>6. Character String Functions</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">Functions</th>
<th style="text-align:center">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>string｜｜string2</code></td>
<td style="text-align:center">Concatenates string1 with string2</td>
</tr>
<tr>
<td style="text-align:center"><code>LENGTH(string)</code></td>
<td style="text-align:center">Length of a string</td>
</tr>
<tr>
<td style="text-align:center"><code>SUBSTR(str,spos[,len]</code></td>
<td style="text-align:center">Substring of a string</td>
</tr>
<tr>
<td style="text-align:center"><code>INSTR(sstr,str[,spos])</code></td>
<td style="text-align:center">Position of substring in the string</td>
</tr>
<tr>
<td style="text-align:center"><code>UPPER(string)</code></td>
<td style="text-align:center">Changes all lower case characters to upper case</td>
</tr>
<tr>
<td style="text-align:center"><code>LOWER(string)</code></td>
<td style="text-align:center">Changes all upper case characters to lower case</td>
</tr>
<tr>
<td style="text-align:center"><code>TO_NUM(string)</code></td>
<td style="text-align:center">Converts a character to a number</td>
</tr>
<tr>
<td style="text-align:center"><code>LPAD(string,len[,chr])</code></td>
<td style="text-align:center">Left pads the string with fill character</td>
</tr>
<tr>
<td style="text-align:center"><code>RPAD(string,len[,chr])</code></td>
<td style="text-align:center">Right pads the string with fill character</td>
</tr>
</tbody>
</table>
</div>
<hr>
<h2 id="7-Substring"><a href="#7-Substring" class="headerlink" title="7. Substring"></a>7. Substring</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">SUBSTR(STR,N,M) <br><span class="hljs-built_in">UPPER</span>(STR)<br><span class="hljs-built_in">LOWER</span>(STR)            <br>LENGTH(STR)<br></code></pre></td></tr></table></figure>
<ul>
<li><p>Abbreviate the department name to the first 5 characters of the department name.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span> <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> SUBSTR(DNAME,<span class="hljs-number">1</span>,<span class="hljs-number">5</span>)            <br><span class="hljs-number">2</span>     <span class="hljs-keyword">FROM</span> DEPT;<br></code></pre></td></tr></table></figure>
</li>
<li><p>Select an employee name in both UPPER and LOWER case.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span> <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> ENAME, <span class="hljs-built_in">UPPER</span>(ENAME), <span class="hljs-built_in">LOWER</span>(ENAME)            <br><span class="hljs-number">2</span>     <span class="hljs-keyword">FROM</span> EMP            <br><span class="hljs-number">3</span>     <span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">UPPER</span>(ENAME) <span class="hljs-operator">=</span> <span class="hljs-built_in">UPPER</span>(‘Ward’);<br></code></pre></td></tr></table></figure>
</li>
<li><p>Find the number of characters in department names.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span> <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> DNAME, LENGTH(DNAME)<br><span class="hljs-number">2</span>     <span class="hljs-keyword">FROM</span> DEPT;<br></code></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="8-Aggregate-Functions"><a href="#8-Aggregate-Functions" class="headerlink" title="8. Aggregate Functions"></a>8. Aggregate Functions</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">Functions</th>
<th style="text-align:center">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>AVG()</code></td>
<td style="text-align:center">Computes the average value </td>
</tr>
<tr>
<td style="text-align:center"><code>SUM()</code></td>
<td style="text-align:center">Computes the total value </td>
</tr>
<tr>
<td style="text-align:center"><code>MIN()</code></td>
<td style="text-align:center">Finds the minimum value </td>
</tr>
<tr>
<td style="text-align:center"><code>MAX()</code></td>
<td style="text-align:center">Finds the maximum value </td>
</tr>
<tr>
<td style="text-align:center"><code>COUNT()</code></td>
<td style="text-align:center">Counts the number of values</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>Find the average salary for clerks<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span> <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(SAL)<br><span class="hljs-number">2</span>     <span class="hljs-keyword">FROM</span> EMP <br><span class="hljs-number">3</span>     <span class="hljs-keyword">WHERE</span> JOB <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;CLERK&#x27;</span>;<br></code></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<blockquote>
<p>NOT have both aggregates and non-aggregates in the same <code>SELECT</code> list;<br>Like <code>SELECT ENAME, AVG(SAL)</code> is wrong.</p>
</blockquote>
<ul>
<li>Find the name and salary of the employee (or employees) who receive the maximum salary.<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span> <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> ENAME, JOB, SAL<br>    <span class="hljs-number">2</span> <span class="hljs-keyword">FROM</span> EMP<br>    <span class="hljs-number">3</span> <span class="hljs-keyword">WHERE</span> SAL <span class="hljs-operator">=</span><br>    <span class="hljs-number">4</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MAX</span>(SAL) <span class="hljs-keyword">FROM</span> EMP);<br></code></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="8-1-COUNT"><a href="#8-1-COUNT" class="headerlink" title="8.1 COUNT"></a>8.1 COUNT</h3><p>The COUNT function can be used to count the number of values, number of distinct values, or number of rows selected by the query. </p>
<ul>
<li>Count the number of employees who receive a commission<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span> <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span> (COMM)<br>    <span class="hljs-number">2</span> <span class="hljs-keyword">FROM</span> EMP;<br></code></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<blockquote>
<p>COUNT may be used with the keyword DISTINCT to return the number of different values stored in the column.</p>
</blockquote>
<ul>
<li>Count the number of different jobs held by employees in department 30<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span> <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> JOB)<br>    <span class="hljs-number">2</span> <span class="hljs-keyword">FROM</span> EMP<br>    <span class="hljs-number">3</span> <span class="hljs-keyword">WHERE</span> DEPTNO <span class="hljs-operator">=</span> <span class="hljs-number">30</span>;<br></code></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="9-GROUP-BY"><a href="#9-GROUP-BY" class="headerlink" title="9. GROUP BY"></a>9. GROUP BY</h2><p>The GROUP BY clause divides a table into <strong>groups of rows</strong> with <strong>matching values in the same column</strong> (or columns). </p>
<ul>
<li><p>List the department number and average salary of each department</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span> <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> DEPTNO, <span class="hljs-built_in">AVG</span>(SAL)<br>    <span class="hljs-number">2</span> <span class="hljs-keyword">FROM</span> EMP<br>    <span class="hljs-number">3</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> DEPTNO;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>The GROUP BY clause <strong>always follows the WHERE clause</strong>, <strong>or the FROM clause</strong> when there is no WHERE clause in the command. </p>
</blockquote>
</li>
<li><p>Find each department’s average annual salary for all its employees except the managers and the president.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span> <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> DEPTNO, <span class="hljs-built_in">AVG</span>(SAL)<span class="hljs-operator">*</span><span class="hljs-number">12</span><br>      <span class="hljs-number">2</span> <span class="hljs-keyword">FROM</span> EMP<br>      <span class="hljs-number">3</span> <span class="hljs-keyword">WHERE</span> JOB <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (‘MANAGER’, ‘PRESIDENT’)<br>      <span class="hljs-number">4</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> DEPTNO;<br></code></pre></td></tr></table></figure>
</li>
<li><p>Divide  all  employees  into  groups  by  department,  and  by  jobs  within  department. Count the employees in each group and compute each group’s average annual salary.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span> <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> DEPTNO, JOB, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>), <span class="hljs-built_in">AVG</span>(SAL)<span class="hljs-operator">*</span><span class="hljs-number">12</span><br>    <span class="hljs-number">2</span> <span class="hljs-keyword">FROM</span> EMP<br>    <span class="hljs-number">3</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> DEPTNO, JOB;<br></code></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="10-HAVING"><a href="#10-HAVING" class="headerlink" title="10. HAVING"></a>10. HAVING</h2><blockquote>
<p>Specify <strong>search-conditions</strong> for <strong>groups</strong>.</p>
</blockquote>
<ul>
<li>List the average annual salary for all job groups having more than 2 employees in the group.</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span> <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> JOB, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>), <span class="hljs-built_in">AVG</span>(SAL)<span class="hljs-operator">*</span><span class="hljs-number">12</span><br>    <span class="hljs-number">2</span> <span class="hljs-keyword">FROM</span> EMP<br>    <span class="hljs-number">3</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> JOB<br>    <span class="hljs-number">4</span> <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-operator">&gt;</span> <span class="hljs-number">2</span>;<br></code></pre></td></tr></table></figure>
<ul>
<li><p>List all the departments that have at least two clerks.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span> <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> DEPTNO<br>    <span class="hljs-number">2</span> <span class="hljs-keyword">FROM</span> EMP<br>    <span class="hljs-number">3</span> <span class="hljs-keyword">WHERE</span> JOB <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;CLERK&#x27;</span><br>    <span class="hljs-number">4</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> DEPTNO<br>    <span class="hljs-number">5</span> <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-operator">&gt;=</span><span class="hljs-number">2</span>;<br></code></pre></td></tr></table></figure>
</li>
<li><p>Find all departments with an average commission greater than 25% of average salary.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span> <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> DEPTNO, <span class="hljs-built_in">AVG</span>(SAL), <span class="hljs-built_in">AVG</span>(COMM), <span class="hljs-built_in">AVG</span>(SAL)<span class="hljs-operator">*</span><span class="hljs-number">0.25</span><br>    <span class="hljs-number">2</span> <span class="hljs-keyword">FROM</span> EMP<br>    <span class="hljs-number">3</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> DEPTNO<br>    <span class="hljs-number">4</span> <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">AVG</span>(COMM) <span class="hljs-operator">&gt;</span> <span class="hljs-built_in">AVG</span>(SAL)<span class="hljs-operator">*</span><span class="hljs-number">0.25</span>;<br></code></pre></td></tr></table></figure>
</li>
<li><p>List the job groups that have an average salary greater than the average salary of managers.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span> <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> JOB, <span class="hljs-built_in">AVG</span>(SAL)<br>    <span class="hljs-number">2</span> <span class="hljs-keyword">FROM</span> EMP<br>    <span class="hljs-number">3</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> JOB<br>    <span class="hljs-number">4</span> <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">AVG</span>(SAL) <span class="hljs-operator">&gt;</span><br>    <span class="hljs-number">5</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(SAL) <span class="hljs-keyword">FROM</span> EMP<br>    <span class="hljs-number">6</span> <span class="hljs-keyword">WHERE</span> JOB <span class="hljs-operator">=</span> ‘MANAGER’);<br></code></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="11-NULL-in-GROUP"><a href="#11-NULL-in-GROUP" class="headerlink" title="11. NULL in GROUP"></a>11. NULL in GROUP</h2><blockquote>
<p>Null values do <strong>NOT</strong> participate in the computation of group functions. </p>
</blockquote>
<ul>
<li>Count the number of people in department 30 who receive a salary and the number of people who receive a commission.<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span> <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span> (SAL), <span class="hljs-built_in">COUNT</span>(COMM)<br>    <span class="hljs-number">2</span> <span class="hljs-keyword">FROM</span> EMP<br>    <span class="hljs-number">3</span> <span class="hljs-keyword">WHERE</span> DEPTNO <span class="hljs-operator">=</span> <span class="hljs-number">30</span>; <br></code></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="11-1-The-NULL-Function"><a href="#11-1-The-NULL-Function" class="headerlink" title="11.1 The NULL Function"></a>11.1 The NULL Function</h3><blockquote>
<p>When an expression or function references a column that contains a null value, the result is null.</p>
</blockquote>
<ul>
<li>Treat null commissions as zero commissions within the expression SAL+COMM.<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span> <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> ENAME, JOB, SAL, COMM, SAL<span class="hljs-operator">+</span>NVL(COMM, <span class="hljs-number">0</span>)            <br><span class="hljs-number">2</span>     <span class="hljs-keyword">FROM</span> EMP            <br><span class="hljs-number">3</span>     <span class="hljs-keyword">WHERE</span> DEPTNO <span class="hljs-operator">=</span> <span class="hljs-number">30</span>;<br></code></pre></td></tr></table></figure>
</li>
</ul>
<p>The expression <code>SAL+NVL(COMM, 0)</code> will return a value equal to SAL+0 when the COMM field is null.</p>
<ul>
<li>List the average commission of employees who receive a commission, and the average commission of all employees (treating employees who do not receive a commission as receiving a zero commission).<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span> <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(COMM), <span class="hljs-built_in">AVG</span>(NVL(COMM, <span class="hljs-number">0</span>))<br>    <span class="hljs-number">2</span> <span class="hljs-keyword">FROM</span> EMP<br>    <span class="hljs-number">3</span> <span class="hljs-keyword">WHERE</span> DEPTNO <span class="hljs-operator">=</span> <span class="hljs-number">30</span>;<br></code></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="12-JDBC"><a href="#12-JDBC" class="headerlink" title="12 JDBC"></a>12 JDBC</h2><h3 id="12-1-Connection-amp-Statement"><a href="#12-1-Connection-amp-Statement" class="headerlink" title="12.1 Connection &amp; Statement"></a>12.1 Connection &amp; Statement</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.io.Console;<br><span class="hljs-keyword">import</span> java.sql.*;<br><span class="hljs-keyword">import</span> oracle.jdbc.driver.*;<br><span class="hljs-keyword">import</span> oracle.sql.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">simpleApplication</span><br>&#123;<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String args[])</span> <span class="hljs-keyword">throws</span> SQLException, IOException<br>	&#123;<br>		<span class="hljs-comment">// ---------- User name and Password ---------</span><br>		<span class="hljs-type">Console</span> <span class="hljs-variable">console</span> <span class="hljs-operator">=</span> System.console();<br>		System.out.print(<span class="hljs-string">&quot;Enter your username: &quot;</span>);    <span class="hljs-comment">// Your Oracle ID with double quote</span><br>		<span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> console.readLine();         <span class="hljs-comment">// e.g. &quot;98765432d&quot;</span><br>		System.out.print(<span class="hljs-string">&quot;Enter your password: &quot;</span>);    <span class="hljs-comment">// Password of your Oracle Account</span><br>		<span class="hljs-type">char</span>[] password = console.readPassword();<br>		<span class="hljs-type">String</span> <span class="hljs-variable">pwd</span> <span class="hljs-operator">=</span> String.valueOf(password);<br><br>		<span class="hljs-comment">// ---------- Connection Start ---------</span><br>			<span class="hljs-comment">// 1. Register the JDBC Driver</span><br>		DriverManager.registerDriver(<span class="hljs-keyword">new</span> <span class="hljs-title class_">oracle</span>.jdbc.driver.OracleDriver());<br><br>			<span class="hljs-comment">// 2. Set the database URL</span><br>		<span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;jdbc:oracle:thin:@studora.comp.polyu.edu.hk:1521:dbms&quot;</span>;<br><br>			<span class="hljs-comment">// 3. Create a connection named &quot;conn&quot;</span><br>			<span class="hljs-comment">// require url, username, password</span><br>		<span class="hljs-type">OracleConnection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span><br>			(OracleConnection)DriverManager.getConnection(url,username,pwd);<br>		<span class="hljs-comment">// ---------- Connection Ended ---------</span><br><br>		<span class="hljs-comment">// ---------- Query Statement Example ---------</span><br>			<span class="hljs-comment">// 1. Create a Statement instance responsible for executing SQL statements</span><br>		<span class="hljs-type">Statement</span> <span class="hljs-variable">stmt</span> <span class="hljs-operator">=</span> conn.createStatement();<br><br>			<span class="hljs-comment">// 2. The SQL statement to be executed (SELECT: executeQuery; UPDATE...: executeUpdate)</span><br>			<span class="hljs-comment">// 3. And get the result set in ResultSet instance</span><br>		<span class="hljs-type">String</span> <span class="hljs-variable">inSql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;SELECT EMPNO, ENAME, JOB FROM EMP&quot;</span>;<br>		<span class="hljs-type">ResultSet</span> <span class="hljs-variable">rset</span> <span class="hljs-operator">=</span> stmt.executeQuery(inSql);<br><br>			<span class="hljs-comment">// 4. Iterate the result set</span><br>		<span class="hljs-keyword">while</span> (rset.next()) &#123;<br>				<span class="hljs-comment">// getInt() for return the value in int type</span><br>				<span class="hljs-comment">// getString() for return the value in String type</span><br>				<span class="hljs-comment">// parameter can be column name or column index in the return table (not the original table)</span><br>			System.out.println(<br>							rset.getInt(<span class="hljs-number">1</span>)+ <span class="hljs-string">&quot; &quot;</span> +<br>							rset.getString(<span class="hljs-number">2</span>) + <span class="hljs-string">&quot; &quot;</span> +<br>							rset.getString(<span class="hljs-number">3</span>));<br>		&#125;<br>		System.out.println();<br><br>		<span class="hljs-comment">// ---------- Connection Closing ---------</span><br>		conn.close();<br>		<span class="hljs-comment">// ---------- Connection Closing ---------</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<ul>
<li>For <strong><code>SELECT</code> statement</strong>, the method to use is <code>executeQuery()</code>.  </li>
<li>For statements that <strong>create</strong> or <strong>modify</strong> tables, the method to use is <code>executeUpdate()</code>.</li>
</ul>
<hr>
<h3 id="12-2-Prepared-Statement"><a href="#12-2-Prepared-Statement" class="headerlink" title="12.2 Prepared Statement"></a>12.2 Prepared Statement</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.io.Console;<br><span class="hljs-keyword">import</span> java.sql.*;<br><span class="hljs-keyword">import</span> oracle.jdbc.driver.*;<br><span class="hljs-keyword">import</span> oracle.sql.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PreparedStatementTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String args[])</span> <span class="hljs-keyword">throws</span> SQLException, IOException<br>    &#123;<br>        <span class="hljs-comment">// ---------- Connection ---------</span><br>        <span class="hljs-comment">// ...</span><br><br>        <span class="hljs-comment">// ---------- Prepared Statement Example ---------</span><br>            <span class="hljs-comment">// 1. Create a PreparedStatement with ? as placeholder</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;UPDATE EMP SET SAL = ? WHERE ENAME = ?&quot;</span>;<br>        <span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">ps</span> <span class="hljs-operator">=</span> conn.prepareStatement(sql);<br>            <span class="hljs-comment">// 2. Set the value of the placeholder</span><br>        ps.setInt(<span class="hljs-number">1</span>, <span class="hljs-number">1500</span>);<br>        ps.setString(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;MARTIN&quot;</span>);<br>            <span class="hljs-comment">// 3. Execute the PreparedStatement</span><br>        ps.executeUpdate();<br>        <span class="hljs-comment">// ---------- Prepared Statement Example Done ---------</span><br><br>        <span class="hljs-type">Statement</span> <span class="hljs-variable">stmt</span> <span class="hljs-operator">=</span> conn.createStatement();<br>        <span class="hljs-type">ResultSet</span> <span class="hljs-variable">rset</span> <span class="hljs-operator">=</span> stmt.executeQuery(<span class="hljs-string">&quot;SELECT ENAME, SAL FROM EMP&quot;</span>);<br>        <span class="hljs-keyword">while</span> (rset.next()) &#123;<br>            System.out.println(rset.getString(<span class="hljs-number">1</span>) + <span class="hljs-string">&quot; &quot;</span> +<br>                                rset.getInt(<span class="hljs-number">2</span>));<br>        &#125;<br>        System.out.println();<br><br>        <span class="hljs-comment">// ---------- Connection Closing ---------</span><br>        conn.close();<br>        <span class="hljs-comment">// ---------- Connection Closing ---------</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<hr>
<h3 id="12-3-Transactions"><a href="#12-3-Transactions" class="headerlink" title="12.3 Transactions"></a>12.3 Transactions</h3><ul>
<li><strong>Turn off the auto-commit</strong> mode with <code>conn.setAutoCommit(false)</code>;</li>
<li><strong>Turn it back on</strong> with <code>conn.setAutoCommit(true)</code>; </li>
<li>Explicit <strong>commit</strong> invoking: <code>conn.commit()</code>;</li>
<li>To <strong>rollback</strong>: <code>conn.rollback()</code>.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">conn.setAutoCommit(<span class="hljs-literal">false</span>); <br><span class="hljs-type">Statement</span> <span class="hljs-variable">stmt</span> <span class="hljs-operator">=</span> conn.createStatement(); <br>stmt.executeUpdate(<span class="hljs-string">&quot;INSERT INTO DEPT VALUES(50,&#x27;HRO&#x27;,&#x27;NEW YORK&#x27;)&quot;</span>); <br>conn.rollback;<br>stmt.executeUpdate(<span class="hljs-string">&quot;INSERT INTO DEPT VALUES(50,&#x27;HRO&#x27;,&#x27;WASHINGTON&#x27;)&quot;</span>); <br>conn.commit(); <br>conn.setAutoCommit(<span class="hljs-literal">true</span>);<br><br></code></pre></td></tr></table></figure>
<hr>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><p>Ramez Elmasri and S. B. Navathe, <em>Fundamentals of database systems.</em> Hoboken, New Jersey: Pearson, 2017.</p>
<p>Slides of <em>COMP2411 Database Systems</em>, The Hong Kong Polytechnic University.</p>
<hr>
<p><strong><em>个人笔记，仅供参考，转载请标明出处</em></strong><br><strong><em>PERSONAL COURSE NOTE, FOR REFERENCE ONLY</em></strong></p>
<p><strong><em>Made by Mike_Zhang</em></strong></p>
<center><img src="https://ultrafish-blog.oss-cn-hangzhou.aliyuncs.com/blog3/logo3.gif?versionId=CAEQGxiBgIDY95eb1xciIGY2MzBlMTcyY2NlNzQ0MjE5Y2MyZGM5MGE0NDQ3YzQ2" srcset="/img/loading.gif" lazyload width height><br><br></center>



              
            </div>
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Database-Systems/" class="category-chain-item">Database Systems</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Note/">#Note</a>
      
        <a href="/tags/Database-Systems/">#Database Systems</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Database Systems Course Note</div>
      <div>https://ultrafish.cn/2022/12/13/database-systems-course-note/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者 | Author</div>
          <div>Mike_Zhang</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于 | Posted on</div>
          <div>2022年12月13日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议 | Licensed</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
              <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">
              <span class="hint--top hint--rounded" aria-label="SA - 相同方式共享">
                <i class="iconfont icon-sa"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/12/02/mathematics-i-course-note/" title="Mathematics I Course Note">
                        <span class="hidden-mobile">Mathematics I Course Note</span>
                        <span class="visible-mobile">下一篇|Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.4.16/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"xPfvtHmxSDcqGwKW6R8EEWXM-gzGzoHsz","appKey":"jVB4RsyHUFfRbEhhlssoxEVQ","path":"window.location.pathname","placeholder":"请先在上方填写 [昵称] 和 [邮箱(可选)] | Please enter [Name] & [Email(Opt)] above first","avatar":"mp","meta":["nick","mail"],"requiredFields":["nick"],"pageSize":10,"lang":"zh-CN","highlight":true,"recordIP":true,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":true},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录 | Content</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  








    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索 | Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词 | Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <footer class="text-center mt-5 py-3" style="font-size:small;">
<div class="footer-inner">
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 | Page View 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 | Unique Visitor 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  
  <div class="footer" >
    Copyright &copy; 2020-2022 <a href="https://ultrafish.cn/about">Mike_Zhang</a>. All rights reserved.
  </div>
  
    <!-- 备案信息 ICP for China -->
    <div class="beian">
  <span>
    <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
      浙ICP备2020036956号
    </a>
  </span>
  
    
      <span>
        <a
          href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33042102000661"
          rel="nofollow noopener"
          class="beian-police"
          target="_blank"
        >
          
            <span style="visibility: hidden; width: 0">|</span>
            <img src="/img/police_beian.png" srcset="/img/loading.gif" lazyload alt="police-icon"/>
          
          <span>浙公网安备33042102000661号</span>
        </a>
      </span>
    
  
</div>

  
  

</div>
</footer>
  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  

  

  

  

  

  

  
    
  




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        MathJax = {
          tex    : {
            inlineMath: { '[+]': [['$', '$']] }
          },
          loader : {
            load: ['ui/lazy']
          },
          options: {
            renderActions: {
              findScript    : [10, doc => {
                document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                  const display = !!node.type.match(/; *mode=display/);
                  const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                  const text = document.createTextNode('');
                  node.parentNode.replaceChild(text, node);
                  math.start = { node: text, delim: '', n: 0 };
                  math.end = { node: text, delim: '', n: 0 };
                  doc.math.push(math);
                });
              }, '', false],
              insertedScript: [200, () => {
                document.querySelectorAll('mjx-container').forEach(node => {
                  let target = node.parentNode;
                  if (target.nodeName.toLowerCase() === 'li') {
                    target.parentNode.classList.add('has-jax');
                  }
                });
              }, '', false]
            }
          }
        };
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.1/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="/js/leancloud.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳|Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
