

<!DOCTYPE html>
<html lang="zh-CN,en,default" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/4.jpg">
  <link rel="icon" href="/img/4.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#000000">
  <meta name="author" content="Mike_Zhang">
  <meta name="keywords" content="blog, Mike_Zhang, UltraFish">
  
    <meta name="description" content="Made by Mike_Zhang   所有文章:Introductory Probability Course NotePython Basic NoteLimits and Continuity NoteCalculus for Engineers Course NoteIntroduction to Data Analytics Course NoteIntroduction to Com">
<meta property="og:type" content="article">
<meta property="og:title" content="Introduction to Computer Systems Course Note">
<meta property="og:url" content="https://ultrafish.cn/2022/04/30/introduction-to-computer-systems-course-note/index.html">
<meta property="og:site_name" content="UltraFish">
<meta property="og:description" content="Made by Mike_Zhang   所有文章:Introductory Probability Course NotePython Basic NoteLimits and Continuity NoteCalculus for Engineers Course NoteIntroduction to Data Analytics Course NoteIntroduction to Com">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ultrafish-blog.oss-cn-hangzhou.aliyuncs.com/note.png?versionId=CAEQIxiBgMDCuYe37RciIGExYWZkNjg5MmIyYTRjYmFiNTk1MGZhMDBjNWVkNTZm">
<meta property="article:published_time" content="2022-04-30T08:00:20.000Z">
<meta property="article:modified_time" content="2022-04-30T08:24:31.256Z">
<meta property="article:author" content="Mike_Zhang">
<meta property="article:tag" content="Computer System">
<meta property="article:tag" content="Note">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://ultrafish-blog.oss-cn-hangzhou.aliyuncs.com/note.png?versionId=CAEQIxiBgMDCuYe37RciIGExYWZkNjg5MmIyYTRjYmFiNTk1MGZhMDBjNWVkNTZm">
  
  
  <title>Introduction to Computer Systems Course Note - UltraFish</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"ultrafish.cn","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":50,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"VXQrzMqOSkaPcbILQ3sQJyhw-gzGzoHsz","app_key":"y6z7EoVjISdQPvN4meqBOkvy","server_url":"https://vxqrzmqo.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":true}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 6.1.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>UltraFish</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                文章
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/collection/">
                <i class="iconfont icon-th-large"></i>
                收藏夹
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于我
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-code"></i>
                UltraFish Plus
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" target="_blank" rel="noopener" href="https://plus.ultrafish.cn">
                    <i class="iconfont icon-home-fill"></i>
                    UltraFish Plus 主页
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" target="_blank" rel="noopener" href="https://plus.ultrafish.cn/Base-convertor">
                    <i class="iconfont icon-briefcase"></i>
                    多进制转换
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" target="_blank" rel="noopener" href="https://plus.ultrafish.cn/IEEE-754-Single-Representation">
                    <i class="iconfont icon-briefcase"></i>
                    IEEE 754
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" target="_blank" rel="noopener" href="https://plus.ultrafish.cn/IEEE-754-Single-Representation">
                    <i class="iconfont icon-briefcase"></i>
                    有符号数转换
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" target="_blank" rel="noopener" href="https://plus.ultrafish.cn/Josephus-Problem">
                    <i class="iconfont icon-briefcase"></i>
                    约瑟夫问题
                  </a>
                
              </div>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://ultrafish-blog.oss-cn-hangzhou.aliyuncs.com/note.png?versionId=CAEQIxiBgMDCuYe37RciIGExYWZkNjg5MmIyYTRjYmFiNTk1MGZhMDBjNWVkNTZm') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Introduction to Computer Systems Course Note"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-04-30 16:00" pubdate>
          2022年4月30日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          <!-- compatible with older versions-->
          33k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          <!-- compatible with older versions-->
          272 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          阅读数：<span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar category-bar" style="margin-right: -1rem">
    





<div class="category-list">
  
  
    
    
    
    <div class="category row nomargin-x">
      <a class="category-item 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="Computer System"
        id="heading-f92b2ddd42532cc5ff32c1e2693d387e" role="tab" data-toggle="collapse" href="#collapse-f92b2ddd42532cc5ff32c1e2693d387e"
        aria-expanded="true"
      >
        Computer System
        <span class="list-group-count">(7)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-f92b2ddd42532cc5ff32c1e2693d387e"
           role="tabpanel" aria-labelledby="heading-f92b2ddd42532cc5ff32c1e2693d387e">
        
        
          
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2022/04/30/introduction-to-computer-systems-course-note/" title="Introduction to Computer Systems Course Note"
           class="list-group-item list-group-item-action
           active">
          <span class="category-post">Introduction to Computer Systems Course Note</span>
        </a>
      
    
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="Data Representation"
        id="heading-d0825bea58e8f7858be6092636ec169e" role="tab" data-toggle="collapse" href="#collapse-d0825bea58e8f7858be6092636ec169e"
        aria-expanded="false"
      >
        Data Representation
        <span class="list-group-count">(2)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-d0825bea58e8f7858be6092636ec169e"
           role="tabpanel" aria-labelledby="heading-d0825bea58e8f7858be6092636ec169e">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2020/09/19/Signed-binary-number-representation/" title="有符号二进制数表示方法Signed binary number representation"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">有符号二进制数表示方法Signed binary number representation</span>
        </a>
      
    
      
      
        <a href="/2020/12/20/floating%20point%20numbers%20representation/" title="Floating point numbers representation"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Floating point numbers representation</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="Y86-64"
        id="heading-7407c4861db315583822a87326d64d17" role="tab" data-toggle="collapse" href="#collapse-7407c4861db315583822a87326d64d17"
        aria-expanded="false"
      >
        Y86-64
        <span class="list-group-count">(2)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-7407c4861db315583822a87326d64d17"
           role="tabpanel" aria-labelledby="heading-7407c4861db315583822a87326d64d17">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2022/01/04/Y86-64-learning-1/" title="Y86-64学习1-State &amp; Instruction &amp; Basic Encoding"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Y86-64学习1-State &amp; Instruction &amp; Basic Encoding</span>
        </a>
      
    
      
      
        <a href="/2022/01/08/Y86-64-learning-2/" title="Y86-64学习2-Y86-64 SEQ Stages"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Y86-64学习2-Y86-64 SEQ Stages</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="x86-64"
        id="heading-5793350652a63d80998652da28657dba" role="tab" data-toggle="collapse" href="#collapse-5793350652a63d80998652da28657dba"
        aria-expanded="false"
      >
        x86-64
        <span class="list-group-count">(2)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-5793350652a63d80998652da28657dba"
           role="tabpanel" aria-labelledby="heading-5793350652a63d80998652da28657dba">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2022/02/06/x86-64-learning-1/" title="x86-64学习1-Introduction &amp; Data Formats &amp; Information Accessing &amp; Arithmetic Logical Operation"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">x86-64学习1-Introduction &amp; Data Formats &amp; Information Accessing &amp; Arithmetic Logical Operation</span>
        </a>
      
    
      
      
        <a href="/2022/02/24/x86-64-learning-2/" title="x86-64学习2-Control"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">x86-64学习2-Control</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
        
      </div>
    </div>
  
</div>


  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Introduction to Computer Systems Course Note</h1>
            
            <div class="markdown-body">
              
              <p><strong><em>Made by Mike_Zhang</em></strong></p>
<hr>
<blockquote>
<p>所有文章:<br><a href="https://ultrafish.cn/2021/12/12/introductory-probability-course-note/">Introductory Probability Course Note</a><br><a href="https://ultrafish.cn/2021/12/18/Python-basic-note/">Python Basic Note</a><br><a href="https://ultrafish.cn/2021/12/14/limits-continuity-note/">Limits and Continuity Note</a><br><a href="https://ultrafish.cn/2022/04/28/calculus-for-engineers-course-note/">Calculus for Engineers Course Note</a><br><a href="https://ultrafish.cn/2022/04/30/introduction-to-data-analytics-course-note/">Introduction to Data Analytics Course Note</a><br><a href="https://ultrafish.cn/2022/04/30/introduction-to-computer-systems-course-note/">Introduction to Computer Systems Course Note</a></p>
</blockquote>
<p><strong><em>个人笔记，仅供参考</em></strong><br><strong><em>FOR REFERENCE ONLY</em></strong></p>
<p>Course note of <strong>COMP1411 Introduction to Computer Systems</strong>, The Hong Kong Polytechnic University, 2022.</p>
<p>Mainly focus on</p>
<ul>
<li>Data representation</li>
<li>Machine language</li>
<li>Processor architecture</li>
<li>Memory hierarchy</li>
<li>Virtual memory</li>
<li>System-level I/O</li>
<li>Networking</li>
</ul>
<span id="more"></span>
<hr>
<h1 id="1-Data-representation-I"><a href="#1-Data-representation-I" class="headerlink" title="1 Data representation I"></a>1 Data representation I</h1><center><img src="/2022/04/30/introduction-to-computer-systems-course-note/3.png" srcset="/img/loading.gif" lazyload width="60%" height="60%"></center>

<p>Use C code to get the size of a data type:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span> </span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>,<span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>)); <br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="1-1-Unsigned-amp-Signed-Integer"><a href="#1-1-Unsigned-amp-Signed-Integer" class="headerlink" title="1.1 Unsigned &amp; Signed Integer"></a>1.1 Unsigned &amp; Signed Integer</h2><blockquote>
<p>binary: 8 bits $\to$ 1 byte, not convenient to represent;<br>hexadecimal: 2 bits $\to$ 1 byte, easy to represent.</p>
</blockquote>
<h3 id="1-1-1-Bit-Level-Operations-in-C"><a href="#1-1-1-Bit-Level-Operations-in-C" class="headerlink" title="1.1.1 Bit-Level Operations in C"></a>1.1.1 Bit-Level Operations in C</h3><blockquote>
<p>Use logic expression on <strong>single bit</strong>, <code>True</code> as 1  and  <code>False</code> as 0;<br>Apply to any “integral” data type: <code>long</code>, <code>int</code>, <code>short</code>, <code>char</code>, <code>unsigned</code>, applied <strong>bit-wise</strong>;<br>Return any value;</p>
</blockquote>
<ul>
<li><code>&amp;</code>: AND (Intersection in Set)</li>
<li><code>|</code>: OR (Union in Set)</li>
<li><code>~</code>: NOT (Complement in Set)</li>
<li><code>^</code>: Exclusive-OR (Symmetric difference in Set)</li>
</ul>
<hr>
<h3 id="1-1-2-Logic-Operations-in-C"><a href="#1-1-2-Logic-Operations-in-C" class="headerlink" title="1.1.2 Logic Operations in C"></a>1.1.2 Logic Operations in C</h3><blockquote>
<p><code>True</code> as <strong>nonzero</strong> and  <code>False</code> as 0;<br>Always return 0 or 1.</p>
</blockquote>
<ul>
<li><code>&amp;&amp;</code>: Logic AND;</li>
<li><code>||</code>: Logic OR;</li>
<li><code>!</code>: Logic NOT.</li>
</ul>
<hr>
<h3 id="1-1-3-Shift-Operations"><a href="#1-1-3-Shift-Operations" class="headerlink" title="1.1.3 Shift Operations"></a>1.1.3 Shift Operations</h3><ul>
<li>Left Shift <code>x &lt;&lt; y</code><ul>
<li>Shift bit-vector x left y positions</li>
<li>Left: Throw away;</li>
<li>Right: Fill with 0’s.</li>
</ul>
</li>
<li>Right Shift <code>x &gt;&gt; y</code><ul>
<li>Shift bit-vector x right y positions</li>
<li>Right: Throw away;</li>
<li>Left:<ul>
<li><strong>Logical shift</strong>: Fill with 0’s;</li>
<li><strong>Arithmetic shift</strong>: Fill with <strong>most significant bit</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h3 id="1-1-4-Encoding-Integer"><a href="#1-1-4-Encoding-Integer" class="headerlink" title="1.1.4 Encoding Integer"></a>1.1.4 Encoding Integer</h3><ul>
<li><strong>Unsigned</strong></li>
</ul>
<script type="math/tex; mode=display">B2U(X)=\sum^{w-1}_{i=0}x_i\cdot2^i</script><ul>
<li><strong>Two’s Complement</strong></li>
</ul>
<script type="math/tex; mode=display">B2T(X)=-x_{w-1}\cdot2^{w-1}+\sum^{w-2}_{i=0}x_i\cdot2^i</script><hr>
<h3 id="1-1-5-Range"><a href="#1-1-5-Range" class="headerlink" title="1.1.5 Range"></a>1.1.5 Range</h3><ul>
<li><strong>Unsigned</strong><ul>
<li>$UMin = 0$;</li>
<li>$UMax = 2^w-1$;</li>
</ul>
</li>
<li><strong>Two’s Complement</strong><ul>
<li>$TMax = 2^{w-1}-1$</li>
<li>$TMin = -2^{w-1}$;</li>
</ul>
</li>
</ul>
<p>$|TMin|=TMax+1$ (Asymmetric Range for Two’s Complement)</p>
<p>$UMax = 2\times TMax+1$</p>
<p>$UMax=T2U(-1)$</p>
<p>$U2T(2^{w-1})=U2T(TMax+1)=TMin$</p>
<p>$T2U(TMin)=TMax+1$</p>
<hr>
<h2 id="1-2-Conversion-amp-Casting"><a href="#1-2-Conversion-amp-Casting" class="headerlink" title="1.2 Conversion &amp; Casting"></a>1.2 Conversion &amp; Casting</h2><p><strong>Conversion</strong>:</p>
<script type="math/tex; mode=display">T2U(X)= \begin{cases}
    x+2^w, &\text{$x$ $\lt$ 0} \\
    x, &\text{$x$ $\ge$ 0}
\end{cases} =x+x_{w-1}2^w \\ TMin \le x \le TMax</script><script type="math/tex; mode=display">U2T(U)= \begin{cases}
    u, &\text{$u$ $\le$ TMax} \\
    u-2^w, &\text{$u$ $\gt$ TMax}
\end{cases} =u-u_{w-1}2^w \\0\le u \le UMax</script><ul>
<li>By <strong>default</strong>: <strong>signed</strong> integers;</li>
<li>suffix <code>U</code>: Unsigned;</li>
</ul>
<hr>
<blockquote>
<p>A <strong>mix of unsigned and signed</strong> in single expression:<br><strong>signed values implicitly cast to unsigned</strong></p>
</blockquote>
<p><strong>[Example]</strong><br><img src="/2022/04/30/introduction-to-computer-systems-course-note/1.png" srcset="/img/loading.gif" lazyload alt="Effects of C promotion rules - CS:APP"></p>
<p><strong>Casting</strong>:</p>
<ul>
<li>Truncating of <strong>unsigned</strong> number:<ul>
<li>$x$: the original number <strong>w-bit</strong>; $x’$: the result of truncaing of $x$ to k-bit:</li>
<li><script type="math/tex; mode=display">x'=x\;mod\;2^k</script></li>
</ul>
</li>
<li>Truncating of <strong>two’s complement</strong> number:<ul>
<li>$x$: the original number <strong>w-bit</strong>; $x’$: the result of truncaing of $x$ to k-bit:</li>
<li><script type="math/tex; mode=display">x'=U2T_k(x\;mod\;2^k)</script></li>
</ul>
</li>
</ul>
<hr>
<h2 id="1-3-Addition-amp-Multiplication-amp-Shifting"><a href="#1-3-Addition-amp-Multiplication-amp-Shifting" class="headerlink" title="1.3 Addition &amp; Multiplication &amp; Shifting"></a>1.3 Addition &amp; Multiplication &amp; Shifting</h2><h3 id="1-3-1-Addition"><a href="#1-3-1-Addition" class="headerlink" title="1.3.1 Addition"></a>1.3.1 Addition</h3><ul>
<li>Unsigned</li>
</ul>
<script type="math/tex; mode=display">UAdd_w(u,v)=(u+v)\;mod\;2^w = \begin{cases}
    u+v, &\text{$u+v \lt 2^w$ Normal} \\
    u+v-2^w, &\text{$2^w\le x \lt 2^{w+1}$ Overflow}
\end{cases}</script><ul>
<li>Two’s Complement</li>
</ul>
<script type="math/tex; mode=display">TAdd_w(u,v)=\begin{cases}
    u+v-2^w, &\text{$u+v \ge 2^{w-1}$ Positive Overflow} \\
    u+v, &\text{$-2^{w-1} \le u+v \lt 2^{w-1}$ Normal} \\
    u+v+2^w, &\text{$x \lt -2^{w-1}$ Negative Overflow}
\end{cases}</script><hr>
<h3 id="1-3-2-Multiplication"><a href="#1-3-2-Multiplication" class="headerlink" title="1.3.2 Multiplication"></a>1.3.2 Multiplication</h3><ul>
<li>Unsigned</li>
</ul>
<script type="math/tex; mode=display">UMult_w(u,v)=(u\cdot v)\;mod\;2^w</script><ul>
<li>Two’s Complement</li>
</ul>
<script type="math/tex; mode=display">TMult_w(u,v)=U2T[(u\cdot v)\;mod\;2^w]</script><hr>
<h3 id="1-3-3-Shift-with-Power-of-2"><a href="#1-3-3-Shift-with-Power-of-2" class="headerlink" title="1.3.3 Shift with Power-of-2"></a>1.3.3 Shift with Power-of-2</h3><ul>
<li>Unsigned and Signed shift for <strong>Multiplication</strong> with Power-of-2 <script type="math/tex; mode=display">u<<k==u\times2^k</script></li>
</ul>
<blockquote>
<p>Most machines shift and add faster than multiply.</p>
</blockquote>
<p>$x <em> K$:<br>Convert the constant <code>K</code> in binary, consider a run of <strong>ones</strong> from bit position $n$ down to bit position $m$ ($n\ge m$), $x </em> K$ can be represented in:</p>
<p>$(x&lt;&lt;n)+(x&lt;&lt;(n-1))+…+(x&lt;&lt;m)$, or<br>$(x&lt;&lt;(n+1))-(x&lt;&lt;m)$</p>
<ul>
<li>Unsigned shift for <strong>Quotient</strong> with Power-of-2 </li>
</ul>
<script type="math/tex; mode=display">u>>k==\lfloor u/2^k\rfloor</script><hr>
<h2 id="1-4-Memory-amp-Pointers-amp-Strings-Representations"><a href="#1-4-Memory-amp-Pointers-amp-Strings-Representations" class="headerlink" title="1.4 Memory &amp; Pointers &amp; Strings Representations"></a>1.4 Memory &amp; Pointers &amp; Strings Representations</h2><h3 id="1-4-1-Memory"><a href="#1-4-1-Memory" class="headerlink" title="1.4.1 Memory"></a>1.4.1 Memory</h3><ul>
<li>Programs refer to data by <strong>address</strong>;</li>
<li>Each byte has a address;</li>
<li>Word Size: how many data can be transferred in the I/O BUS at a clock time;</li>
</ul>
<hr>
<h3 id="1-4-2-Byte-Ordering"><a href="#1-4-2-Byte-Ordering" class="headerlink" title="1.4.2 Byte Ordering"></a>1.4.2 Byte Ordering</h3><ul>
<li>Big Endian:<ul>
<li><strong>Least</strong> significant byte has <strong>highest</strong> address;</li>
<li>Sun, PPC Mac, Internet</li>
</ul>
</li>
<li>Little Endian<ul>
<li><strong>Least</strong> significant byte has <strong>lowest</strong> address;</li>
<li>x86, ARM processors running Android, iOS, and Windows</li>
</ul>
</li>
</ul>
<p><strong>[Example]</strong></p>
<p><img src="/2022/04/30/introduction-to-computer-systems-course-note/2.png" srcset="/img/loading.gif" lazyload alt="Byte Ordering"></p>
<hr>
<h3 id="1-4-3-Pointer"><a href="#1-4-3-Pointer" class="headerlink" title="1.4.3 Pointer"></a>1.4.3 Pointer</h3><ul>
<li>Size of a pointer: depends on the word-size of a computer<ul>
<li>size of 4: 32-bit; </li>
<li>size of 8: 64-bit.</li>
</ul>
</li>
</ul>
<h3 id="1-4-4-String"><a href="#1-4-4-String" class="headerlink" title="1.4.4 String"></a>1.4.4 String</h3><ul>
<li>Array of characters;</li>
<li>Encoded in <strong>ASCII</strong> format;</li>
<li>String should be <strong>null-terminate</strong>: Final character = 0;</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">char</span> S[<span class="hljs-number">6</span>] = <span class="hljs-string">&quot;18213&quot;</span>; <span class="hljs-comment">// length is 6;</span><br>[ <span class="hljs-comment">// IA32, Sun</span><br>    <span class="hljs-number">31</span>,<br>    <span class="hljs-number">38</span>,<br>    <span class="hljs-number">32</span>,<br>    <span class="hljs-number">31</span>,<br>    <span class="hljs-number">33</span>,<br>    <span class="hljs-number">00</span> <span class="hljs-comment">// Final character = 0</span><br>]<br></code></pre></td></tr></table></figure>
<hr>
<h1 id="2-Data-representation-II"><a href="#2-Data-representation-II" class="headerlink" title="2 Data representation II"></a>2 Data representation II</h1><h2 id="2-1-Fixed-Pointer-Representation"><a href="#2-1-Fixed-Pointer-Representation" class="headerlink" title="2.1 Fixed Pointer Representation"></a>2.1 Fixed Pointer Representation</h2><p>Write a decimal number in binary:</p>
<script type="math/tex; mode=display">b_ib_{i-1}...b_2b_1.b_{-1}b_{-2...b_{-j}}</script><p>then</p>
<script type="math/tex; mode=display">b=\sum_{k=-j}^ib_k\times 2^k</script><p>Limitations:</p>
<blockquote>
<ol>
<li>Can only exactly represent numbers of the form $\frac{x}{2^k}$</li>
<li>Limited range of numbers, can not represent very large and very small numbers, due to the point is <strong>fixed</strong>.</li>
</ol>
</blockquote>
<p>Judge whether a decimal number can be exactly represented:</p>
<blockquote>
<p>write into form of $\frac{x}{2^k}$, if can write, YES; if can not, NO;<br>e.g., $0.18=\frac{9}{50}$, not in that form, NO. </p>
</blockquote>
<hr>
<h2 id="2-2-IEEE-754-Floating-Point-Representation"><a href="#2-2-IEEE-754-Floating-Point-Representation" class="headerlink" title="2.2 IEEE 754 Floating Point Representation"></a>2.2 IEEE 754 Floating Point Representation</h2><h3 id="2-2-1-Numerical-Form"><a href="#2-2-1-Numerical-Form" class="headerlink" title="2.2.1 Numerical Form"></a>2.2.1 Numerical Form</h3><script type="math/tex; mode=display">V = (-1)^s\times M\times 2^E</script><blockquote>
<p>$s$: sign bit, determines positive(0) or negative(1);<br>$M$: significand, fractional value in $[1.0,2.0)$;<br>$E$: exponent, weights value by power of two.</p>
</blockquote>
<hr>
<h3 id="2-2-2-Encoding"><a href="#2-2-2-Encoding" class="headerlink" title="2.2.2 Encoding"></a>2.2.2 Encoding</h3><center><img src="/2022/04/30/introduction-to-computer-systems-course-note/4.png" srcset="/img/loading.gif" lazyload width="60%" height="60%"></center>

<blockquote>
<p>In binary<br>$s$ is the sign bit;<br>$exp$ is the encoded $E$;<br>$frac$ is the encoded $M$</p>
</blockquote>
<p><strong>Categories of single-precision floating-point values in IEEE 754:</strong></p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/5.png" srcset="/img/loading.gif" lazyload width="60%" height="60%"></center>

<hr>
<h4 id="2-2-2-1-Normalized"><a href="#2-2-2-1-Normalized" class="headerlink" title="2.2.2.1 Normalized"></a>2.2.2.1 Normalized</h4><blockquote>
<p>The $exp$ is neither all $1$s nor $0$s, $exp\ne 0000\;0000(0)$, $exp\ne 1111\;1111(255)$;</p>
<p>$s$: 1-bit sign bit<br>$exp$: 8-bit, encode in biased $(2^{k-1}-1)$, $exp=E+127$, $E=exp-127$, $[-126,127]\to [0000\;0001,0111\;1111]$;<br>$f$: 23-bit,encoded with hidden-1, $M=1.f=1.xxx…x_2$.</p>
</blockquote>
<hr>
<h4 id="2-2-2-2-Denormalized"><a href="#2-2-2-2-Denormalized" class="headerlink" title="2.2.2.2 Denormalized"></a>2.2.2.2 Denormalized</h4><blockquote>
<p>The $exp$ is all $0$s, $exp= 0000\;0000(0)$;</p>
<p>$s$: 1-bit sign bit<br>$exp$: 8-bit, encode to $0000\;0000$, $E=1-(2^{k-1}-1)$, $E=1-127=-126$;<br>$f$: 23-bit,encoded <strong>without</strong> hidden-1, $M=0.f=0.xxx…x_2$.</p>
</blockquote>
<p>With the feature of $exp$ and no hidden-1, the denormalized value can represent <strong>value $0$</strong> and <strong>very close to $0.0$</strong>.</p>
<blockquote>
<p>$exp=0000\;0000$, $frac=0000\;0000$: represent $0$;<br>$exp=0000\;0000$, $frac\ne 0000\;0000$: represent values very close to $0$;</p>
</blockquote>
<hr>
<h4 id="2-2-2-3-Special-Values"><a href="#2-2-2-3-Special-Values" class="headerlink" title="2.2.2.3 Special Values"></a>2.2.2.3 Special Values</h4><blockquote>
<p>The $exp$ is all $1$s, $exp= 1111\;1111(255)$;</p>
<p>$s$: 1-bit sign bit</p>
<p>$exp=1111\;1111$, $frac=0000\;0000$: represent $\infin$;<br>$s=0$: $+\infin$,$s=1$: $-\infin$;<br>represent the <strong>overflow</strong> result;</p>
<p>$exp=1111\;1111$, $frac\ne 0000\;0000$: represent $NaN$ (Not-a-Number);<br>like $\sqrt{-1},\infin-\infin, \infin \times 0$</p>
</blockquote>
<hr>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/8.png" srcset="/img/loading.gif" lazyload width="80%" height="80%"></center>

<hr>
<h2 id="2-3-Rounding"><a href="#2-3-Rounding" class="headerlink" title="2.3 Rounding"></a>2.3 Rounding</h2><p><strong>Using the Round-To-Even</strong></p>
<p>Round to 3 d.p.</p>
<script type="math/tex; mode=display">1.BBG\;R\;XXX</script><ul>
<li>$G$: Guard bit, the LSB of rounded result;</li>
<li>$R$: Round bit, first bit to remove;</li>
<li>$S$: $S=X|X|X$, Stick bit, OR of remaining bis.</li>
</ul>
<blockquote>
<p>$R\;XXX\lt$ half-way(e.g., 1/2), means $R=0$, then round down;<br>$R\;XXX\gt$ half-way(e.g., 1/2), means $R=1,S=1$, then round up;<br>$R\;XXX=$ half-way(e.g., 1/2), means $R=1,S=0$, then <strong>round to even</strong>:</p>
<blockquote>
<p>if $G=1$: round up(+1);<br>if $G=0$: round down;</p>
</blockquote>
</blockquote>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/6.png" srcset="/img/loading.gif" lazyload width="60%" height="60%"></center>

<p>Rounding may cause overflow, then use <strong>Postnormalize</strong>:</p>
<ul>
<li>Shifting the overflowed value <strong>right</strong> once and <strong>incrementing</strong> the exponent</li>
</ul>
<hr>
<h2 id="2-4-Floating-Point-Operations"><a href="#2-4-Floating-Point-Operations" class="headerlink" title="2.4 Floating Point Operations"></a>2.4 Floating Point Operations</h2><ul>
<li>First compute the exact result;</li>
<li>Fix:<ul>
<li>Possibly <strong>overflow</strong> if exponent too large;</li>
<li>Possibly <strong>round</strong> to fit into $frac$</li>
</ul>
</li>
</ul>
<hr>
<h3 id="2-4-1-Floating-Point-Multiplication"><a href="#2-4-1-Floating-Point-Multiplication" class="headerlink" title="2.4.1 Floating Point Multiplication"></a>2.4.1 Floating Point Multiplication</h3><p>E.g.</p>
<script type="math/tex; mode=display">(-1)^{s_1} M_12^{E_1}\times(-1)^{s_2} M_22^{E_2}</script><p><strong>Result:</strong><br>$(-1)^{s} M2^{E}$</p>
<blockquote>
<p>$s=$ $s_1$^$s_2$ (exclusive-OR)<br>$M=M_1\times M_2$<br>$E=E_1+E_2$</p>
</blockquote>
<p><strong>Fix:</strong></p>
<ul>
<li>if $M\ge2$, overflow, then <strong>Postnormalize</strong>, shift M right, increment E;</li>
<li>if $E$ out of range, then the result is <strong>overflow</strong>;</li>
<li>Round $M$ to fit the precision.</li>
</ul>
<p><strong>Note on Mathematical Properties:</strong></p>
<ul>
<li>Has <strong>Commutative</strong>;</li>
<li>No <strong>Associative</strong>, may cause overflow;</li>
<li>Has <strong>1 is multiplicative identity</strong>;</li>
<li>No <strong>Distributive</strong>.</li>
</ul>
<hr>
<h3 id="2-4-2-Floating-Point-Addition"><a href="#2-4-2-Floating-Point-Addition" class="headerlink" title="2.4.2 Floating Point Addition"></a>2.4.2 Floating Point Addition</h3><p>E.g.</p>
<script type="math/tex; mode=display">(-1)^{s_1} M_12^{E_1}+(-1)^{s_2} M_22^{E_2}\\E_1\gt E_2</script><p><strong>Result:</strong><br>$(-1)^{s} M2^{E}$</p>
<ul>
<li>First need to get them lined up:<ul>
<li>increase $E_2$ to equal to $E_1$,</li>
<li>shift $M_2$ right $E_1-E_2$</li>
</ul>
</li>
</ul>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/7.png" srcset="/img/loading.gif" lazyload width="40%" height="40%"></center>

<ul>
<li>$s$ and $M$ depends on the result;</li>
<li>$E=E_1$</li>
</ul>
<p><strong>Fix</strong>:</p>
<ul>
<li>if $M\ge2$, overflow, then <strong>Postnormalize</strong>, shift M right, increment E;</li>
<li>if $M\lt1$, then <strong>Postnormalize</strong>, shift M left, decrement E;</li>
<li>if $E$ out of range, then the result is <strong>overflow</strong>;</li>
<li>Round $M$ to fit the precision.</li>
</ul>
<p><strong>Note on Mathematical Properties:</strong></p>
<ul>
<li>Has <strong>Commutative</strong>;</li>
<li>No <strong>Associative</strong>, may cause overflow;</li>
<li>Has <strong>0 is multiplicative identity</strong>;</li>
<li>Almost <strong>Additive Inverse</strong>(except $\pm \infin$ and $NaN$).</li>
</ul>
<hr>
<h3 id="2-4-3-Float-Point-Comparison"><a href="#2-4-3-Float-Point-Comparison" class="headerlink" title="2.4.3 Float Point Comparison"></a>2.4.3 Float Point Comparison</h3><ul>
<li>Floating Point 0 = Integer 0</li>
<li>Must first compare <strong>sign bits</strong>;</li>
<li>Must consider $−0$ = $0$;</li>
</ul>
<hr>
<h1 id="3-Machine-language"><a href="#3-Machine-language" class="headerlink" title="3 Machine language"></a>3 Machine language</h1><h2 id="3-1-History-of-Intel-processors-and-architectures"><a href="#3-1-History-of-Intel-processors-and-architectures" class="headerlink" title="3.1 History of Intel processors and architectures"></a>3.1 History of Intel processors and architectures</h2><ul>
<li>Complex instruction set computer (CISC)<br>A single instruction <strong>consists of several lower-level operations</strong>;<ul>
<li>Data transfer from memory, computation, saving result into register;</li>
<li>Different memory addressing modes can be used. </li>
</ul>
</li>
</ul>
<hr>
<h2 id="3-2-C-assembly-machine-code"><a href="#3-2-C-assembly-machine-code" class="headerlink" title="3.2 C assembly machine code"></a>3.2 C assembly machine code</h2><ul>
<li><p><strong>Architecture</strong>:</p>
<ul>
<li>The parts of a processor design that one needs to understand or write assembly/machine code;</li>
<li>Specification of the instruction set and registers</li>
</ul>
</li>
<li><p><strong>ISA</strong>:<br>Instruction Set Architecture;</p>
</li>
<li><p><strong>Microarchitecture</strong>:<br>Implementation of the architecture</p>
</li>
<li><p><strong>Machine Code</strong>:<br>The byte-level programs that a processor executes </p>
</li>
<li><p><strong>Assembly Code</strong>:<br>A text representation of <strong>machine code</strong>, more <strong>readable</strong> for human. </p>
</li>
<li><p><strong>Turning C into Object Code</strong>:</p>
</li>
</ul>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/9.png" srcset="/img/loading.gif" lazyload width="70%" height="70%"></center>

<ul>
<li><strong>Size of C Data Types in x86-64</strong>:<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/10.png" srcset="/img/loading.gif" lazyload width="70%" height="70%"></center>

</li>
</ul>
<hr>
<h2 id="3-3-Registers-operands-move"><a href="#3-3-Registers-operands-move" class="headerlink" title="3.3 Registers, operands, move"></a>3.3 Registers, operands, move</h2><h3 id="3-3-1-x86-64-Integer-Registers"><a href="#3-3-1-x86-64-Integer-Registers" class="headerlink" title="3.3.1 x86-64 Integer Registers"></a>3.3.1 x86-64 Integer Registers</h3><center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/11.png" srcset="/img/loading.gif" lazyload width="100%">
<br>
    <div style="color:orange; 
    border-bottom: 15px solid rgba(0,0,0,0);
    display: inline-block;
    color: #999;
    padding: 0px;">x86-64 Integer Registers (CS: APP)</div>
</center>


<p>x86-64 CPU has a set of 16 64-bit <em>general-purpose register</em>, storing integer data and pointers(addresses):</p>
<ul>
<li>Start from <strong>8086</strong>, 8 <strong>16-bit</strong> register (in <font color="#f00"><b>RED</b></font> box): <code>%ax</code>to<code>%bp</code>;</li>
<li>Then to <strong>IA32</strong>, extended to 8 <strong>32-bit</strong> register (in <font color="#00f"><b>BLUE</b></font> box) :<code>%eax</code>to<code>%ebp</code>; </li>
<li>Finally to <strong>x86-64</strong>, extended to 8 <strong>64-bit</strong> register (in <strong>BLACK</strong> box): <code>%rax</code>to<code>%rbp</code>, as well as additional new 8 <strong>64-bit</strong> register (in DOT LINE box) :<code>%r8</code>to<code>%r15</code>; </li>
</ul>
<p>Different registers have different functions:</p>
<ul>
<li><code>%rsp</code> has a <strong>specific</strong> function: <strong>stack pointer</strong>, indicate the end position of run-time stack;</li>
<li>Other 15 registers have more flexible functions.</li>
</ul>
<p>Instructions can operate on <strong>different data size</strong> in <strong>low-order</strong> of the 16 registers:</p>
<ul>
<li><strong>8-bit</strong> instruction: can access <strong>least significant 1 byte</strong>;</li>
<li><strong>16-bit</strong> instruction: can access <strong>least significant 2 byte</strong>;</li>
<li><strong>32-bit</strong> instruction: can access <strong>least significant 4 byte</strong>;</li>
<li><strong>64-bit</strong> instruction: can access <strong>entire register</strong>;</li>
</ul>
<hr>
<h3 id="3-3-2-Operand-Types"><a href="#3-3-2-Operand-Types" class="headerlink" title="3.3.2 Operand Types"></a>3.3.2 Operand Types</h3><center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/12.png" srcset="/img/loading.gif" lazyload width="60%">
<br>
    <div style="color:orange; 
    border-bottom: 15px solid rgba(0,0,0,0);
    display: inline-block;
    color: #999;
    padding: 0px;">Operand Types (CS: APP)</div>
</center>

<p>Three Types:</p>
<ul>
<li><strong>Immediate</strong>: <ul>
<li>constant <strong>value</strong>, started with <code>$</code>, followed by a integer in standard C notation;</li>
</ul>
</li>
<li><strong>Register</strong>: <ul>
<li><strong>contents of a register</strong>, each bit length of instruction has its specific among of bits (e.g., 8-byte register:64 bits);</li>
<li>Notation $r_a$ indicates the <strong>register $a$</strong> and <strong>its value in reference $R[r_a]$</strong> indexed by the register identifiers in an array $R$;</li>
</ul>
</li>
<li><strong>Memory</strong>:<ul>
<li>Access memory location based on the computed address - <strong><em>effective address</em></strong>;</li>
<li>$M_b[Addr]$: reference to the $b$-byte value in memory <strong><em>starting</em></strong> at address $Addr$;</li>
<li>$Imm(r_b,r_i,s)$: the most general form:<ul>
<li>$Imm$: <strong>immediate offset</strong>;</li>
<li>$r_b$: <strong>base register</strong>, 64-bit (like the start of array);</li>
<li>$r_i$: <strong>index register</strong>, 64-bit (the index of the array);</li>
<li>$s$: <strong>scale factor</strong>, must be <strong>1,2,4, or 8</strong> (fix to the data length);</li>
<li><strong><em>effective address</em></strong> $=Imm+R[r_b]+R[r_i]\cdot s$;</li>
<li>The value is $M[Imm+R[r_b]+R[r_i]\cdot s]$;</li>
</ul>
</li>
<li>These complex addressing modes useful in <strong>Array and structure elements referencing</strong>.</li>
<li><strong>Simple Memory Addressing Modes</strong>:<ul>
<li><strong>Normal</strong>: $(R)\to Mem[Reg[R]]$, Register $R$ specifies memory address, <strong>Pointer</strong> dereferencing in C;<br><code>movq (%rcx),%rax</code></li>
<li><strong>Displacement</strong>: $D(R)\to Mem[Reg[R]+D]$, Register $R$ specifies start of memory region;<br><code>movq 8(%rbp),%rdx</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h3 id="3-3-3-Moving-Data"><a href="#3-3-3-Moving-Data" class="headerlink" title="3.3.3 Moving Data"></a>3.3.3 Moving Data</h3><blockquote>
<p>Copy data from a <strong>source</strong> location to a <strong>destination</strong> location, <strong>without transformation</strong>. </p>
</blockquote>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/13.png" srcset="/img/loading.gif" lazyload width="60%">
<br>
    <div style="color:orange; 
    border-bottom: 15px solid rgba(0,0,0,0);
    display: inline-block;
    color: #999;
    padding: 0px;">Moving Data (CS: APP)</div>
</center>

<p>Source(S):</p>
<ul>
<li>value of <strong>immediate</strong>;</li>
<li>value in <strong>register</strong>;</li>
<li>value in <strong>memory</strong>.</li>
</ul>
<p>Destination(D):</p>
<ul>
<li><strong>register</strong>;</li>
<li><strong>memory address</strong>.</li>
</ul>
<blockquote>
<p>Copy from a memory to another memory:<br><strong>Can not directly copy</strong>, first load the memory value to a <strong>register</strong>, then write the register value to the destination memory.</p>
</blockquote>
<p>For register operand:</p>
<ul>
<li>The size of the <strong>register</strong> must match the <strong>last</strong> character of the instruction(<code>b</code>,<code>w</code>,<code>l</code>,<code>q</code>);</li>
<li>The <code>MOV</code> instruction will only update the specific byte indicated by the destination operand,<br>Except the <code>movl</code> instruction with the register destination, it will set high-order 4-byte to 0. (For the convention in x86-64 from 64-bit to 32-bit to adopt)</li>
</ul>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/14.png" srcset="/img/loading.gif" lazyload width="70%">
<br>
    <div style="color:orange; 
    border-bottom: 15px solid rgba(0,0,0,0);
    display: inline-block;
    color: #999;
    padding: 0px;">movq Operand Combinations</div>
</center>

<hr>
<h2 id="3-4-Arithmetic-amp-logical-operations"><a href="#3-4-Arithmetic-amp-logical-operations" class="headerlink" title="3.4 Arithmetic &amp; logical operations"></a>3.4 Arithmetic &amp; logical operations</h2><h3 id="3-4-1-Two-Operand-Instructions"><a href="#3-4-1-Two-Operand-Instructions" class="headerlink" title="3.4.1 Two Operand Instructions"></a>3.4.1 Two Operand Instructions</h3><center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/15.png" srcset="/img/loading.gif" lazyload width="50%">
<br>
    <div style="color:orange; 
    border-bottom: 15px solid rgba(0,0,0,0);
    display: inline-block;
    color: #999;
    padding: 0px;">Two Operand Instructions (CS: APP)</div>
</center>

<ul>
<li>S: <strong>immediate value</strong>, <strong>register</strong>, <strong>memory location</strong>;</li>
<li>D: <strong>register</strong>, <strong>memory location</strong>;</li>
<li>S, D can NOT both be memory;</li>
<li>Source operand first, Destination second;</li>
<li><code>Fun S, D</code> —&gt; <code>D = D fun S</code></li>
<li><code>subq %rax, %rdx</code>: <code>%rdx = %rdx - %rax</code> (Subtract <code>%rax</code> from <code>%rax</code>)</li>
</ul>
<hr>
<p><strong>For Shift Instructions</strong>:</p>
<p>Source and Destination can be <strong>register</strong> or <strong>memory location</strong>. </p>
<p>Shift amount (2 ways):</p>
<ul>
<li>immediate value: <code>k</code></li>
<li>single-byte register <code>%cl</code>:<ul>
<li>based data: <strong>w</strong>-bit (i.e. 8,16,32,64);</li>
<li>shift amount: value of low-order <strong>m</strong>-bit of <code>%cl</code>, $2^m=w,m=\log_2w$;<ul>
<li>e.g. 8-bit: lower 3-bit value of <code>%cl</code>;</li>
<li>64-bit: lower 6-bit value of <code>%cl</code>;</li>
</ul>
</li>
<li>Example: <code>%cl</code> = 0xFF = 1111 1111:<ul>
<li><code>salb</code>: 8-bit, shift lower 3-bit value = 111 = 7;</li>
<li><code>salw</code>: 16-bit, shift lower 4-bit value = 1111 = 15;</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Left Shift:</p>
<ul>
<li><code>SAL</code>: <strong>arithmetic</strong> left shift;</li>
<li><code>SHL</code>: <strong>logical</strong> left shift;</li>
<li>Same effect, fill right with zero;</li>
</ul>
<p>Right Shift:</p>
<ul>
<li><code>SAR</code>: <strong>arithmetic</strong> right shift, fill copy of the <strong>sign bits</strong>;</li>
<li><code>SHR</code>: <strong>logical</strong> right shift, fill left with <strong>zeros</strong>;</li>
</ul>
<hr>
<h3 id="3-4-2-One-Operand-Instructions"><a href="#3-4-2-One-Operand-Instructions" class="headerlink" title="3.4.2 One Operand Instructions"></a>3.4.2 One Operand Instructions</h3><center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/16.png" srcset="/img/loading.gif" lazyload width="50%">
<br>
    <div style="color:orange; 
    border-bottom: 15px solid rgba(0,0,0,0);
    display: inline-block;
    color: #999;
    padding: 0px;">Two Operand Instructions (CS: APP)</div>
</center>

<p>Unary Instructions:</p>
<ul>
<li>Operand can be <strong>register</strong> or <strong>memory location</strong>. </li>
</ul>
<hr>
<h3 id="3-4-3-Address-Computation-Instruction"><a href="#3-4-3-Address-Computation-Instruction" class="headerlink" title="3.4.3 Address Computation Instruction"></a>3.4.3 Address Computation Instruction</h3><p><code>leap</code> <strong>Instructions</strong>:</p>
<ul>
<li><strong><em>load effective address</em></strong> instruction;</li>
<li>read memory address to a register;</li>
<li><strong>NO access to the memory, just load the address</strong>;</li>
<li>$\&amp;S$: C address operator, like a pointer;</li>
</ul>
<p><strong>[Example]</strong></p>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/17.png" srcset="/img/loading.gif" lazyload width="60%">
<br>
    <div style="color:orange; 
    border-bottom: 15px solid rgba(0,0,0,0);
    display: inline-block;
    color: #999;
    padding: 0px;">Example of leap Instructions (CS: APP)</div>
</center>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/18.png" srcset="/img/loading.gif" lazyload width="50%">
<br>
    <div style="color:orange; 
    border-bottom: 15px solid rgba(0,0,0,0);
    display: inline-block;
    color: #999;
    padding: 0px;">Example of leap Instructions (CS: APP)</div>
</center>

<hr>
<p><strong>Important Usage</strong>:</p>
<ul>
<li>Computing addresses without a memory reference;</li>
<li><strong>Computing arithmetic expressions of the form $x + k\times y,k=1,2,4,8$</strong>:</li>
</ul>
<p><strong>[Example]</strong></p>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/19.png" srcset="/img/loading.gif" lazyload width="60%">
<br>
    <div style="color:orange; 
    border-bottom: 15px solid rgba(0,0,0,0);
    display: inline-block;
    color: #999;
    padding: 0px;">Example of Computing arithmetic expressions (CS: APP)</div>
</center>

<hr>
<h2 id="3-5-Conditional-Codes"><a href="#3-5-Conditional-Codes" class="headerlink" title="3.5 Conditional Codes"></a>3.5 Conditional Codes</h2><blockquote>
<p>Condition Codes(CC): Describe <strong>attributes</strong> of the <strong>most recent</strong> arithmetic or logic operation. </p>
</blockquote>
<ul>
<li><code>CF</code>: <strong>Carry Flag</strong>, the <strong>carry out</strong> of the MSB, to detect <strong>overflow for unsigned operations</strong>;</li>
<li><code>ZF</code>: <strong>Zero Flag</strong>, Yielding <strong>zero</strong>;</li>
<li><code>SF</code>: <strong>Sign Flag</strong>, Yielding a <strong>negative value</strong>;</li>
<li><code>OF</code>: <strong>Overflow Flag</strong>, <strong>overflow due to two’s complement</strong>, negative or positive. </li>
</ul>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/20.png" srcset="/img/loading.gif" lazyload width="60%">
<br>
    <div style="color:orange; 
    border-bottom: 15px solid rgba(0,0,0,0);
    display: inline-block;
    color: #999;
    padding: 0px;">Integer arithmetic operations (CS: APP)</div>
</center>

<p>In above <strong>Integer arithmetic operations</strong>:</p>
<ul>
<li>For <code>leaq</code>: do not update to CC, only compute the address;</li>
<li>For others: causes the CC to be set,<ul>
<li>For <strong>logical operations</strong> (e.g. <code>XOR</code>), <code>CF</code> and <code>OF</code> set to <strong>0</strong>;</li>
<li>For <strong>shift operations</strong>,<code>CF</code> set to the <strong>last bit shifted out</strong>; <code>OF</code> set to <strong>0</strong>;</li>
<li>For <code>INC</code> and <code>DEC</code>: <code>OF</code> and <code>ZF</code> will be set, NO change to <code>CF</code>. </li>
</ul>
</li>
</ul>
<p><strong>[Example]</strong></p>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/21.png" srcset="/img/loading.gif" lazyload width="70%">
</center>

<hr>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/22.png" srcset="/img/loading.gif" lazyload width="60%">
<br>
    <div style="color:orange; 
    border-bottom: 15px solid rgba(0,0,0,0);
    display: inline-block;
    color: #999;
    padding: 0px;">Comparison and test instructions (CS: APP)</div>
</center>

<blockquote>
<p><code>CMP</code> and <code>TEST</code> set CC <strong>without changing any other registers</strong>:</p>
</blockquote>
<p><code>CMP</code>:</p>
<ul>
<li>Set CC based on the <strong>difference</strong>;</li>
<li>Same as <code>SUB</code>, without changing the destination;</li>
<li><code>CMP S1, S2</code>: <strong><code>S2-S1</code></strong>, in <strong>reverse</strong> order;</li>
<li><code>ZF</code>: <strong>0</strong> means two operands are <strong>equal</strong>;</li>
<li>Other flags: the ordering relation between them;</li>
</ul>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/23.png" srcset="/img/loading.gif" lazyload width="70%">
</center>

<hr>
<p><code>TEST</code>:</p>
<ul>
<li>Same as <code>AND</code>, without changing the destination;</li>
<li>Two <strong>same operands</strong>: to detect whether it is <strong>negative, zero or positive</strong>;</li>
<li><strong>Marked operand</strong>: to detect some <strong>specific</strong> bits.</li>
</ul>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/24.png" srcset="/img/loading.gif" lazyload width="70%">
</center>

<hr>
<h3 id="3-5-1-Reading-Conditional-Codes"><a href="#3-5-1-Reading-Conditional-Codes" class="headerlink" title="3.5.1 Reading Conditional Codes"></a>3.5.1 Reading Conditional Codes</h3><center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/25.png" srcset="/img/loading.gif" lazyload width="70%">
<br>
    <div style="color:orange; 
    border-bottom: 15px solid rgba(0,0,0,0);
    display: inline-block;
    color: #999;
    padding: 0px;">The SET instructions (CS: APP)</div>
</center>

<p>Using the CC:</p>
<ul>
<li>Set <strong>single bit</strong> to 0 or 1 based on the combinations of the CC;</li>
<li>Conditionally jump;</li>
<li>Conditionally transfer data. </li>
</ul>
<p>For the first case, the SET instructions:</p>
<ul>
<li><strong>Destination</strong>: low-order <strong>single-byte</strong> register, or single-byte memory location;<ul>
<li>Will <strong>not alter the remaining bytes</strong>, need to <strong>clear upper bits</strong> to 0, using e.g. <code>movzbl</code>. </li>
</ul>
</li>
</ul>
<p><strong>[Example]</strong><br>For <code>a &lt; b</code> expression in C:</p>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/26.png" srcset="/img/loading.gif" lazyload width="70%">
<br>
    <div style="color:orange; 
    border-bottom: 15px solid rgba(0,0,0,0);
    display: inline-block;
    color: #999;
    padding: 0px;">Example of the SET instructions (CS: APP)</div>
</center>

<hr>
<h2 id="3-6-Conditional-Branches"><a href="#3-6-Conditional-Branches" class="headerlink" title="3.6 Conditional Branches"></a>3.6 Conditional Branches</h2><p><strong>Jumping</strong>:</p>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/27.png" srcset="/img/loading.gif" lazyload width="70%">
</center>

<p><strong>Goto</strong> Code:</p>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/28.png" srcset="/img/loading.gif" lazyload width="70%">
</center>

<p><strong>General Conditional Expression</strong>:<br><code>val = Test? Then_Expr : Else_Expr;</code></p>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/29.png" srcset="/img/loading.gif" lazyload width="60%">
</center>

<hr>
<p><strong>Conditional Move</strong> Branches:</p>
<blockquote>
<p>All <code>Then_Expr</code> and <code>Else_Expr</code> will be executed, not required jump to save time. </p>
</blockquote>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/30.png" srcset="/img/loading.gif" lazyload width="70%">
</center>

<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/31.png" srcset="/img/loading.gif" lazyload width="60%">
</center>

<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/32.png" srcset="/img/loading.gif" lazyload width="70%">
</center>

<hr>
<p><strong>Bad Cases</strong> for Conditional Move:</p>
<ul>
<li><p>Expensive Computations</p>
<ul>
<li><code>val = Test(x) ? Hard1(x) : Hard2(x);</code></li>
<li>Both function need to be executed;</li>
<li>Only use it when computations are very simple;</li>
</ul>
</li>
<li><p>Risky Computation</p>
<ul>
<li><code>val = p ? *p : 0;</code></li>
<li>Both value get computed;</li>
<li>May be <code>*0</code>, null pointer, error!</li>
<li>May have undesirable effect. </li>
</ul>
</li>
<li><p>With side effects</p>
<ul>
<li><code>val = x &gt; 0 ? x*=7 : x+= 3;</code></li>
<li>Both value get computed;</li>
<li>Same variable got change;</li>
<li>MUST be side-effect free!</li>
</ul>
</li>
</ul>
<hr>
<h2 id="3-6-Loops"><a href="#3-6-Loops" class="headerlink" title="3.6 Loops"></a>3.6 Loops</h2><h3 id="3-6-1-Do-while-Loop"><a href="#3-6-1-Do-while-Loop" class="headerlink" title="3.6.1 Do-while Loop"></a>3.6.1 Do-while Loop</h3><center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/33.png" srcset="/img/loading.gif" lazyload width="70%">
</center>

<hr>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/34.png" srcset="/img/loading.gif" lazyload width="70%">
</center>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/35.png" srcset="/img/loading.gif" lazyload width="70%">
</center>

<hr>
<h3 id="3-6-2-While-Loop"><a href="#3-6-2-While-Loop" class="headerlink" title="3.6.2 While Loop"></a>3.6.2 While Loop</h3><ul>
<li><strong>Jump-to-middle</strong> Translation</li>
</ul>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/36.png" srcset="/img/loading.gif" lazyload width="70%">
</center>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/37.png" srcset="/img/loading.gif" lazyload width="70%">
</center>

<p><strong>Jump to the test at very beginning, then jump to the middle for body.</strong></p>
<hr>
<ul>
<li><strong>Do-while</strong> translation</li>
</ul>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/38.png" srcset="/img/loading.gif" lazyload width="70%">
</center>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/39.png" srcset="/img/loading.gif" lazyload width="70%">
</center>



<hr>
<h3 id="3-6-3-For-Loop"><a href="#3-6-3-For-Loop" class="headerlink" title="3.6.3 For Loop"></a>3.6.3 For Loop</h3><center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/40.png" srcset="/img/loading.gif" lazyload width="70%">
</center>

<p>For-while conversion:</p>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/41.png" srcset="/img/loading.gif" lazyload width="70%">
</center>

<p>For to Do-while conversion:</p>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/42.png" srcset="/img/loading.gif" lazyload width="70%">
</center>

<hr>
<h2 id="3-7-Switch-Statement"><a href="#3-7-Switch-Statement" class="headerlink" title="3.7 Switch Statement"></a>3.7 Switch Statement</h2><center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/43.png" srcset="/img/loading.gif" lazyload width="70%">
</center>

<ul>
<li><strong>Check the range of</strong> <code>x</code>:</li>
</ul>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/44.png" srcset="/img/loading.gif" lazyload width="70%">
</center>

<ul>
<li>Take the jump table as a <strong>Array</strong>, using indirect jump to assess memory jump target:</li>
</ul>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/45.png" srcset="/img/loading.gif" lazyload width="70%">
</center>

<ul>
<li><code>jmp</code>: unconditionally jump, <strong>direct</strong> and <strong>indirect</strong> jump:<ul>
<li><strong>direct</strong> jump: jump target encoded in the instruction, giving the <strong>target label</strong>, e.g.<ul>
<li><code>jmp .L1</code>;</li>
</ul>
</li>
<li><strong>indirect</strong> jump: jump target read from <strong>register or memory address</strong>, using <code>*</code> following by an operand specifier, e.g.,<ul>
<li><code>jmp *%rax</code>: <strong>register</strong> jump target;</li>
<li><code>jmp *(%rax)</code>: <strong>memory</strong> location target;</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/46.png" srcset="/img/loading.gif" lazyload width="70%">
</center>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/47.png" srcset="/img/loading.gif" lazyload width="70%">
</center>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/48.png" srcset="/img/loading.gif" lazyload width="70%">
</center>
<center>
<img src="/2022/04/30/introduction-to-computer-systems-course-note/49.png" srcset="/img/loading.gif" lazyload width="70%">
</center>

<hr>
<h1 id="4-Processor-Architecture"><a href="#4-Processor-Architecture" class="headerlink" title="4 Processor Architecture"></a>4 Processor Architecture</h1><h2 id="4-1-Instruction-Set-Architecture"><a href="#4-1-Instruction-Set-Architecture" class="headerlink" title="4.1 Instruction Set Architecture"></a>4.1 Instruction Set Architecture</h2><p><strong>Y86-64 programmer-visible state</strong></p>
<blockquote>
<p>The programmer can <strong>access and modify</strong> these processor state.<br>Similar to x86-64, but <strong>more simpler and less compact</strong>.<br><!-- more --></p>
</blockquote>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/51.png" srcset="/img/loading.gif" lazyload width="60%" height="60%">
<br>
    <div style="color:orange; 
    border-bottom: 15px solid rgba(0,0,0,0);
    display: inline-block;
    color: #999;
    padding: 0px;">Y86-64 programmer-visible state(CS: APP)</div>
</center>

<blockquote>
<p>Comparing with the <strong>register</strong> part of x86-64:</p>
</blockquote>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/52.png" srcset="/img/loading.gif" lazyload width="40%" height="40%">
<br>
    <div style="color:orange; 
    border-bottom: 15px solid rgba(0,0,0,0);
    display: inline-block;
    color: #999;
    padding: 0px;">x86-64 Integer registers(CS: APP)</div>
</center>

<hr>
<p><strong>Y86-64 Program Registers</strong></p>
<ul>
<li><strong>15</strong> Program Resister;</li>
<li>No <code>%r15</code>, to simplify the encoding;</li>
<li><strong>64-bit</strong> word, <strong>8 words</strong>;</li>
<li><code>%rsp</code> for Stack Pointer, NO fixed meaning or value for others.</li>
</ul>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/53.png" srcset="/img/loading.gif" lazyload width="60%" height="60%">
<br>
    <div style="color:orange; 
    border-bottom: 15px solid rgba(0,0,0,0);
    display: inline-block;
    color: #999;
    padding: 0px;">Y86-64 Program Registers(CS: APP)</div>
</center>

<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/86.png" srcset="/img/loading.gif" lazyload width="60%" height="60%">
<br>
    <div style="color:orange; 
    border-bottom: 15px solid rgba(0,0,0,0);
    display: inline-block;
    color: #999;
    padding: 0px;">Y86-64 program register identifiers(CS: APP)</div>
</center>

<hr>
<p><strong>Condition Codes</strong></p>
<ul>
<li><strong>CC</strong>: Condition Code;</li>
<li>3 <strong>single-bit</strong> codes;</li>
<li><strong>ZF</strong>, <strong>SF</strong>, <strong>OF</strong>;</li>
<li><strong>ZF</strong>: Zero Flag. The most recent operation yielded <strong>zero</strong>.</li>
<li><strong>SF</strong>: Sign Flag. The most recent operation yielded a <strong>negative value</strong>.</li>
<li><strong>OF</strong>: Overflow Flag. The most recent operation caused a <strong>two’s-complement overflow</strong>—either negative or positive.</li>
</ul>
<hr>
<p><strong>Program Counter</strong></p>
<ul>
<li><strong>PC</strong>: Program Counter;</li>
<li>Store the address of currently executing instruction.</li>
</ul>
<hr>
<p><strong>Memory</strong></p>
<ul>
<li>Virtual memory;</li>
<li>In the Operand forms, only represented in <strong>base</strong> and <strong>displacement</strong>, NO index and scale in x86-64.</li>
</ul>
<hr>
<p><strong>Program State</strong></p>
<ul>
<li><strong>Stat</strong>: Program State;</li>
<li>The overall state of program execution;</li>
<li><strong>Normal operation</strong> or <strong>exception</strong>.</li>
</ul>
<hr>
<p><strong>Y86-64 Instructions</strong></p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/50.png" srcset="/img/loading.gif" lazyload width="70%" height="70%">
<br>
    <div style="color:orange; 
    border-bottom: 15px solid rgba(0,0,0,0);
    display: inline-block;
    color: #999;
    padding: 0px;">Y86-64 Instructions Set(CS: APP)</div>
</center>

<ul>
<li>A <strong>subset</strong> of x86-64 instruction set;</li>
<li><strong>8-byte</strong> integer operations;</li>
<li><strong>fewer</strong> address modes;</li>
<li><strong>smaller</strong> set of operations;</li>
<li>Each instruction set including:<ul>
<li>1-byte <strong><em>instruction specifier</em></strong> (e.g., <code>0|0</code> for <code>halt</code>), including(<code>op|fn</code>):<ul>
<li>4-bit <strong>operation code(<code>op</code>)</strong> and, </li>
<li>4-bit <strong>function code(<code>fn</code>)</strong> to specify a particular function ;</li>
</ul>
</li>
<li>(possibly) 1-byte <strong><em>register specifier</em></strong> (e.g., <code>rA|rB</code>, <code>F|rB</code>);</li>
<li>(possibly) 8-byte <strong><em>constant word</em></strong> (e.g., <code>V</code>, <code>D</code>, <code>Dest</code>);</li>
</ul>
</li>
<li>4 types of instruction: <strong>1-byte, 2-byte, 9-byte, and 10-byte instruction</strong>;<ul>
<li>1-byte: <code>halt</code>, <code>nop</code>, <code>ret</code> (only <strong><em>instruction specifier</em></strong>);</li>
<li>2-byte: <code>rrmovq rA, rB</code>, <code>OPq rA, rB</code>, <code>cmovXX rA, rB</code>, <code>pushq rA</code>, <code>popq rA</code> (only <strong><em>instruction specifier</em></strong> + <strong><em>register specifier</em></strong>);</li>
<li>9-byte: <code>jXX Dest</code>, <code>call Dest</code> (only <strong><em>instruction specifier</em></strong> + <strong><em>constant word</em></strong>);</li>
<li>10-byte: <code>irmovq V, D(rB)</code>, <code>rmmovq rA, D(rB)</code>, <code>mrmovq D(rB), rA</code> (<strong><em>instruction specifier</em></strong> + <strong><em>register specifier</em></strong> + <strong><em>constant word</em></strong>);</li>
</ul>
</li>
<li>Encoded in <strong>hexadecimal</strong> value.</li>
</ul>
<hr>
<p><strong><code>movq</code> Instructions</strong>:</p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/55.png" srcset="/img/loading.gif" lazyload width="70%" height="70%">
<br>
    <div style="color:orange; 
    border-bottom: 15px solid rgba(0,0,0,0);
    display: inline-block;
    color: #999;
    padding: 0px;">Y86-64 movq instructions(CS: APP)</div>
</center>

<ul>
<li>subset of x86-64 movq instruction set;</li>
<li>Indicating the movement: <strong>source</strong> $\to$ <strong>destination</strong>;<ul>
<li><strong>Source</strong>: <em>first character</em> - immediate(<code>i</code>), register(<code>r</code>), memory(<code>m</code>);</li>
<li><strong>Destination</strong>: <em>second character</em> - register(<code>r</code>), memory(<code>m</code>);</li>
</ul>
</li>
<li>NO <strong>memory(<code>m</code>)</strong> location $\rightarrow$ another <strong>memory(<code>m</code>)</strong> location;</li>
<li>NO <strong>immediate(<code>i</code>)</strong> data $\rightarrow$ <strong>memory(<code>m</code>)</strong>;</li>
</ul>
<blockquote>
<p>The movement is from the <strong>first argument</strong> to the <strong>second argument</strong>, usually <code>rA(V)</code> $\to$ <code>rB</code>,<br>except <code>mrmovq D(rB), rA</code>, which is <code>rB</code> $\to$ <code>rA</code></p>
</blockquote>
<ul>
<li><p>The <strong>immediate value(<code>V</code>)</strong> and <strong>displacement(<code>D</code>)</strong> is <strong>8-byte</strong> constant word.</p>
</li>
<li><p>memory reference: only <strong>base</strong> and <strong>displacement</strong>(e.g., <code>D(rB)</code>, <code>rB</code> for <strong>base</strong>, <code>D</code> for <strong>displacement</strong>), NO second index register or scale;</p>
</li>
</ul>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/56.png" srcset="/img/loading.gif" lazyload width="70%" height="70%">
<br>
    <div style="color:orange; 
    border-bottom: 15px solid rgba(0,0,0,0);
    display: inline-block;
    color: #999;
    padding: 0px;">x86-64 Operand forms(CS: APP) (Y86-64's in red box)</div>
</center>

<hr>
<p><strong><code>OPq</code> Integer Operation Instructions</strong>:</p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/58.png" srcset="/img/loading.gif" lazyload width="40%" height="40%">
<br>
    <div style="color:orange; 
    border-bottom: 15px solid rgba(0,0,0,0);
    display: inline-block;
    color: #999;
    padding: 0px;">Y86-64 OPq instructions(CS: APP)</div>
</center>

<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/57.png" srcset="/img/loading.gif" lazyload width="60%" height="60%">
<br>
    <div style="color:orange; 
    border-bottom: 15px solid rgba(0,0,0,0);
    display: inline-block;
    color: #999;
    padding: 0px;">x86-64 Integer arithmetic operations(CS: APP) (Y86-64's in red box)</div>
</center>

<ul>
<li>subset of x86-64 Integer arithmetic operations;</li>
<li>2-byte instruction;</li>
<li>4 instructions: <code>addq</code>, <code>subq</code>, <code>andq</code>, <code>xorq</code>;</li>
<li><strong>Only operate on register data</strong>, NOT on memory data;</li>
<li>Sets 3 conditional code <code>ZF</code>, <code>SF</code>, and <code>OF</code>.</li>
<li>Function code for <code>fn</code>:</li>
</ul>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/59.png" srcset="/img/loading.gif" lazyload width="60%" height="60%">
<br>
    <div style="color:orange; 
    border-bottom: 15px solid rgba(0,0,0,0);
    display: inline-block;
    color: #999;
    padding: 0px;">Function codes for Y86-64 instruction set(CS: APP)(Operation part)</div>
</center>

<hr>
<h2 id="4-2-Logic-Design"><a href="#4-2-Logic-Design" class="headerlink" title="4.2 Logic Design"></a>4.2 Logic Design</h2><h3 id="4-2-1-Logic-Gates"><a href="#4-2-1-Logic-Gates" class="headerlink" title="4.2.1 Logic Gates"></a>4.2.1 Logic Gates</h3><center><img src="/2022/04/30/introduction-to-computer-systems-course-note/60.png" srcset="/img/loading.gif" lazyload width="80%" height="80%"></center>

<ul>
<li>With some delay</li>
</ul>
<hr>
<h3 id="4-2-2-Bit-Equality"><a href="#4-2-2-Bit-Equality" class="headerlink" title="4.2.2 Bit Equality"></a>4.2.2 Bit Equality</h3><center><img src="/2022/04/30/introduction-to-computer-systems-course-note/61.png" srcset="/img/loading.gif" lazyload width="80%" height="80%"></center>


<ul>
<li><code>bool eq = (a&amp;&amp;b)||(!a&amp;&amp;!b)</code></li>
<li>Generate 1 if a and b are equal;</li>
</ul>
<p><strong>Word Equality (64-bit)</strong>:</p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/62.png" srcset="/img/loading.gif" lazyload width="80%" height="80%"></center>

<hr>
<h3 id="4-2-3-Word-Multiplexor"><a href="#4-2-3-Word-Multiplexor" class="headerlink" title="4.2.3 Word Multiplexor"></a>4.2.3 Word Multiplexor</h3><center><img src="/2022/04/30/introduction-to-computer-systems-course-note/63.png" srcset="/img/loading.gif" lazyload width="80%" height="80%"></center>

<ul>
<li>Select input word <code>A</code> or <code>B</code> depending on control signal <code>s</code>;</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs hcl">int Out = [<br>  s : A;<br>  1 : B;<br>]<br></code></pre></td></tr></table></figure>
<hr>
<h3 id="4-2-4-Arithmetic-Logic-Unit"><a href="#4-2-4-Arithmetic-Logic-Unit" class="headerlink" title="4.2.4 Arithmetic Logic Unit"></a>4.2.4 Arithmetic Logic Unit</h3><center><img src="/2022/04/30/introduction-to-computer-systems-course-note/64.png" srcset="/img/loading.gif" lazyload width="80%" height="80%"></center>

<hr>
<h2 id="4-3-SEQ-Stages"><a href="#4-3-SEQ-Stages" class="headerlink" title="4.3 SEQ Stages"></a>4.3 SEQ Stages</h2><p>3 Important Components: <strong>Combinational Logic</strong>, <strong>Storage Elements</strong> and  <strong>Clock</strong>. </p>
<p>6 stages: Fetch, Decode, Execute, Memory, Write Back, and PC Update.</p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/65.png" srcset="/img/loading.gif" lazyload width="70%" height="70%">
<br>
    <div style="color:orange; 
    border-bottom: 15px solid rgba(0,0,0,0);
    display: inline-block;
    color: #999;
    padding: 0px;">Abstract view of SEQ - a sequential implementation(CS: APP)</div>
</center>

<h3 id="4-3-1-Fetch"><a href="#4-3-1-Fetch" class="headerlink" title="4.3.1 Fetch"></a>4.3.1 Fetch</h3><ul>
<li>According to the <strong>PC</strong> as the <strong>RAM address</strong>, read <strong>instruction byte</strong> from memory;</li>
<li>Read <strong>first two 4-bit(1 Byte) instruction specifier byte</strong>, including the <code>icode</code> and <code>ifun</code>;</li>
<li>Read the <strong>register specifier byte</strong> - <code>rA</code> and <code>rB</code>;</li>
<li>Read 8-byte constant word - <code>valC</code>;</li>
<li>Compute the next instruction address following the current one, <code>valP = PC + len(fetched instruction)</code></li>
</ul>
<hr>
<h3 id="4-3-2-Decode"><a href="#4-3-2-Decode" class="headerlink" title="4.3.2 Decode"></a>4.3.2 Decode</h3><p>Read register value from Register File.</p>
<ul>
<li>Read from <code>rA</code>, <code>rB</code>;</li>
<li>Assign value to <code>valA</code> and <code>valB</code>;</li>
<li>OR read from <strong>stack pointer</strong> <code>%rsp</code>(e.g., <code>pushq</code>, <code>popq</code>, <code>call</code>, <code>ret</code>).</li>
</ul>
<hr>
<h3 id="4-3-3-Execute"><a href="#4-3-3-Execute" class="headerlink" title="4.3.3 Execute"></a>4.3.3 Execute</h3><ul>
<li>The ALU(Arithmetic/Logic Unit):<ul>
<li>Do the <strong>operation</strong> based on the <code>ifun</code>, or</li>
<li>Compute the <strong>effective memory address</strong>(e.g., base address <code>ADD</code> displacement), or</li>
<li>Increase or decrease the <strong>stack pointer</strong>.</li>
</ul>
</li>
<li>Assign the result value to <code>valE</code>;</li>
<li>Set the <code>CC</code> (Condition Code);</li>
</ul>
<blockquote>
<p>For <code>cmovXX</code>(conditional move) and <code>jXX</code>(jump) instruction:<br>This stage will evaluate the <code>CC</code> with <code>ifun</code>(<strong>move condition OR jump condition</strong>);<br>if condition holds, do the move or jump.</p>
</blockquote>
<hr>
<h3 id="4-3-4-Memory"><a href="#4-3-4-Memory" class="headerlink" title="4.3.4 Memory"></a>4.3.4 Memory</h3><ul>
<li>8-byte;</li>
<li>Write data into memory, usually write into $M_8[valE]$;</li>
<li>Read data from memory, store in <code>valM</code>.</li>
</ul>
<hr>
<h3 id="4-3-5-Write-Back"><a href="#4-3-5-Write-Back" class="headerlink" title="4.3.5 Write Back"></a>4.3.5 Write Back</h3><ul>
<li>Write the data back to <strong>register</strong> from the <strong>Decode Stage</strong> (e.g., <code>rA</code>, <code>rB</code>, <code>%rsp</code>)</li>
</ul>
<hr>
<h3 id="4-3-6-PC-Update"><a href="#4-3-6-PC-Update" class="headerlink" title="4.3.6 PC Update"></a>4.3.6 PC Update</h3><ul>
<li>Set <code>PC</code> (Program Counter) to the address of <code>next instruction</code>;</li>
<li>In Fetch Stage, <code>valP = PC + len(fetched instruction)</code> does not update the value of <code>PC</code>, but in this Stage, assign valP to <code>PC</code> to truly update <code>PC</code>, <code>PC = valP</code>;</li>
<li>Based on execute result, set <code>PC</code> to <code>valC</code> or <code>valP</code>(e.g., in <code>jXX</code> or <code>cmovXX</code>).</li>
</ul>
<hr>
<p><strong>Executing Arith. / Logical Instruction:</strong></p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/66.png" srcset="/img/loading.gif" lazyload width="80%" height="80%"></center>

<hr>
<p><strong>Executing Move Instruction: rmmovq:</strong></p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/67.png" srcset="/img/loading.gif" lazyload width="80%" height="80%"></center>

<hr>
<p><strong>Executing Jumps:</strong></p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/68.png" srcset="/img/loading.gif" lazyload width="80%" height="80%"></center>


<hr>
<h2 id="4-4-Pipelining"><a href="#4-4-Pipelining" class="headerlink" title="4.4 Pipelining"></a>4.4 Pipelining</h2><p>Unpipelined:</p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/69.png" srcset="/img/loading.gif" lazyload width="70%" height="70%"></center>

<p>Pipelined:</p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/70.png" srcset="/img/loading.gif" lazyload width="80%" height="80%"></center>

<ul>
<li>Divide combinational logic into parts;</li>
<li>Begin new instruction as soon as previous one completes one stage;</li>
<li>Overall latency increases. </li>
</ul>
<hr>
<p><strong>Limitation of the Pipelining</strong>:</p>
<ul>
<li>Nonuniform Partitioning:</li>
</ul>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/71.png" srcset="/img/loading.gif" lazyload width="80%" height="80%"></center>

<p>The clock operation rate is limited by the delay of the <strong>slowest (longest)</strong> stage;<br>May cause the waste of the CPU resource.</p>
<ul>
<li>Diminishing Returns of Deep Pipelining:</li>
</ul>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/77.png" srcset="/img/loading.gif" lazyload width="80%" height="80%"></center>

<p>Cut the time required by each computation block by two, but we do <strong>not get a doubling of the throughput</strong>, bue to the delay of the pipeline registers.</p>
<hr>
<h3 id="4-4-1-Pipeline-Stages"><a href="#4-4-1-Pipeline-Stages" class="headerlink" title="4.4.1 Pipeline Stages"></a>4.4.1 Pipeline Stages</h3><p>Shift the <code>PC</code> computation from the end of the clock to the beginning, to get the value of the <strong><em>current</em></strong> <code>PC</code> of the instruction. </p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/72.png" srcset="/img/loading.gif" lazyload width="80%" height="80%"></center>

<p>Pipeline Register:</p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/73.png" srcset="/img/loading.gif" lazyload width="80%" height="80%"></center>


<hr>
<h3 id="4-4-2-PC-Prediction"><a href="#4-4-2-PC-Prediction" class="headerlink" title="4.4.2 PC Prediction"></a>4.4.2 PC Prediction</h3><ul>
<li>Start fetching new instruction after current one has completed fetch stage</li>
<li>Guess the next PC:<ul>
<li>Unconditional Jump: <code>valC</code>(the destination);</li>
<li>Non-jump instruction: <code>valP</code>(the next instruction);</li>
<li>Conditional Jump: <code>valC</code>(predict the branch will <strong>always taken</strong>). </li>
</ul>
</li>
</ul>
<hr>
<h3 id="4-4-3-Data-Hazard-in-Pipeline"><a href="#4-4-3-Data-Hazard-in-Pipeline" class="headerlink" title="4.4.3 Data Hazard in Pipeline"></a>4.4.3 Data Hazard in Pipeline</h3><p>Data Dependencies: Some instruction depends on result from <strong>previous</strong> ones. </p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/74.png" srcset="/img/loading.gif" lazyload width="80%" height="80%"></center>

<blockquote>
<p>Values in <code>%rdx</code> and <code>%rax</code> have not been updated yet! </p>
</blockquote>
<hr>
<p>Solution: <strong>Stalling</strong></p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/75.png" srcset="/img/loading.gif" lazyload width="80%" height="80%"></center>


<hr>
<h3 id="4-4-4-Branch-Misprediction"><a href="#4-4-4-Branch-Misprediction" class="headerlink" title="4.4.4 Branch Misprediction"></a>4.4.4 Branch Misprediction</h3><center><img src="/2022/04/30/introduction-to-computer-systems-course-note/76.png" srcset="/img/loading.gif" lazyload width="80%" height="80%"></center>


<ul>
<li>Predict the branch is taken (Target);<ul>
<li>Fetch 2 instructions at target.</li>
</ul>
</li>
<li>Once reach the execute stage and find the branch is <strong>NOT</strong> taken:<ul>
<li>Cancel the <strong>misfetced</strong> instructions by <strong>inserting bubbles</strong>;</li>
<li>No side effect but waste of some clock cycles. </li>
</ul>
</li>
</ul>
<hr>
<h1 id="5-Memory-Hierarchy"><a href="#5-Memory-Hierarchy" class="headerlink" title="5 Memory Hierarchy"></a>5 Memory Hierarchy</h1><h2 id="5-1-Access-Latency"><a href="#5-1-Access-Latency" class="headerlink" title="5.1 Access Latency"></a>5.1 Access Latency</h2><ul>
<li>CPU one instruction execution time: <strong>1 cycle</strong> (1GHz CPU, 1 cycle = 10-9s);</li>
<li>Fetch one word from main memory: <strong>10 ~ 100 cycles</strong>;</li>
<li>Fetch a block of data from dicks: <strong>10,000 ~ 1,000,000 cycles</strong>. </li>
</ul>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/78.png" srcset="/img/loading.gif" lazyload width="80%" height="80%"></center>

<hr>
<h2 id="5-2-Locality"><a href="#5-2-Locality" class="headerlink" title="5.2 Locality"></a>5.2 Locality</h2><p><strong>Principle</strong> of locality: </p>
<ul>
<li>Programs tend to use data and instructions with addresses <strong>near or equal</strong> to those they <strong>have used recently</strong>;</li>
</ul>
<p><strong>Temporal</strong> locality (Time respective):</p>
<ul>
<li><strong>Recently</strong> referenced items (data, instructions) are likely to be referenced again in the near future;</li>
</ul>
<p><strong>Spatial</strong> locality (Space respective):</p>
<ul>
<li>items (data, instructions) with <strong>nearby</strong> addresses tend to be referenced close together in time</li>
</ul>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/79.png" srcset="/img/loading.gif" lazyload width="80%" height="80%"></center>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/80.png" srcset="/img/loading.gif" lazyload width="80%" height="80%"></center>

<p><strong>Locality measurement:</strong></p>
<blockquote>
<p><strong>Stride</strong>(Space): The <strong>distance</strong> of two <strong>adjacent data accesses</strong> in memory location, in the unit of 1 data element;</p>
</blockquote>
<ul>
<li><p><strong>Stride-1</strong> reference pattern: access the data one by one according to their memory addresses, such as the <strong>good locality</strong> example;</p>
</li>
<li><p><strong>Stride-k</strong> reference pattern: for example, the <strong>bad locality</strong> example generally has a stride-4 reference pattern.</p>
</li>
</ul>
<p>The <strong>smaller</strong> the stride, the <strong>better</strong> the locality. </p>
<hr>
<h2 id="5-3-Caching"><a href="#5-3-Caching" class="headerlink" title="5.3 Caching"></a>5.3 Caching</h2><blockquote>
<p>Adding a small but fast <strong>memory</strong> inside the <strong>CPU</strong></p>
</blockquote>
<p>Most programs runs iteration, and access same data frequently, so use cache to store the recently used data, saving time when access the same block of data, rather then still access from main memory. And cache is much closer to CPU than memory, have faster speed.</p>
<p><strong>Hit</strong>: the needed data have already been fetched inside the cache before;</p>
<p><strong>Miss</strong>: the needed data is NOT in the cache now, need to be accessed from the main memory;</p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/81.png" srcset="/img/loading.gif" lazyload width="80%" height="80%"></center>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/82.png" srcset="/img/loading.gif" lazyload width="80%" height="80%"></center>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/83.png" srcset="/img/loading.gif" lazyload width="80%" height="80%"></center>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/84.png" srcset="/img/loading.gif" lazyload width="80%" height="80%"></center>

<hr>
<p><strong>Hints to software developers</strong>:</p>
<ul>
<li>Caching leverages locality, good locality make good use of cache;</li>
<li>Focus your attention on <strong>inner</strong> loops;</li>
<li><strong>Spatial</strong> locality: reducing by reading data <strong>sequentially</strong> with stride-1 with <strong>same order stored in the memory</strong>;</li>
<li><strong>Temporal</strong> locality: reducing by using data as <strong>often</strong> as possible once it has been read from memory recently.</li>
</ul>
<hr>
<h2 id="5-4-Memory-Hierarchy-amp-Caching"><a href="#5-4-Memory-Hierarchy-amp-Caching" class="headerlink" title="5.4 Memory Hierarchy &amp; Caching"></a>5.4 Memory Hierarchy &amp; Caching</h2><center><img src="/2022/04/30/introduction-to-computer-systems-course-note/85.png" srcset="/img/loading.gif" lazyload width="70%" height="70%"></center>

<ul>
<li>Level <code>K</code> can be the cache of the Level <code>K+1</code>, storing the subset data of higher one.</li>
<li><strong>Memory system</strong> working at a <strong>high speed</strong> at the <strong>highest level</strong> with <strong>less capacity</strong>, but have the <strong>storage space</strong> of the <strong>lowest level</strong> with low speed but <strong>large capacity</strong>.</li>
</ul>
<hr>
<h2 id="5-5-Cache-Management"><a href="#5-5-Cache-Management" class="headerlink" title="5.5 Cache Management"></a>5.5 Cache Management</h2><ul>
<li>Cache block size:<ul>
<li>Bigger size has bigger spatial locality;</li>
<li>But too big may cause many data unused and cause waste of space and time;</li>
</ul>
</li>
<li><p>Replacement policy:</p>
<ul>
<li>The <strong>new coming data</strong> is going to replace which data in the cache;</li>
<li>Intuition: keep the data with <strong>more usage frequency</strong> in the cache, replace the less used one.</li>
<li><strong>FIFO</strong>: if the cache is full, and a new cache block will be loaded into the cache, the cache block that are installed earliest in absolute time will be evicted；</li>
<li><strong>LRU</strong>: if the cache is full, and a new cache block will be loaded into the cache, the least recently accesses block will be evicted。</li>
</ul>
</li>
<li><p>Set-associative design of cache:</p>
<ul>
<li>When the cache is large, take too long time to find;</li>
<li>Partition the cache into <strong>groups</strong>, <strong>map</strong> different data into different groups. </li>
</ul>
</li>
</ul>
<hr>
<h1 id="6-Concurrency"><a href="#6-Concurrency" class="headerlink" title="6 Concurrency"></a>6 Concurrency</h1><p>Concept of <strong>concurrency</strong>:</p>
<blockquote>
<p>There are more than one programs, before one running program finishes, another program has stared execution;<br>The operating system offers the capability to shift between programs. </p>
</blockquote>
<p><strong>Processes</strong>:</p>
<blockquote>
<p>An <strong>instance</strong> of a running <strong>program</strong>;<br>can create multiple processes of a “program”.</p>
</blockquote>
<p>Process <strong>abstractions</strong>:</p>
<blockquote>
<ol>
<li>Logical control flow:<br>Exclusive use of the <strong>CPU</strong>, e.g. <strong>Registers</strong>;<br>Provided by kernel mechanism called <strong><em>context switching</em></strong>.</li>
<li>Private address space:<br>Exclusive use of main <strong>memory</strong>;<br>Provided by kernel mechanism called <strong><em>virtual memory</em></strong>. </li>
</ol>
</blockquote>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/87.png" srcset="/img/loading.gif" lazyload width="10%" height="10%"></center>

<p><strong>Workflow of switching</strong>:</p>
<blockquote>
<ol>
<li>Start P1;</li>
<li>Save the context of P1 (Register) to P1’s memory region;</li>
<li>Load the context of P2;</li>
<li>Start execute P2;<br>…</li>
</ol>
</blockquote>
<p><strong>Context Switching</strong>:</p>
<ul>
<li><strong>kernel</strong>:</li>
</ul>
<blockquote>
<p>A shared chunk of memory-resident OS code manages Processes.</p>
</blockquote>
<p>Control flow passes from one process to another via a <strong>context switch</strong>:</p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/88.png" srcset="/img/loading.gif" lazyload width="70%" height="70%"></center>

<hr>
<h2 id="6-1-Write-Concurrent-Program"><a href="#6-1-Write-Concurrent-Program" class="headerlink" title="6.1 Write Concurrent Program"></a>6.1 Write Concurrent Program</h2><p>Process in three <strong>states</strong>:</p>
<ul>
<li>Running: Process is either <strong>executing</strong>, or <strong>waiting to be executed</strong>;</li>
<li>Stopped: Process execution is <strong>suspended</strong> and will not be scheduled until further notice;</li>
<li>Terminated: Process is <strong>stopped permanently</strong>.</li>
</ul>
<hr>
<p><strong>Creating Processes</strong>:</p>
<p><code>fork()</code>: </p>
<ul>
<li>Parent process <strong>creates</strong> a new running child process;</li>
<li><strong>Returns</strong> 0 choose to run the child process, child’s PID to parent process;<ul>
<li><strong>After return, the process will run the code after the <code>fork()</code> line</strong>;</li>
<li>Child get an <strong>identical</strong> (but separate) copy of the parent’s child;</li>
<li>Child has a different PID than the parent.</li>
</ul>
</li>
<li>Called once but returns twice.</li>
</ul>
<hr>
<p><strong>Terminating Processes</strong>:</p>
<p>Process becomes terminated for one of three reasons:</p>
<ul>
<li>Receiving a signal whose default action is to terminate</li>
<li>Returning from the <code>main</code> routine</li>
<li>Calling the <code>exit</code> function </li>
</ul>
<p><code>exit(int status)</code>:</p>
<ul>
<li>Terminates with an exit status of status;</li>
<li>Convention: normal return status is 0, nonzero on error;</li>
<li>called  once but never returns.</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;     <br>  <span class="hljs-type">pid_t</span> pid;     <br>  <span class="hljs-type">int</span> x = <span class="hljs-number">1</span>;<br><br>  pid = Fork(); <br>  <span class="hljs-comment">/* Execute code after the Fork() line after return */</span><br>  <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>) &#123;  <span class="hljs-comment">/* Child */</span>         <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;child : x=%d\n&quot;</span>, ++x);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  &#125;<br>  <span class="hljs-comment">/* Parent */</span>     <br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;parent: x=%d\n&quot;</span>, --x);<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>); <br>&#125;<br></code></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">parent:  x=<span class="hljs-number">0</span> <br>child : x=<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>
<ul>
<li>Can’t predict execution order of parent and child.</li>
</ul>
<hr>
<p><strong>Synchronizing parent with child</strong>:</p>
<p><code>int  wait(int  *child_status)</code>:</p>
<ul>
<li><strong>Suspend</strong> current process until one of its children <strong>terminates</strong>;</li>
<li>Return value is the <code>pid</code> of the <strong>child process that terminates</strong>;</li>
<li><code>child_status</code>: If <code>child_status != NULL</code>, the integer it points to will be set to a value that indicates the reason why the child terminates;</li>
</ul>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/89.png" srcset="/img/loading.gif" lazyload width="70%" height="70%"></center>

<hr>
<h1 id="7-Virtual-Memory"><a href="#7-Virtual-Memory" class="headerlink" title="7 Virtual Memory"></a>7 Virtual Memory</h1><center><img src="/2022/04/30/introduction-to-computer-systems-course-note/90.png" srcset="/img/loading.gif" lazyload width="70%" height="70%" alt="physical addressing"></center>

<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/91.png" srcset="/img/loading.gif" lazyload width="70%" height="70%" alt="virtual addressing"></center>

<hr>
<h2 id="7-1-Address-Spaces"><a href="#7-1-Address-Spaces" class="headerlink" title="7.1 Address Spaces"></a>7.1 Address Spaces</h2><p><strong>Linear address space</strong>: <strong>consecutive non-negative</strong> integer addresses:</p>
<script type="math/tex; mode=display">\{0,1,2,3,...\}</script><p><strong>Virtual address space</strong>: use $n$-bit integers as virtual addresses, total $N = 2^n$ virtual addresses:</p>
<script type="math/tex; mode=display">\{0,1,2,3,...,N-1\}</script><p><strong>Physical address space</strong>: use $m$-bit integers as physical addresses, total $M = 2^m$ physical addresses:</p>
<script type="math/tex; mode=display">\{0,1,2,3,...,M-1\}</script><p>In general, $N$ is larger than $M$</p>
<hr>
<h2 id="7-2-Tool-for-Caching"><a href="#7-2-Tool-for-Caching" class="headerlink" title="7.2 Tool for Caching"></a>7.2 Tool for Caching</h2><blockquote>
<p>Virtual Memory is an array of $N$ consecutive bytes stored on <strong>disk</strong>.</p>
</blockquote>
<p><code>SRAM</code> cache: the L1, L2, and L3 cache memories between the <strong>CPU</strong> and main memory;<br><code>DRAM</code> cache: the VM system’s cache that caches virtual pages in <strong>physical memory</strong>.<br><code>pages</code>: cache block;</p>
<h3 id="Three-stages-of-a-Virtual-page"><a href="#Three-stages-of-a-Virtual-page" class="headerlink" title="Three stages of a Virtual page:"></a>Three stages of a Virtual page:</h3><ul>
<li><strong>Unallocated</strong>: Pages that have <strong>not yet been allocated (or created) by the VM</strong> system. Unallocated blocks do not have any data associated with them, and thus do not occupy any space on disk;</li>
<li><strong>Cached</strong>: Allocated pages that are currently <strong>cached in physical memory</strong>;</li>
<li><strong>Uncached</strong>: Allocated pages that are <strong>not cached in physical memory</strong>.</li>
</ul>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/92.png" srcset="/img/loading.gif" lazyload width="70%" height="70%" alt="using main memory as a cache"></center>

<hr>
<h3 id="DRAM-Cache-Organization"><a href="#DRAM-Cache-Organization" class="headerlink" title="DRAM Cache Organization"></a>DRAM Cache Organization</h3><p><strong>Large</strong> page (block) size: typically 4 KB to 4 MB.</p>
<ul>
<li>To get more hit.</li>
</ul>
<p>Fully associative:</p>
<ul>
<li>Any virtual page (VP) can be placed in any physical page (PP);</li>
<li>Size of VP = size of PP.</li>
</ul>
<p>Sophisticated replacement algorithms for DRAM cache.</p>
<p>Write-back</p>
<ul>
<li>Writes are not immediately performed in the disk;</li>
<li>Write to the disk when a page is evicted from DRAM cache.</li>
</ul>
<hr>
<h3 id="Page-Table"><a href="#Page-Table" class="headerlink" title="Page Table"></a>Page Table</h3><p>An Enabling Data Structure.</p>
<blockquote>
<p>An array of page table entries (PTEs) that <strong>maps virtual pages to physical pages</strong>.</p>
</blockquote>
<ul>
<li>Store in the  main memory, each process has a page table stored in the mei memory.</li>
</ul>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/93.png" srcset="/img/loading.gif" lazyload width="70%" height="70%" alt="Page table"></center>

<p><strong>valid bit</strong>: indicates whether the virtual page is currently <strong>cached in DRAM</strong>.<br><strong>address field</strong>: </p>
<ul>
<li>if valid bit is <strong>1</strong>, is the start of the corresponding <strong>physical page</strong> in DRAM where the virtual page is c<strong>ached</strong>;</li>
<li>if valid bit is <strong>0</strong>: <ul>
<li><code>null</code> address indicates that the virtual page has <strong>not yet been allocated</strong>;</li>
<li>or the address points to the start of the virtual page <strong>on disk</strong>.</li>
</ul>
</li>
</ul>
<hr>
<h3 id="Page-Hit"><a href="#Page-Hit" class="headerlink" title="Page Hit"></a>Page Hit</h3><blockquote>
<p>reference to VM word that is in physical memory</p>
</blockquote>
<p>Third data is hit, just read from the PM.</p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/94.png" srcset="/img/loading.gif" lazyload width="70%" height="70%" alt="Page Hit"></center>

<hr>
<h3 id="Page-Fault"><a href="#Page-Fault" class="headerlink" title="Page Fault"></a>Page Fault</h3><blockquote>
<p>reference to VM word that is not in physical memory</p>
</blockquote>
<p>Fourth data is missed (fault):</p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/95.png" srcset="/img/loading.gif" lazyload width="70%" height="70%" alt="Page Fault"></center>

<ol>
<li>Page miss causes page fault (an exception);</li>
<li><strong>Page fault handler</strong> selects a <strong>victim</strong> to be evicted (here <code>VP4</code>);</li>
<li>Read VP3 from Virtual Memory to PM and cache it in DRAM;</li>
<li>Restart, hit!</li>
</ol>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/96.png" srcset="/img/loading.gif" lazyload width="70%" height="70%" alt="After Page Fault"></center>

<hr>
<h3 id="Allocating-Pages"><a href="#Allocating-Pages" class="headerlink" title="Allocating Pages"></a>Allocating Pages</h3><blockquote>
<p>Allocating a new page (VP 5) of virtual memory.</p>
</blockquote>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/97.png" srcset="/img/loading.gif" lazyload width="70%" height="70%" alt="Allocating Pages"></center>

<hr>
<h3 id="Locality"><a href="#Locality" class="headerlink" title="Locality"></a>Locality</h3><ul>
<li>Virtual memory works <strong>efficiently</strong> because of <strong>locality</strong>;</li>
<li>working set: At any point in time, programs tend to access a set of active virtual pages;</li>
<li>If (working set size &lt; main memory size):<ul>
<li><strong>Good</strong> performance for one process after compulsory misses;</li>
</ul>
</li>
<li>If ( SUM(working set sizes) &gt; main memory size):<ul>
<li>Thrashing: Performance meltdown where pages are swapped (copied) in and out continuously.</li>
</ul>
</li>
</ul>
<hr>
<h2 id="7-3-Too-for-Memory-Management"><a href="#7-3-Too-for-Memory-Management" class="headerlink" title="7.3 Too for Memory Management"></a>7.3 Too for Memory Management</h2><blockquote>
<p>Each process has its <strong>own</strong> virtual address space.</p>
</blockquote>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/98.png" srcset="/img/loading.gif" lazyload width="70%" height="70%" alt="Memory Management"></center>

<p><strong>Simplifying memory allocation</strong>:</p>
<ul>
<li>Each virtual page can be mapped to any physical page;</li>
<li>A virtual page can be stored in <strong>different</strong> physical pages at <strong>different</strong> times.</li>
</ul>
<p><strong>Sharing code and data among processes</strong>:</p>
<ul>
<li>Map virtual pages to the same physical page (<code>PP 7</code>).</li>
</ul>
<hr>
<h2 id="7-4-Tool-for-Memory-Protection"><a href="#7-4-Tool-for-Memory-Protection" class="headerlink" title="7.4 Tool for Memory Protection"></a>7.4 Tool for Memory Protection</h2><blockquote>
<p>Extend page table entries (PTEs) with permission bits.</p>
</blockquote>
<ul>
<li>Memory management unit (MMU) checks these bits on each access</li>
</ul>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/99.png" srcset="/img/loading.gif" lazyload width="70%" height="70%" alt="Memory Protection"></center>

<p><code>SUP</code>: <strong>Super user</strong> or <strong>Supervisor</strong>;</p>
<ul>
<li>whether processes must be running in kernel (supervisor) mode to access the page. </li>
<li>1: Processes running in kernel mode can access any page, </li>
<li>0: Processes running in user mode are only allowed to access pages.</li>
</ul>
<p><code>READ</code>: Read;<br><code>WRITE</code>: Write;<br><code>EXEC</code>: Execute.</p>
<hr>
<h2 id="7-5-VM-Address-Translation"><a href="#7-5-VM-Address-Translation" class="headerlink" title="7.5 VM Address Translation"></a>7.5 VM Address Translation</h2><script type="math/tex; mode=display">MAP: V \to P \cup \{\empty\}</script><p>$MAP(a)=a^\prime$: Hit, data at virtual address $a$ is at physical address $a\prime<br>$ in P </p>
<p>$MAP(a)=\empty$: Fault, data at virtual address $a$ is not in physical memory</p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/100.png" srcset="/img/loading.gif" lazyload width="70%" height="70%" alt="Summary of Address Translation Symbols"></center>

<hr>
<h3 id="Address-Translation-With-a-Page-Table"><a href="#Address-Translation-With-a-Page-Table" class="headerlink" title="Address Translation With a Page Table"></a>Address Translation With a Page Table</h3><center><img src="/2022/04/30/introduction-to-computer-systems-course-note/101.png" srcset="/img/loading.gif" lazyload width="70%" height="70%" alt="Address Translation With a Page Table"></center>

<p>The <code>VPN</code> is like a <strong>index</strong> to the Page Table</p>
<hr>
<p>Hit:</p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/102.png" srcset="/img/loading.gif" lazyload width="70%" height="70%" alt="Address Translation With Hit"></center>

<p>1.Processor sends virtual address to MMU<br>2-3. MMU fetches PTE from page table in memory<br>4.MMU sends physical address to cache/memory<br>5.Cache/memory sends data word to processor</p>
<hr>
<p>Fault:</p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/103.png" srcset="/img/loading.gif" lazyload width="70%" height="70%" alt="Address Translation With fault"></center>

<p>1.Processor sends virtual address to MMU<br>2-3. MMU fetches PTE from page table in memory<br>4.Valid bit is zero, so MMU triggers page fault exception<br>5.Handler identifies victim (and, if dirty, pages it out to disk)<br>6.Handler pages in new page and updates PTE in memory<br>7.Handler returns to original process, restarting faulting instruction</p>
<hr>
<h2 id="7-6-Integrating-VM-and-Cache"><a href="#7-6-Integrating-VM-and-Cache" class="headerlink" title="7.6 Integrating VM and Cache"></a>7.6 Integrating VM and Cache</h2><center><img src="/2022/04/30/introduction-to-computer-systems-course-note/104.png" srcset="/img/loading.gif" lazyload width="70%" height="70%" alt="Integrating VM and Cache"></center>

<p>PTE data is same as other data cached in L1 cache, can be hit and miss.</p>
<hr>
<h2 id="7-7-Speeding-up-Translation-with-a-TLB"><a href="#7-7-Speeding-up-Translation-with-a-TLB" class="headerlink" title="7.7 Speeding up Translation with a TLB"></a>7.7 Speeding up Translation with a TLB</h2><p>Dut to the PT data will be easily evicted, and has a small delay, we can use a TLB to speed up.</p>
<p>Translation Lookaside Buffer (TLB):</p>
<ul>
<li>Small set-associative hardware cache in MMU;</li>
<li>Maps virtual page numbers to  physical page numbers</li>
<li>Contains <strong>complete</strong> page table entries for small number of pages</li>
</ul>
<h3 id="Accessing-the-TLB"><a href="#Accessing-the-TLB" class="headerlink" title="Accessing the TLB"></a>Accessing the TLB</h3><center><img src="/2022/04/30/introduction-to-computer-systems-course-note/105.png" srcset="/img/loading.gif" lazyload width="70%" height="70%" alt="Accessing the TLB"></center>

<hr>
<h3 id="TLB-Hit"><a href="#TLB-Hit" class="headerlink" title="TLB Hit"></a>TLB Hit</h3><center><img src="/2022/04/30/introduction-to-computer-systems-course-note/106.png" srcset="/img/loading.gif" lazyload width="70%" height="70%" alt="TLB Hit"></center>

<p>1.The CPU generates a virtual address.<br>2-3.The MMU fetches the appropriate PTE from the TLB;<br>4.The MMU translates the virtual address to a physical address and sends it to the cache/main memory;<br>5.The cache/main memory returns the requested data word to the CPU.</p>
<hr>
<h3 id="TLB-Miss"><a href="#TLB-Miss" class="headerlink" title="TLB Miss"></a>TLB Miss</h3><center><img src="/2022/04/30/introduction-to-computer-systems-course-note/107.png" srcset="/img/loading.gif" lazyload width="70%" height="70%" alt="TLB Miss"></center>

<p>First the MMU must fetch the PTE from the L1 <strong>cache</strong>,<br>then the newly fetched PTE is <strong>stored in the TLB</strong>.</p>
<hr>
<h1 id="8-System-Level-I-O"><a href="#8-System-Level-I-O" class="headerlink" title="8 System-Level I/O"></a>8 System-Level I/O</h1><h2 id="8-1-I-O-Bus"><a href="#8-1-I-O-Bus" class="headerlink" title="8.1 I/O Bus"></a>8.1 I/O Bus</h2><center><img src="/2022/04/30/introduction-to-computer-systems-course-note/112.png" srcset="/img/loading.gif" lazyload width="70%" height="70%" alt="I/O Bus"></center>

<p>The purpose of the <strong>I/O bridge</strong> are</p>
<ul>
<li>Manage and coordinate different types of I/O devices and the main memory;</li>
<li>To separate the signals within the CPU, ensure they will not interrupt each other.</li>
</ul>
<hr>
<h2 id="8-2-How-I-O-devices-interact-with-CPU"><a href="#8-2-How-I-O-devices-interact-with-CPU" class="headerlink" title="8.2 How I/O devices interact with CPU"></a>8.2 How I/O devices interact with CPU</h2><blockquote>
<p>CPU is too fast, I/O devices are too slow.</p>
</blockquote>
<p><strong>Design principle</strong>: should not let CPU wait for I/O devices</p>
<ul>
<li>Interrupt-based:</li>
</ul>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/113.png" srcset="/img/loading.gif" lazyload width="70%" height="70%" alt="Interrupt-based"></center>

<ul>
<li><strong>DMA</strong> – Direct Memory Access, dedicated hardware helping CPU to move data between I/O devices and main memory</li>
</ul>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/114.png" srcset="/img/loading.gif" lazyload width="70%" height="70%" alt="DMA"></center>

<hr>
<p>1.CPU sends signal about the address in Disk, and the destination memory address.</p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/115.png" srcset="/img/loading.gif" lazyload width="70%" height="70%" alt="Read a fire 1"></center>

<p>2.Disk sends data to main memory.</p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/116.png" srcset="/img/loading.gif" lazyload width="70%" height="70%" alt="Read a fire 2"></center>

<p>3.Disk sends interrupt to CPU to indicate thr transfer is complete.</p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/117.png" srcset="/img/loading.gif" lazyload width="70%" height="70%" alt="Read a fire 3"></center>

<hr>
<h2 id="8-3-Unix-I-O-Overview"><a href="#8-3-Unix-I-O-Overview" class="headerlink" title="8.3 Unix I/O Overview"></a>8.3 Unix I/O Overview</h2><ul>
<li>A file (in Unix/Linux) is a sequence of <code>m</code> bytes;</li>
<li>All I/O devices are represented as files.</li>
</ul>
<h3 id="Regular-Files"><a href="#Regular-Files" class="headerlink" title="Regular Files"></a>Regular Files</h3><blockquote>
<p>Used to store data</p>
<ul>
<li><strong>Text files</strong>: with only ASCII or Unicode characters;<ul>
<li>sequence of chars terminated by newline char (‘<code>\n</code>’)</li>
<li>Newline is <code>0xa</code>, same as ASCII <strong>line feed</strong> character (LF)</li>
<li>End of line (EOL) indicators<ul>
<li><strong>Linux and Mac OS</strong>: ‘<code>\n</code>’ (0xa), line feed (LF) </li>
<li><strong>Windows &amp; Internet protocols</strong>: ‘<code>\r\n</code>’ (0xd 0xa), Carriage return (CR) followed by line feed (LF)</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<ul>
<li><strong>Binary files</strong>: are everything else, e.g., object files, JPEG images</li>
</ul>
<hr>
<h3 id="Directories"><a href="#Directories" class="headerlink" title="Directories"></a>Directories</h3><ul>
<li><p>Directory consists of an array of links, Each link maps a filename to a file</p>
</li>
<li><p><code>.</code> (dot) is a link to <strong>itself</strong></p>
</li>
<li><code>..</code> (dot dot) is a link to the <strong>parent directory</strong> in the directory hierarchy</li>
<li><code>mkdir</code>: create empty directory</li>
<li><code>ls</code>: view directory contents</li>
<li><code>rmdir</code>: delete empty directory</li>
</ul>
<p><strong>Directory Hierarchy</strong>:</p>
<blockquote>
<p>All files are organized as a hierarchy anchored by root directory named <code>/</code> (slash)</p>
</blockquote>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/118.png" srcset="/img/loading.gif" lazyload width="120%" height="120%" alt="Directory Hierarchy"></center>

<ul>
<li><code>cd</code>: Modified current working directory (for Change Directory).</li>
</ul>
<p><strong>Pathnames</strong>:</p>
<ul>
<li><strong>Absolute pathname</strong> starts with ‘/’ and denotes path from root<ul>
<li><code>/home/droh/hello.c</code></li>
</ul>
</li>
<li><strong>Relative pathname</strong> denotes path from current working directory<ul>
<li><code>../droh/hello.c</code></li>
</ul>
</li>
</ul>
<hr>
<h1 id="9-Network-Programming"><a href="#9-Network-Programming" class="headerlink" title="9 Network Programming"></a>9 Network Programming</h1><h2 id="9-1-Client-Server-Transaction"><a href="#9-1-Client-Server-Transaction" class="headerlink" title="9.1 Client-Server Transaction"></a>9.1 Client-Server Transaction</h2><p>Server: </p>
<ul>
<li>process multiple client processes</li>
<li>manages some resource and provides service to clients</li>
<li>activated by request from client</li>
</ul>
<p>Clients and servers are processes running on the <strong>same or different hosts</strong>.</p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/119.png" srcset="/img/loading.gif" lazyload width="120%" height="120%" alt="Client-Server Transaction"></center>

<hr>
<h2 id="9-2-Computer-Networks"><a href="#9-2-Computer-Networks" class="headerlink" title="9.2 Computer Networks"></a>9.2 Computer Networks</h2><blockquote>
<p>A network is a hierarchical system of boxes and wires organized by geographical proximity</p>
<p><strong>SAN</strong> (System Area Network) spans <strong>cluster or machine room</strong><br><strong>LAN</strong> (Local Area Network)  spans <strong>a building or campus</strong><br><strong>WAN</strong> (Wide Area Network) spans <strong>country or world</strong></p>
</blockquote>
<p>An <strong>internetwork (internet)</strong> is an interconnected set of<br>networks</p>
<blockquote>
<p>The Global IP <strong>Internet</strong> (uppercase “I”) is the most famous example of an <strong>internet</strong> (lowercase “i”)</p>
</blockquote>
<hr>
<h2 id="9-3-LAN-amp-internet"><a href="#9-3-LAN-amp-internet" class="headerlink" title="9.3 LAN &amp; internet"></a>9.3 LAN &amp; internet</h2><p><strong>LAN</strong>: A collection of hosts attached to a single wire</p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/120.png" srcset="/img/loading.gif" lazyload width="50%" height="50%" alt="LAN"></center>

<p><strong>internet</strong>: multiple <strong>LANs</strong> connected by <strong>routers</strong></p>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/121.png" srcset="/img/loading.gif" lazyload width="80%" height="80%" alt="internet"></center>

<hr>
<h2 id="9-4-Logical-Structure-of-an-internet"><a href="#9-4-Logical-Structure-of-an-internet" class="headerlink" title="9.4 Logical Structure of an internet"></a>9.4 Logical Structure of an internet</h2><p><strong>Ad hoc</strong> interconnection of networks</p>
<blockquote>
<p>No particular topology;<br>Different packets may take different routes</p>
</blockquote>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/122.png" srcset="/img/loading.gif" lazyload width="80%" height="80%" alt="Logical Structure of an internet"></center>

<h2 id="9-5-IP-address"><a href="#9-5-IP-address" class="headerlink" title="9.5 IP address"></a>9.5 IP address</h2><blockquote>
<p>To locate a computer in the network</p>
</blockquote>
<ul>
<li><p>MAC address<br>Each <strong>network interface</strong> has a <strong>unique</strong> MAC address;<br>hardcoded when the interface hardware is produced, can not be changed, like our ID card.</p>
</li>
<li><p>IP address<br>Each computer is assigned an IP address, configurable, can be changed, like home address</p>
</li>
</ul>
<blockquote>
<p>The MAC address is bind with an IP address when your computer is connected to<br>some network, IP address can be different when you connect to different network.</p>
</blockquote>
<p><code>IPv4</code>: IP address is a 32-bit integer<br><code>IPv6</code>: IP address is a 128-bit integer</p>
<hr>
<h2 id="9-6-Domain"><a href="#9-6-Domain" class="headerlink" title="9.6 Domain"></a>9.6 Domain</h2><p>Human-friendly structured string of IP addresses;</p>
<ul>
<li>apollo.comp.polyu.edu.hk $\to$ 158.132.xxx.xxx</li>
</ul>
<blockquote>
<p>Mapping between domain names and IP addresses are stored on domain name servers, mapping service is provided by these servers.</p>
</blockquote>
<hr>
<h2 id="9-7-Port-number"><a href="#9-7-Port-number" class="headerlink" title="9.7 Port number"></a>9.7 Port number</h2><blockquote>
<p>a port number is used to <strong>uniquely</strong> identify a <strong>process</strong> on the computer;</p>
</blockquote>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/123.png" srcset="/img/loading.gif" lazyload width="80%" height="80%" alt="Port number"></center>

<hr>
<h2 id="9-8-Send-Bits-Across-Incompatible-LANs-and-WANs"><a href="#9-8-Send-Bits-Across-Incompatible-LANs-and-WANs" class="headerlink" title="9.8 Send Bits Across Incompatible LANs and WANs"></a>9.8 Send Bits Across Incompatible LANs and WANs</h2><ul>
<li><p>Solution: an internet <strong>protocol</strong> running on hosts and routers</p>
<blockquote>
<p>Protocol is a set of rules that governs how hosts and routers should<br>cooperate when they transfer data from network to network</p>
</blockquote>
</li>
<li><p>delivery mechanism<br>defines a <strong>standard</strong> transfer unit (packet)<br>Packet consists of <code>header</code> and <code>payload</code></p>
<ul>
<li><code>Header</code>: contains <strong>info</strong> such as packet size, source and destination addresses </li>
<li><code>Payload</code>: contains <strong>data</strong> bits sent from source host</li>
</ul>
</li>
</ul>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/124.png" srcset="/img/loading.gif" lazyload width="50%" height="50%" alt="Packet"></center>

<ul>
<li>Headers<ul>
<li>Pre-defined data structure containing important information for the data to be transmitted in the network, such as IP addresses, packet length, etc.</li>
</ul>
</li>
<li>Payload<ul>
<li>The data, usually a specified number of bytes</li>
<li>To transmit large data, trunk them into smaller packets</li>
</ul>
</li>
</ul>
<center><img src="/2022/04/30/introduction-to-computer-systems-course-note/125.png" srcset="/img/loading.gif" lazyload width="80%" height="80%" alt="Packet"></center>

<hr>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><p>B. Randal, D. R. O’Hallaron, <em>Computer systems : a programmer’s perspective</em>, Third edition. Boston: Pearson, 2016.<br>Slides of COMP1411 Introduction to Computer Systems, The Hong Kong Polytechnic University.</p>
<hr>
<p><strong><em>个人笔记，仅供参考，转载请标明出处</em></strong><br><strong><em>FOR REFERENCE ONLY</em></strong></p>
<p><strong><em>Made by Mike_Zhang</em></strong></p>
<center><img src="https://ultrafish-blog.oss-cn-hangzhou.aliyuncs.com/blog3/logo3.gif?versionId=CAEQGxiBgIDY95eb1xciIGY2MzBlMTcyY2NlNzQ0MjE5Y2MyZGM5MGE0NDQ3YzQ2" srcset="/img/loading.gif" lazyload width height><br><br></center>

              
            </div>
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Computer-System/" class="category-chain-item">Computer System</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Computer-System/">#Computer System</a>
      
        <a href="/tags/Note/">#Note</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Introduction to Computer Systems Course Note</div>
      <div>https://ultrafish.cn/2022/04/30/introduction-to-computer-systems-course-note/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Mike_Zhang</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年4月30日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
              <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">
              <span class="hint--top hint--rounded" aria-label="SA - 相同方式共享">
                <i class="iconfont icon-sa"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/04/30/introduction-to-data-analytics-course-note/" title="Introduction to Data Analytics Course Note">
                        <span class="hidden-mobile">Introduction to Data Analytics Course Note</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.4.16/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"xPfvtHmxSDcqGwKW6R8EEWXM-gzGzoHsz","appKey":"jVB4RsyHUFfRbEhhlssoxEVQ","path":"window.location.pathname","placeholder":"说点什么吧(记得写上你的昵称哦)","avatar":"mp","meta":["nick","mail"],"requiredFields":["nick"],"pageSize":10,"lang":"zh-CN","highlight":true,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":true},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  








    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <footer class="text-center mt-5 py-3" style="font-size:small;">
<div class="footer-inner">
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  
  
    <!-- 备案信息 ICP for China -->
    <div class="beian">
  <span>
    <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
      浙ICP备2020036956号
    </a>
  </span>
  
    
      <span>
        <a
          href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33042102000661"
          rel="nofollow noopener"
          class="beian-police"
          target="_blank"
        >
          
            <span style="visibility: hidden; width: 0">|</span>
            <img src="/img/police_beian.png" srcset="/img/loading.gif" lazyload alt="police-icon"/>
          
          <span>浙公网安备33042102000661号</span>
        </a>
      </span>
    
  
</div>

  
  
  <div class="footer" >
    Copyright &copy; 2020-2022 Mike_Zhang. All rights reserved.
  </div>
</div>



</footer>
  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  

  

  

  

  

  

  
    
  




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        MathJax = {
          tex    : {
            inlineMath: { '[+]': [['$', '$']] }
          },
          loader : {
            load: ['ui/lazy']
          },
          options: {
            renderActions: {
              findScript    : [10, doc => {
                document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                  const display = !!node.type.match(/; *mode=display/);
                  const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                  const text = document.createTextNode('');
                  node.parentNode.replaceChild(text, node);
                  math.start = { node: text, delim: '', n: 0 };
                  math.end = { node: text, delim: '', n: 0 };
                  doc.math.push(math);
                });
              }, '', false],
              insertedScript: [200, () => {
                document.querySelectorAll('mjx-container').forEach(node => {
                  let target = node.parentNode;
                  if (target.nodeName.toLowerCase() === 'li') {
                    target.parentNode.classList.add('has-jax');
                  }
                });
              }, '', false]
            }
          }
        };
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.0/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="/js/leancloud.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
